---
title: "Eye_tracking_R"
output:
  pdf_document: default
  html_document: default
date: "2025-04-14"
---


# Eye-tracking Analysis for Experiment 1 (Garcia quasi replication) ##
#libraries
```{r}
# Load libraries
library(lme4)
library(lmerTest)
library(tidyverse)
library(ggplot2)
library(svglite)
library(sjPlot)
#install.packages("performance")
library(performance)
library(emmeans)
library(ez)
library(dplyr)
library(Matrix)
library(carData)                  # For plotting mixed model
library(effects)    # For visualizing model effects
library("Hmisc")
library(rstatix)
library(ggpubr)
library(broom)

        
# general rules:
# everything from the ES phase -> darkorchid
# everything from the EE phaes -> deepskyblue
```
# reading in the file
```{r}
file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs.csv"
data <- read.csv(file)
```

# Accuracy ~ overall value + absolute value
```{r}

# exclude specific subjects
excluded_subs <- c(99, 6)
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs & OV_num_2 != "" & !is.na(OV_num_2))

model_corr <- lmer(corr ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = es_data)
summary(model_corr) 
model_corr
```


```{r}

data <- read.csv(file)
excluded_subs <- c(99, 6)

# filter for ES
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs & !is.na(OV_num_2) & !is.na(AbsValueDiff_2) & !is.na(corr))

# fit models, extract coefficients
get_subject_estimates <- function(sub_data) {
  model <- lm(corr ~ OV_num_2 + AbsValueDiff_2, data = sub_data)
  summary_model <- summary(model)
  
  coefs <- summary_model$coefficients
  results <- tibble(
    sub_id = unique(sub_data$sub_id),
    predictor = rownames(coefs),
    beta_value = coefs[, "Estimate"],
    standard_error = coefs[, "Std. Error"],
    t_stat = coefs[, "t value"],
    p_value = coefs[, "Pr(>|t|)"],
    lower_CI = beta_value - 1.96 * standard_error,
    upper_CI = beta_value + 1.96 * standard_error
  )
  
  return(results)
}

subject_results <- es_data %>%
  group_split(sub_id) %>%
  map_dfr(get_subject_estimates)

# intercept can be temoved for lter plotting but doesnt have to
subject_results <- subject_results %>%
  filter(predictor != "(Intercept)")

output_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_Code_ES_LME_Accuracy_SubjectLevel_Results.csv"
write.csv(subject_results, output_file, row.names = FALSE)
print(subject_results)

```

# RT ~ Overall value + absolute value
```{r}
model_rtime <- lmer(rtime ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = es_data)
summary(model_rtime)

```
# Tab Model - Accuracy & RT
```{r}
tab_model(model_corr)
tab_model(model_rtime)
```

# beta coeff OV + AbsVD model 

```{r}
ggplot() +
  # Bar plot of fixed effects
  geom_bar(data = beta_df, aes(x = Predictor, y = Estimate, fill = Predictor), 
           stat = "identity", alpha = 0.7, color = "black", width = 0.5) +
  
  geom_errorbar(data = beta_df, aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper), 
                width = 0.2, color = "black") +
  
  # individual participant estimates as jitter
  geom_jitter(data = random_effects_df, aes(x = Predictor, y = Beta), 
              width = 0.1, color = "black", size = 3, alpha = 0.8) +
  
  labs(title = "Beta Coefficients for Accuracy Model",
       x = "", y = "Beta Coefficients") +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_fill_manual(values = c("OV_num_2" = "purple", "AbsValueDiff_2" = "darkorchid"))

```

# ES - Accuracy by OV and AbsVD plot and stats
```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# ES phase filtering
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, corr) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

# meaan and SE
summary_df <- es_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()), # SD/sqrt(n)
    .groups = 'drop'
  )

############### OV ##########################################################
# mean and SE per OV category
overall_summary <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary)
print(total_summary)

############## VD ###########################################################

# mean accuracy and SE per VD category
overall_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

############# plot ########################################################

p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_accuracy, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = mean_accuracy - se_accuracy, ymax = mean_accuracy + se_accuracy), 
                width = 0.08, linewidth = 0.8) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + 
  scale_color_manual(values = c("darkorchid1", "darkorchid3", "darkmagenta")) + 
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Accuracy by Overall Value and Absolute Value Difference - ES",
    x = "Overall Value",
    y = "Accuracy (%)",
    color = "Absolute Value"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_Accuracy_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p

# kruskal wallis test for comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(corr ~ OVcate_2)

posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(corr ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- ee_data %>%
  kruskal_test(corr ~ Abscate_2)

posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(corr ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")
```

# ES - RT by OV and AbsVD + plot + stats
```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# filter for ES
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, rtime) %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

print(colSums(is.na(es_data)))

# meaan and SE for RT
summary_df <- es_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_rtime = mean(rtime, na.rm = TRUE),
    se_rtime = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
################### OV #######################################################

# mean RT and SE per OV category
overall_summary_OV <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
total_summary_OV <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_OV)
print(total_summary_OV)

#################### VD #####################################################

# mean RT and SE per VD
overall_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()), 
    .groups = 'drop'
  )

total_summary_VD <- es_data %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

#########################################################################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_rtime, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = mean_rtime - se_rtime, ymax = mean_rtime + se_rtime), 
                width = 0.08, linewidth = 0.8) +  
  geom_hline(yintercept = median(summary_df$mean_rtime, na.rm = TRUE), 
             linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = c("darkorchid1", "darkorchid3", "darkmagenta")) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "RT by Overall Value and Absolute Value Difference - ES",
    x = "Overall Value",
    y = "Reaction Time (ms)",
    color = "Absolute Value"
  )

p

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_RTime_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")


################################################

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- es_data %>%
  kruskal_test(rtime ~ OVcate_2)
posthoc_accuracy_ov <- es_data %>%
  pairwise_wilcox_test(rtime ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- es_data %>%
  kruskal_test(rtime ~ Abscate_2)
posthoc_accuracy_abs <- es_data %>%
  pairwise_wilcox_test(rtime ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")

print(kruskal_accuracy_ov)
print(posthoc_accuracy_ov)
print(kruskal_accuracy_abs)
print(posthoc_accuracy_abs)

```

# EE- Accuracy by OV and AbsVD + plots + stats

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# ES phase filtering
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, corr) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

# meaan and SE
summary_df <- ee_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()), # SD/sqrt(n)
    .groups = 'drop'
  )

############### OV ##########################################################
# mean and SE per OV category
overall_summary <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary)
print(total_summary)

############## VD ###########################################################

# mean accuracy and SE per VD category
overall_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

############# plot ########################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_accuracy, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = mean_accuracy - se_accuracy, ymax = mean_accuracy + se_accuracy), 
                width = 0.08, linewidth = 0.8) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + 
  scale_color_manual(values = c("blue", "deepskyblue", "navy")) + 
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Accuracy by Overall Value and Absolute Value Difference - EE",
    x = "Overall Value",
    y = "Accuracy (%)",
    color = "Absolute Value"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_Accuracy_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(corr ~ OVcate_2)

posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(corr ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- ee_data %>%
  kruskal_test(corr ~ Abscate_2)

posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(corr ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")
```

# EE - RT by OV and AbsVD

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# filter for ES
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, rtime) %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

print(colSums(is.na(ee_data)))

# meaan and SE for RT
summary_df <- ee_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_rtime = mean(rtime, na.rm = TRUE),
    se_rtime = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
################### OV #######################################################

# mean RT and SE per OV category
overall_summary_OV <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
total_summary_OV <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_OV)
print(total_summary_OV)

#################### VD #####################################################

# mean RT and SE per VD
overall_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()), 
    .groups = 'drop'
  )

total_summary_VD <- ee_data %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

#########################################################################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_rtime, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = mean_rtime - se_rtime, ymax = mean_rtime + se_rtime), 
                width = 0.08, linewidth = 0.8) +  
  geom_hline(yintercept = median(summary_df$mean_rtime, na.rm = TRUE), 
             linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = c("blue", "deepskyblue", "navy")) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "RT by Overall Value and Absolute Value Difference - EE",
    x = "Overall Value",
    y = "Reaction Time (ms)",
    color = "Absolute Value"
  )

p

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_RTime_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")


################################################

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(rtime ~ OVcate_2)
posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(rtime ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- es_data %>%
  kruskal_test(rtime ~ Abscate_2)
posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(rtime ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")

print(kruskal_accuracy_ov)
print(posthoc_accuracy_ov)
print(kruskal_accuracy_abs)
print(posthoc_accuracy_abs)

```

# ES - Eye-tracking (choose right, corr, rtime) (similar to CCTs paper)
```{r}
data <- read.csv(file)

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

# dependent variable
dep_var <- "chose_right"  # others: 'corr', 'rtime'

eye_metrics <- c("GazeDiff", "FinalFixLoc", "FirstFixLoc", "FirstFixDur", "FinalFixDur", 
                 "MiddleFixDur", "eachMiddleFixDur", "GazeSwitch", "DwellTimeAdvantage", 
                 "LeftFixNR", "RightFixNR", "PropDwell_opt", "PropDwell_sub", "AttentionW", 
                 "InattentionW", "FixLocFirstCorr", "FixLocLastCorr", "DwellTimeAdvantage", 
                 "FixationAdvantage", "DwelltimeAdvantageCorrect","DwellPropAdvantageCorrect")

excluded_subs <- c(1, 4, 5, 6, 14, 99)
data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs)
data <- data %>%
  rename(OV = OV_2, VD = AbsValueDiff_2)

# z-score VD & OV & gaze metrics at  OV Level
data <- data %>%
  group_by(OV) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()

# z-score VD & eye metrics within individual sub_id
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1], 
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()


# loop through eye-tracking metrics
for (eye_metric in eye_metrics) {
  # interaction 
  interaction_term <- paste0("OV:", eye_metric)
  #logistic regression
  model_formula <- as.formula(paste(dep_var, "~ OV *", eye_metric, "+ (1 + OV| sub_id)"))
  #glmer
  model <- glmer(model_formula, data = data, family = binomial(link = "logit"))

  stats_file <- paste0(output_dir, "ES_Logistic_Model_", dep_var, "_", eye_metric, ".txt")

  # summary and tab_model
  sink(stats_file)
  cat("### Logistic Mixed Model (Betas) - ES Phase ###\n\n")
  cat("#### Model Summary ####\n")
  print(summary(model)) 
  cat("\n#### Tab Model Output ####\n")
  print(tab_model(model, transform = NULL))  
  sink()

  #fixed effects + predictor names
  beta_df <- as.data.frame(coef(summary(model)))
  beta_df$Predictor <- rownames(beta_df)
  rownames(beta_df) <- NULL
  colnames(beta_df) <- c("Estimate", "SE", "z", "p", "Predictor")

  # get 95% CI
  beta_df <- beta_df %>%
    mutate(
      CI_Lower = Estimate - 1.96 * SE,  # CI Lower
      CI_Upper = Estimate + 1.96 * SE   # CI Upper
    ) %>%
    filter(Predictor != "(Intercept)")  # excluding this, I don't want it in my plot, takes space

  # sig. display can be modified to include numbers
  beta_df <- beta_df %>%
    mutate(
      Significance = case_when(
        p < 0.001 ~ "***",
        p < 0.01 ~ "**",
        p < 0.05 ~ "*",
        TRUE ~ "" 
      )
    )

  # order
  beta_df <- beta_df %>%
  filter(Predictor %in% c(eye_metric, interaction_term))
  beta_df$Predictor <- factor(beta_df$Predictor, levels = c(eye_metric, interaction_term))
  output_path <- paste0(output_dir, "ES_Logistic_Plot_", dep_var, "_", eye_metric, ".svg")

  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.05, color = "black", linewidth = 1) +

    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.09, CI_Upper + 0.09), 
                  label = Significance),
              color = "black", size = 10, fontface = "bold") +  

    geom_hline(yintercept = 0, color = "black", linewidth = 1) +

    labs(title = paste("Beta Coefficients for OV &", eye_metric, "on symbolic choice"),
         x = "", y = "Beta Coefficients") +
    
    scale_fill_manual(values = setNames(rep("darkorchid", 4), c("VD", "OV", eye_metric, interaction_term))) +    
    theme_minimal() +
    theme(
      legend.position = "none", 
      panel.grid = element_blank(), 
      axis.line.y = element_line(color = "black", linewidth = 1),  
      axis.line.x = element_blank(),  
      axis.text = element_text(size = 22, color = "black"), 
      axis.title = element_text(size = 20, color = "black"),  
      plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
      panel.background = element_rect(fill = "white", color = "white"),  
      plot.background = element_rect(fill = "white", color = "white") 
    )

  ggsave(output_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
  cat("saved log regression plot for", eye_metric, "as SVG at:", output_path, "\n")

}

summary(model)
tab_model(model, transform = NULL)  

```
# EE - Eye-tracking (choose right, corr, rtime)
```{r}
data <- read.csv(file)

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

# dependent variable
dep_var <- "chose_right"  # others: 'corr', 'rtime'

eye_metrics <- c("GazeDiff", "FinalFixLoc", "FirstFixLoc", "FirstFixDur", "FinalFixDur", 
                 "MiddleFixDur", "eachMiddleFixDur", "GazeSwitch", "DwellTimeAdvantage", 
                 "LeftFixNR", "RightFixNR", "PropDwell_opt", "PropDwell_sub", "AttentionW", 
                 "InattentionW", "FixLocFirstCorr", "FixLocLastCorr", "DwellTimeAdvantage", 
                 "FixationAdvantage", "DwelltimeAdvantageCorrect","DwellPropAdvantageCorrect")

excluded_subs <- c(1, 4, 5, 6, 14, 99)
data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs)
data <- data %>%
  rename(OV = OV_2, VD = AbsValueDiff_2)

# z-score VD & OV & gaze metrics at  OV Level
data <- data %>%
  group_by(OV) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()

# z-score VD & eye metrics within individual sub_id
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1], 
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()


# loop through eye-tracking metrics
for (eye_metric in eye_metrics) {
  # interaction 
  interaction_term <- paste0("OV:", eye_metric)
  #logistic regression
  model_formula <- as.formula(paste(dep_var, "~ OV *", eye_metric, "+ (1 + OV| sub_id)"))
  #glmer
  model <- glmer(model_formula, data = data, family = binomial(link = "logit"))

  stats_file <- paste0(output_dir, "EE_Logistic_Model_", dep_var, "_", eye_metric, ".txt")

  # summary and tab_model
  sink(stats_file)
  cat("### Logistic Mixed Model (Betas) - EE Phase ###\n\n")
  cat("#### Model Summary ####\n")
  print(summary(model)) 
  cat("\n#### Tab Model Output ####\n")
  print(tab_model(model, transform = NULL))  
  sink()

  #fixed effects + predictor names
  beta_df <- as.data.frame(coef(summary(model)))
  beta_df$Predictor <- rownames(beta_df)
  rownames(beta_df) <- NULL
  colnames(beta_df) <- c("Estimate", "SE", "z", "p", "Predictor")

  # get 95% CI
  beta_df <- beta_df %>%
    mutate(
      CI_Lower = Estimate - 1.96 * SE,  # CI Lower
      CI_Upper = Estimate + 1.96 * SE   # CI Upper
    ) %>%
    filter(Predictor != "(Intercept)")  # excluding this, I don't want it in my plot, takes space

  # sig. display can be modified to include numbers
  beta_df <- beta_df %>%
    mutate(
      Significance = case_when(
        p < 0.001 ~ "***",
        p < 0.01 ~ "**",
        p < 0.05 ~ "*",
        TRUE ~ "" 
      )
    )

  # order
  beta_df <- beta_df %>%
  filter(Predictor %in% c(eye_metric, interaction_term))
  beta_df$Predictor <- factor(beta_df$Predictor, levels = c(eye_metric, interaction_term))
  output_path <- paste0(output_dir, "EE_Logistic_Plot_", dep_var, "_", eye_metric, ".svg")

  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.05, color = "black", linewidth = 1) +

    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.09, CI_Upper + 0.09), 
                  label = Significance),
              color = "black", size = 10, fontface = "bold") +  

    geom_hline(yintercept = 0, color = "black", linewidth = 1) +

    labs(title = paste("Beta Coefficients for OV &", eye_metric, "on symbolic choice"),
         x = "", y = "Beta Coefficients") +
    
    scale_fill_manual(values = setNames(rep("deepskyblue", 4), c("VD", "OV", eye_metric, interaction_term))) +    
    theme_minimal() +
    theme(
      legend.position = "none", 
      panel.grid = element_blank(), 
      axis.line.y = element_line(color = "black", linewidth = 1),  
      axis.line.x = element_blank(),  
      axis.text = element_text(size = 22, color = "black"), 
      axis.title = element_text(size = 20, color = "black"),  
      plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
      panel.background = element_rect(fill = "white", color = "white"),  
      plot.background = element_rect(fill = "white", color = "white") 
    )

  ggsave(output_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
  cat("saved log regression plot for", eye_metric, "as SVG at:", output_path, "\n")

}

summary(model)
tab_model(model, transform = NULL)  
```


# ES - AttentionW and InattentionW as predictors for accuracy and RT - Model comparison

```{r}


# folder for model comparison
base_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_model_comparisons_ES/"
dir.create(base_path, showWarnings = FALSE)

data <- read.csv("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs.csv") %>%
  filter(phase == "ES" & !sub_id %in% c(1, 4, 5, 6, 14, 99)) %>%
  rename(OV = OV_2) %>%
  group_by(sub_id) %>%
  mutate(across(c(OV, AttentionW, InattentionW), ~ scale(.)[,1]),
         rtime = scale(log(rtime))[,1]) %>%
  ungroup()
# log transfrom rtime

process_model <- function(model, model_name, dv_type = c("accuracy", "rt")) {
  dv_type <- match.arg(dv_type)
  # Save model summary
  summary_path <- paste0(base_path, model_name, "_summary.txt")
  sink(summary_path)
  cat(paste("###", toupper(dv_type), "MODEL:", model_name, "###\n\n"))
  print(summary(model))
  cat("\nR² (marginal/conditional):\n")
  print(r2(model))  
  sink()
  # get betas
 beta_df <- coef(summary(model)) %>%
  as.data.frame() %>%
  rownames_to_column("Predictor")

# Rename columns dynamically
if (dv_type == "accuracy") {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|z|)`)
} else {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|t|)`)
}


  beta_df <- beta_df %>%
    mutate(CI_Lower = Estimate - 1.96 * SE,
           CI_Upper = Estimate + 1.96 * SE) %>%
    filter(str_detect(Predictor, "OV:AttentionW|OV:InattentionW")) %>%
    mutate(Predictor = factor(Predictor, levels = c("OV:AttentionW", "OV:InattentionW")))

  plot_title <- ifelse(dv_type == "accuracy", "Accuracy", "Reaction Time")
  plot_path <- paste0(base_path, model_name, "_plot.svg")
  
  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.1, color = "black", linewidth = 1) +
    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05),
                  label = sprintf("p = %.3f", p)), color = "black", size = 8, fontface = "bold") +
    geom_hline(yintercept = 0, color = "black", linewidth = 1) +
    labs(title = paste("OV × (In)Attention on", plot_title), y = "Beta Coefficients", x = NULL) +
    scale_fill_manual(values = rep("darkorchid", 2)) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid = element_blank(),
      axis.line.y = element_line(color = "black", linewidth = 1),
      axis.line.x = element_blank(),
      axis.text = element_text(size = 20, color = "black"),
      axis.title.y = element_text(size = 20, color = "black"),
      plot.title = element_text(size = 20, hjust = 0.5, color = "black", face = "bold"),
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white")
    )

  ggsave(plot_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
}

# accuracy ~ model
m1_corr <- glmer(corr ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
m2_corr <- glmer(corr ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data, family = binomial)
m3_corr <- glmer(corr ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
process_model(m1_corr, "m1_corr", "accuracy")
process_model(m2_corr, "m2_corr", "accuracy")
process_model(m3_corr, "m3_corr", "accuracy")
anova(m1_corr, m2_corr, m3_corr) 

# rtime ~ model
m1_rt <- lmer(rtime ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data)
m2_rt <- lmer(rtime ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data)
m3_rt <- lmer(rtime ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data)
process_model(m1_rt, "m1_rt", "rt")
process_model(m2_rt, "m2_rt", "rt")
process_model(m3_rt, "m3_rt", "rt")
anova(m1_rt, m2_rt, m3_rt)  

# using AIC or BIC to compare (better option)
print(AIC(m1_corr, m2_corr, m3_corr))
print(AIC(m1_rt, m2_rt, m3_rt))

```

# EE - AttentionW and InattentionW as predictors for accuracy and RT - Model comparison
```{r}

# folder for model comparison
base_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_model_comparisons_EE/"
dir.create(base_path, showWarnings = FALSE)

data <- read.csv("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs.csv") %>%
  filter(phase == "EE" & !sub_id %in% c(1, 4, 5, 6, 14, 99)) %>%
  rename(OV = OV_2) %>%
  group_by(sub_id) %>%
  mutate(across(c(OV, AttentionW, InattentionW), ~ scale(.)[,1]),
         rtime = scale(log(rtime))[,1]) %>%
  ungroup()
# log transfrom rtime

process_model <- function(model, model_name, dv_type = c("accuracy", "rt")) {
  dv_type <- match.arg(dv_type)
  # Save model summary
  summary_path <- paste0(base_path, model_name, "_summary.txt")
  sink(summary_path)
  cat(paste("###", toupper(dv_type), "MODEL:", model_name, "###\n\n"))
  print(summary(model))
  cat("\nR² (marginal/conditional):\n")
  print(r2(model))  
  sink()
  # get betas
 beta_df <- coef(summary(model)) %>%
  as.data.frame() %>%
  rownames_to_column("Predictor")

# Rename columns dynamically
if (dv_type == "accuracy") {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|z|)`)
} else {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|t|)`)
}


  beta_df <- beta_df %>%
    mutate(CI_Lower = Estimate - 1.96 * SE,
           CI_Upper = Estimate + 1.96 * SE) %>%
    filter(str_detect(Predictor, "OV:AttentionW|OV:InattentionW")) %>%
    mutate(Predictor = factor(Predictor, levels = c("OV:AttentionW", "OV:InattentionW")))

  plot_title <- ifelse(dv_type == "accuracy", "Accuracy", "Reaction Time")
  plot_path <- paste0(base_path, model_name, "_plot.svg")
  
  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.1, color = "black", linewidth = 1) +
    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05),
                  label = sprintf("p = %.3f", p)), color = "black", size = 8, fontface = "bold") +
    geom_hline(yintercept = 0, color = "black", linewidth = 1) +
    labs(title = paste("OV × (In)Attention on", plot_title), y = "Beta Coefficients", x = NULL) +
    scale_fill_manual(values = rep("deepskyblue", 2)) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid = element_blank(),
      axis.line.y = element_line(color = "black", linewidth = 1),
      axis.line.x = element_blank(),
      axis.text = element_text(size = 20, color = "black"),
      axis.title.y = element_text(size = 20, color = "black"),
      plot.title = element_text(size = 20, hjust = 0.5, color = "black", face = "bold"),
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white")
    )

  ggsave(plot_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
}

# accuracy ~ model
m1_corr <- glmer(corr ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
m2_corr <- glmer(corr ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data, family = binomial)
m3_corr <- glmer(corr ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
process_model(m1_corr, "m1_corr", "accuracy")
process_model(m2_corr, "m2_corr", "accuracy")
process_model(m3_corr, "m3_corr", "accuracy")
anova(m1_corr, m2_corr, m3_corr) 

# rtime ~ model
m1_rt <- lmer(rtime ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data)
m2_rt <- lmer(rtime ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data)
m3_rt <- lmer(rtime ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data)
process_model(m1_rt, "m1_rt", "rt")
process_model(m2_rt, "m2_rt", "rt")
process_model(m3_rt, "m3_rt", "rt")
anova(m1_rt, m2_rt, m3_rt)  

# using AIC or BIC to compare (better option)
print(AIC(m1_corr, m2_corr, m3_corr))
print(AIC(m1_rt, m2_rt, m3_rt))

```

```{r}
data <- read.csv(file_path)

data <- data %>%
  rename(OV = OV_2, VD = AbsValueDiff_2)
excluded_subs <- c(1, 4, 5, 6, 14, 99)

# ES filter
data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs)

# Z-score OV and VD at the individual level (within each subject)
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  # Z-score per subject
    OV = scale(OV, center = TRUE, scale = TRUE)[,1]   # Z-score per subject
  ) %>%
  ungroup()

# dependent variable
dep_var <- "FinalFixDur" # AttentionW or any other thing you want to test, e.g. first or final fixations

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

model_formula <- as.formula(paste(dep_var, "~ OV + VD + (1 | sub_id)"))
model <- lmer(model_formula, data = data)

# Extract fixed effects
betas <- coef(summary(model))
beta_df <- as.data.frame(betas)

beta_df$Predictor <- rownames(beta_df)
rownames(beta_df) <- NULL

colnames(beta_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

beta_df <- beta_df %>%
  filter(Predictor != "(Intercept)")

# Compute 95% CI
beta_df <- beta_df %>%
  mutate(
    CI_Lower = Estimate - 1.96 * SE,
    CI_Upper = Estimate + 1.96 * SE
  )

# random slopes for visualization
random_effects <- coef(model)$sub_id[, c("OV", "VD")]

random_effects_df <- as.data.frame(random_effects) %>%
  rownames_to_column(var = "sub_id") %>%
  pivot_longer(cols = c("OV", "VD"), names_to = "Predictor", values_to = "Beta")

beta_df <- beta_df %>%
  mutate(
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01 ~ "**",
      p < 0.05 ~ "*",
      TRUE ~ "n.s."
    )
  )

# order
beta_df$Predictor <- factor(beta_df$Predictor, levels = c("OV", "VD"))
random_effects_df$Predictor <- factor(random_effects_df$Predictor, levels = c("OV", "VD"))

output_path <- paste0(output_dir, "ES_", dep_var, "on_OV_VD.svg")

# plot
plot_figure <- ggplot() +
  geom_bar(data = beta_df, aes(x = Predictor, y = Estimate, fill = Predictor), 
           stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
  
  geom_errorbar(data = beta_df, aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper), 
                width = 0.05, color = "black", linewidth = 1) +
  
  geom_jitter(data = random_effects_df, aes(x = Predictor, y = Beta), 
              width = 0.1, fill = "white", color = "black", shape = 21, size = 4.5, alpha = 0.8, stroke = 1) +
  
  geom_text(data = beta_df, aes(x = Predictor, y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05), label = Significance),
            color = "black", size = 9, fontface = "bold") +  
  
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  
  labs(title = paste("EE - Beta Coefficients for OV & VD on", dep_var),
       x = "", y = "Beta Coefficients") +
  
  scale_x_discrete(labels = c("OV", "VD")) +
  
  scale_fill_manual(values = setNames(rep("deepskyblue", 2), c("OV", "VD"))) +    
  
  theme_minimal() +
  theme(
    legend.position = "none", 
    panel.grid = element_blank(), 
    axis.line.y = element_line(color = "black", linewidth = 1),  
    axis.line.x = element_blank(),  
    axis.text = element_text(size = 14, color = "black"), 
    axis.title.y = element_text(size = 16, color = "black"),  
    plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
    panel.background = element_rect(fill = "white", color = "white"),  
    plot.background = element_rect(fill = "white", color = "white") 
  )

# save
ggsave(output_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
cat("Saved plot as SVG at:", output_path, "\n")
print(plot_figure)
```


# ES - Dwell-Time Advantage

```{r}

data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage Effect on Choice - ES Phase",
    x = "Dwell Time Advantage (Symbolic > Experiential)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_NEW_DwellTimeAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# EE - Dwell-Time Advantage

```{r}
data <- read.csv(file)
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()


summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")   # blue , deepskyblue navy

# Plot
p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  # Thicker lines
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + 
  scale_color_manual(values = colors, name = "OV Level") + 
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 19),  
    axis.text = element_text(size = 22, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 20, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage on Choice - EE-Phase",
    x = "Dwell Time Advantage (Right > Left)",
    y = "P(Choose Right)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_DwellTimeAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)

agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1


```

# ES - Final fixations on choice per VD and OV

```{r}

data <- read.csv(file_path)

# filter for ES phase and exclude subjects
phase_filter <- "ES" 
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

# OVcate_2 are the overall value categories - sort them
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# convert FinalFixLoc to categorical: "Right" or "Left"
data$FinalFixLocBinary <- ifelse(data$FinalFixLoc == 2, "Right", "Left")
data$FinalFixLocBinary <- factor(data$FinalFixLocBinary, levels = c("Left", "Right"))

# value difference (Right - Left)
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("E>>S", "E>S", "E ~ S", "S>E", "S>>E"),
                                   include.lowest = TRUE)) %>%
  ungroup()


# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FinalFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)


colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  

summary_df$FinalFixLocBinary <- factor(summary_df$FinalFixLocBinary,
                                        levels = c("Left", "Right"),
                                        labels = c("Line: Left", "Dotted: Right"))
line_types <- c("Line: Left" = "solid", "Dotted: Right" = "dashed")


# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FinalFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FinalFixLocBinary)) +
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "Final Fixation") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8), 
    legend.position = "top",
    legend.text = element_text(size = 14),  
    axis.text = element_text(size = 19, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = paste("Final Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Symbol - Experiential)",
    y = "P(Choose Symbol)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FinalFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p



agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FinalFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FinalFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FinalFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_FinalFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FinalFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FinalFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FinalFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# ES - First fixations on choice per VD and OV

```{r}

data <- read.csv(file_path)

# filter for ES phase and exclude subjects
phase_filter <- "ES" 
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FirstFixLoc, OVcate_2, chose_right, p1, p2)  

# OVcate_2 are the overall value categories - sort them
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# convert FirstFixLoc to categorical: "Right" or "Left"
data$FirstFixLocBinary <- ifelse(data$FirstFixLoc == 2, "Right", "Left")
data$FirstFixLocBinary <- factor(data$FirstFixLocBinary, levels = c("Left", "Right"))

# value difference (Right - Left)
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("E>>S", "E>S", "E ~ S", "S>E", "S>>E"),
                                   include.lowest = TRUE)) %>%
  ungroup()


# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FirstFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)


colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  

summary_df$FirstFixLocBinary <- factor(summary_df$FirstFixLocBinary,
                                        levels = c("Left", "Right"),
                                        labels = c("Line: Left", "Dotted: Right"))
line_types <- c("Line: Left" = "solid", "Dotted: Right" = "dashed")


# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FirstFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FirstFixLocBinary)) +
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "First Fixation") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8), 
    legend.position = "top",
    legend.text = element_text(size = 14),  
    axis.text = element_text(size = 19, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = paste("First Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Symbol - Experiential)",
    y = "P(Choose Symbol)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FirstFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p

agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FirstFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FirstFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FirstFixLocBinary, adjust = "bonferroni")
print(posthoc_results)



results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_FirstFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FirstlFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FirstlFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FirstlFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# EE - Final fixations on choice per VD and OV

```{r}
data <- read.csv(file_path)

phase_filter <- "EE"  
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))
data$FinalFixLocBinary <- ifelse(data$FinalFixLoc == 2, "Right", "Left")
data$FinalFixLocBinary <- factor(data$FinalFixLocBinary, levels = c("Left", "Right"))
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, 
                                   breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"),
                                   include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FinalFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")  

line_types <- c("Left" = "solid", "Right" = "dashed")  

summary_df$FinalFixLocBinary <- factor(summary_df$FinalFixLocBinary, levels = c("Left", "Right"))

# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FinalFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FinalFixLocBinary)) +  
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "Final Fixation") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    legend.text = element_text(size = 19),  
    axis.text = element_text(size = 22, color = "black"),  
    axis.title = element_text(size = 22, color = "black"),  
    plot.title = element_text(size = 22, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = paste("Final Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Right - Left)",
    y = "P(Choose Right)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FinalFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)

agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FinalFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FinalFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FinalFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_FinalFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FinalFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FinalFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FinalFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# EE - First fixations on choice per VD and OV

```{r}
data <- read.csv(file_path)

phase_filter <- "EE"  
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))
data$FirstFixLocBinary <- ifelse(data$FirstFixLoc == 2, "Right", "Left")
data$FirstFixLocBinary <- factor(data$FirstFixLocBinary, levels = c("Left", "Right"))
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, 
                                   breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"),
                                   include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FirstFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")  

line_types <- c("Left" = "solid", "Right" = "dashed")  

summary_df$FirstFixLocBinary <- factor(summary_df$FirstFixLocBinary, levels = c("Left", "Right"))

# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FirstFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FirstFixLocBinary)) +  
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "Final Fixation") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    legend.text = element_text(size = 19),  
    axis.text = element_text(size = 22, color = "black"),  
    axis.title = element_text(size = 22, color = "black"),  
    plot.title = element_text(size = 22, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = paste("First Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Right - Left)",
    y = "P(Choose Right)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FirstFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FirstFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FirstFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FirstFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_FirstFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FirstFixLoc_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FirstFixLoc_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FirstFixLoc_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# Chih-Chung Ting's suggestions for Analysis

##  1) Dwell-time by choice (E vs S) ##

```{r}

# get modified CCT data - the data is the same as before just that I scaled the option values (*100) like CCT suggested to make the algorithm converge faster in HDDM (has nothing to #do with the eye-tracking bit - what changed: e.g. 0.3 -> 30)
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(PropDwell_Left, PropDwell_Right, chose_right)

# Final Choice Labels
data <- data %>%
  mutate(final_choice = ifelse(chose_right == 1, "Chose Symbolic", "Chose Experiential"))

# format
data_long <- data %>%
  pivot_longer(cols = c("PropDwell_Left", "PropDwell_Right"),
               names_to = "LookedAt",
               values_to = "Dwell_Proportion")

# rename 
data_long$LookedAt <- factor(data_long$LookedAt,
                             levels = c("PropDwell_Left", "PropDwell_Right"),
                             labels = c("Looked at Experiential", "Looked at Symbolic"))
data_participant <- data_long %>%
  group_by(sub_id, final_choice, LookedAt) %>%
  summarise(Dwell_Proportion = mean(Dwell_Proportion, na.rm = TRUE), .groups = 'drop')

summary_df <- data_participant %>%
  group_by(final_choice, LookedAt) %>%
  summarise(
    mean_dwell = mean(Dwell_Proportion, na.rm = TRUE),
    ci = 1.96 * sd(Dwell_Proportion, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# colours 
bar_colors <- c("Looked at Experiential" = "darkblue",
                "Looked at Symbolic" = "darkred")

#plot with overlayed data points
p <- ggplot(summary_df, aes(x = final_choice, y = mean_dwell * 100, fill = LookedAt)) +
  geom_bar(stat = "identity",
           position = position_dodge(width = 0.6),
           width = 0.5,
           alpha = 0.8,
           color = "black") +
  geom_errorbar(aes(ymin = (mean_dwell - ci) * 100, ymax = (mean_dwell + ci) * 100),
                position = position_dodge(width = 0.6),
                width = 0.2,
                linewidth = 0.8) +
  geom_point(data = data_participant,
             aes(x = final_choice, y = Dwell_Proportion * 100, group = LookedAt, color = LookedAt),
             position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.6),
             shape = 21,
             fill = "white",
             stroke = 1,
             size = 4,
             alpha = 0.8) +
  scale_fill_manual(values = bar_colors, name = "Dwell Time On") +
  scale_color_manual(values = bar_colors, guide = "none") +
  geom_hline(yintercept = 50, linetype = "dotted", color = "gray50", linewidth = 1.2) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10),
                     labels = function(x) paste0(x, "%")) +
  labs(
    title = "Dwell Time by Choice - ES Phase",
    x = "Choice",
    y = "Mean Proportion - Dwell Time %",
    fill = "Looked At"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "top",
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 1),
    axis.text = element_text(size = 16, color = "black"),
    axis.title = element_text(size = 18, face = "bold", color = "black"),
    plot.title = element_text(size = 20, hjust = 0.5, face = "bold", color = "black"),
    plot.background = element_rect(fill = "white", color = "white")
  )

print(p)

```


## 3) Linear mixed model for final choice*LookedAt + random intercept for sub_id ##

```{r}


#model
m_lmm <- lmer(
  Dwell_Proportion ~ final_choice * LookedAt + (1 | sub_id),
  data = data_participant
)

# summary
summary(m_lmm)
anova(m_lmm)

# Post-hoc pairwise across the 4 combos
em_mod  <- emmeans(m_lmm, ~ final_choice * LookedAt)
posthoc <- pairs(em_mod, adjust = "bonferroni")
print(posthoc)

# main-effect pairwise
em_fc   <- emmeans(m_lmm, ~ final_choice)
pairs(em_fc)

em_la   <- emmeans(m_lmm, ~ LookedAt)
pairs(em_la)


### Check residual distribution (just to be sure)

par(mfrow=c(1,2))
qqnorm(resid(m_lmm), main="QQ plot of LMM residuals")
qqline(resid(m_lmm))
plot(fitted(m_lmm), resid(m_lmm), main="Residual vs. Fitted")
par(mfrow=c(1,1))


```

## Dwell-time by choice and OV ##

```{r}
# dwell time on symbolic
symbolic_data <- data_participant %>%
  filter(LookedAt == "Looked at Symbolic")

summary_symbolic <- symbolic_data %>%
  group_by(final_choice) %>%
  summarise(
    mean_dwell = mean(Dwell_Proportion),
    ci = 1.96 * sd(Dwell_Proportion) / sqrt(n()),
    .groups = 'drop'
  )
# dwell time on symbolic different from 50%?
t_test_symbolic <- symbolic_data %>%
  group_by(final_choice) %>%
  summarise(
    t_result = list(t.test(Dwell_Proportion, mu = 0.5)),
    .groups = 'drop'
  )

t_test_symbolic$t_result


p_simple <- ggplot(summary_symbolic, aes(x = final_choice, y = mean_dwell * 100)) +
  geom_bar(stat = "identity",
           fill = "darkorchid",
           width = 0.5,
           alpha = 0.8,
           color = "black") +
  geom_errorbar(aes(ymin = (mean_dwell - ci) * 100, ymax = (mean_dwell + ci) * 100),
                width = 0.2,
                linewidth = 0.8) +
  geom_point(data = symbolic_data,
             aes(x = final_choice, y = Dwell_Proportion * 100),
             position = position_jitter(width = 0.1),
             shape = 21,
             fill = "white",
             color = "darkorchid",
             stroke = 1,
             size = 4,
             alpha = 0.8) +
  geom_hline(yintercept = 50, linetype = "dotted", color = "gray50", linewidth = 1.2) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10),
                     labels = function(x) paste0(x, "%")) +
  labs(
    title = "Proportion of Dwell Time on Symbolic Option in ES",
    x = "Choice",
    y = "Dwell Time on Symbolic (%)"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "none",
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 1),
    axis.text = element_text(size = 16, color = "black"),
    axis.title = element_text(size = 18, face = "bold", color = "black"),
    plot.title = element_text(size = 18, hjust = 0.5, face = "bold", color = "black"),
    plot.background = element_rect(fill = "white", color = "white")
  )

print(p_simple)


results_summary <- symbolic_data %>%
  group_by(final_choice) %>%
  summarise(
    mean_prop = mean(Dwell_Proportion),
    sd_prop = sd(Dwell_Proportion),
    n = n(),
    t_test = list(t.test(Dwell_Proportion, mu = 0.5)),
    cohen_d = (mean(Dwell_Proportion) - 0.5) / sd(Dwell_Proportion),
    .groups = 'drop'
  )

results_summary <- results_summary %>%
  rowwise() %>%
  mutate(
    t_value = t_test$statistic,
    df = t_test$parameter,
    p_value = t_test$p.value,
    ci_low = t_test$conf.int[1],
    ci_high = t_test$conf.int[2]
  ) %>%
  select(final_choice, mean_prop, sd_prop, n, t_value, df, p_value, ci_low, ci_high, cohen_d)
print(results_summary)

```

# Fixation advantage effect on choice per bin (fixation advantage = Fix.right - Fix.Left)

```{r}
data <- read.csv(file)

# phase filter
phase_filter <- "EE"  # Change as needed
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)  

# order
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile binning of FixationAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                     breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                     labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                     include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# bin order
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")  #darkorchid1,  darkorchid3, darkmagenta

# Plot
p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Effect of Fixation Advantage on Choice - EE Phase",
    x = "Fixation Advantage (Right - Left)",
    y = "P(Choose Right)"
)

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_FixationAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


# P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

#P(Choose Right) using Fixation Advantage and OV level
lmm_model <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin * OVcate_2 +  
    (1 | sub_id),  
  data = agg_data
)

summary(lmm_model)

# post hoc
emmeans_lmm <- emmeans(lmm_model, pairwise ~ FixationAdvantage_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(emmeans_OV)
print(emmeans_lmm)

# Model comparison
lmm_no_OV <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin +  
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  

# FixtionAdvantage no bin
lmm_continuous <- lmer(chose_right ~ FixationAdvantage * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"

stats_file <- paste0(output_dir, phase_filter, "_FixationAdvantage_LMM_Results.txt")
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Right) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Fixation Advantage Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Fixation Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Fixation Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Fixation Advantage) ###\n")
print(summary(lmm_continuous))

# stop
sink()
print(paste("Statistics saved to:", stats_file))

```

```{r}
data <- read.csv(file)

# phase filter
phase_filter <- "ES"  # Change as needed
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)  

# order
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile binning of FixationAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                     breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                     labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                     include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# bin order
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  #darkorchid1,  darkorchid3, darkmagenta

# Plot
p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Effect of Fixation Advantage on Choice - EE Phase",
    x = "Fixation Advantage (Right - Left)",
    y = "P(Choose Right)"
)

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_FixationAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


# P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

#P(Choose Right) using Fixation Advantage and OV level
lmm_model <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin * OVcate_2 +  
    (1 | sub_id),  
  data = agg_data
)

summary(lmm_model)

# post hoc
emmeans_lmm <- emmeans(lmm_model, pairwise ~ FixationAdvantage_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(emmeans_OV)
print(emmeans_lmm)

# Model comparison
lmm_no_OV <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin +  
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  

# FixtionAdvantage no bin
lmm_continuous <- lmer(chose_right ~ FixationAdvantage * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"

stats_file <- paste0(output_dir, phase_filter, "_FixationAdvantage_LMM_Results.txt")
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Right) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Fixation Advantage Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Fixation Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Fixation Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Fixation Advantage) ###\n")
print(summary(lmm_continuous))

# stop
sink()
print(paste("Statistics saved to:", stats_file))
```





