---
title: "Eye_tracking_R"
output:
  pdf_document: default
  html_document: default
date: "2025-04-14"
---

# Eye-tracking Analysis for Experiment 1 (Garcia quasi replication)

#libraries

```{r}
# Load libraries
library(lme4)
library(lmerTest)
library(tidyverse)
library(ggplot2)
library(svglite)
library(sjPlot)
#install.packages("performance")
library(performance)
library(emmeans)
library(ez)
library(dplyr)
library(Matrix)
library(carData)                  # For plotting mixed model
library(effects)                  # For visualizing model effects
library("Hmisc")
library(rstatix)
library(ggpubr)
library(broom)

        
# general rules:
# everything from the ES phase -> darkorchid
# everything from the EE phaes -> deepskyblue
```

# reading in the file

```{r}
file <- "C:/Cluster_Github/HDDM_Vero/data_sets/data_sets_Garcia/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file)
```

# Accuracy \~ overall value + absolute value



```{r}
es_data
```

# ES - number of fixations first, middle last fix

```{r}
data
```

```{r}

data <- read.csv(file)
excluded_subs <- c(99, 6)

# filter for ES
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs & !is.na(OV_num_2) & !is.na(AbsValueDiff_2) & !is.na(corr))

# fit models, extract coefficients
get_subject_estimates <- function(sub_data) {
  model <- lm(corr ~ OV_num_2 + AbsValueDiff_2, data = sub_data)
  summary_model <- summary(model)
  
  coefs <- summary_model$coefficients
  results <- tibble(
    sub_id = unique(sub_data$sub_id),
    predictor = rownames(coefs),
    beta_value = coefs[, "Estimate"],
    standard_error = coefs[, "Std. Error"],
    t_stat = coefs[, "t value"],
    p_value = coefs[, "Pr(>|t|)"],
    lower_CI = beta_value - 1.96 * standard_error,
    upper_CI = beta_value + 1.96 * standard_error
  )
  
  return(results)
}

subject_results <- es_data %>%
  group_split(sub_id) %>%
  map_dfr(get_subject_estimates)

# intercept can be temoved for lter plotting but doesnt have to
subject_results <- subject_results %>%
  filter(predictor != "(Intercept)")

output_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_Code_ES_LME_Accuracy_SubjectLevel_Results.csv"
write.csv(subject_results, output_file, row.names = FALSE)
print(subject_results)

```

# RT \~ Overall value + absolute value

```{r}
model_rtime <- lmer(rtime ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = es_data)
summary(model_rtime)

```

# Tab Model - Accuracy & RT

```{r}
tab_model(model_corr)
tab_model(model_rtime)
```

# beta coeff OV + AbsVD model

```{r}

# exclude specific subjects
excluded_subs <- c(99, 6)
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs & OV_num_2 != "" & !is.na(OV_num_2))

# Fit the mixed model for accuracy
model_corr <- lmer(corr ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = es_data)

# Extract fixed effects coefficients
betas_corr <- coef(summary(model_corr))
beta_corr_df <- as.data.frame(betas_corr)
beta_corr_df$Predictor <- rownames(beta_corr_df)
rownames(beta_corr_df) <- NULL
colnames(beta_corr_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

# Drop intercept, compute CIs, significance, and label positions
beta_corr_df <- beta_corr_df %>%
  filter(Predictor != "(Intercept)") %>%
  mutate(
    CI_Lower   = Estimate - 1.96 * SE,
    CI_Upper   = Estimate + 1.96 * SE,
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01  ~ "**",
      p < 0.05  ~ "*",
      TRUE      ~ "n.s."
    ),
    Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")),
    # If positive, put star just above CI_Upper; if negative, just below CI_Lower
    label_y   = ifelse(Estimate > 0, CI_Upper + 0.02, CI_Lower - 0.07)
  )

# Extract per‐subject random slopes
random_corr <- coef(model_corr)$sub_id[, c("OV_num_2", "AbsValueDiff_2")]
random_corr_df <- as.data.frame(random_corr) %>%
  rownames_to_column("sub_id") %>%
  pivot_longer(c("OV_num_2","AbsValueDiff_2"),
               names_to="Predictor", values_to="Beta") %>%
  mutate(Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")))

# Create the plot
plot_corr <- ggplot() +
  
  # Fixed‐effect bars
  geom_bar(data = beta_corr_df,
           aes(x = Predictor, y = Estimate, fill = Predictor),
           stat = "identity",
           alpha = 0.7,
           color = "black",
           width = 0.5,
           linewidth = 1) +
  
  # 95% CI error bars
  geom_errorbar(data = beta_corr_df,
                aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper),
                width = 0.05,
                color = "black",
                linewidth = 1) +
  
  # Individual subject slopes
  geom_jitter(data = random_corr_df,
              aes(x = Predictor, y = Beta),
              width = 0.1,
              fill = "white",
              color = "black",
              shape = 21,
              size = 4.5,
              alpha = 0.8,
              stroke = 1) +
  
  # Significance stars above or below depending on the sign
  geom_text(data = beta_corr_df,
            aes(x = Predictor, y = label_y, label = Significance),
            color = "black",
            size = 9,
            fontface = "bold") +
  
  # Zero line
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  
  # Labels & scales
  labs(title = "Beta Coefficients for OV and VD on Accuracy (ES Phase)",
       x = "",
       y = "Beta Coefficients") +
  scale_x_discrete(labels = c("OV_num_2" = "OV",
                              "AbsValueDiff_2" = "VD")) +
  scale_fill_manual(values = c("OV_num_2"        = "darkorchid",
                               "AbsValueDiff_2" = "darkorchid")) +
  
  # Theme tweaks
  theme_minimal() +
  theme(
    legend.position   = "none",
    panel.grid        = element_blank(),
    axis.line.y       = element_line(color = "black", linewidth = 1),
    axis.line.x       = element_blank(),
    axis.text         = element_text(size = 14, color = "black"),
    axis.title.y      = element_text(size = 16, color = "black"),
    plot.title        = element_text(size = 18, hjust = 0.5, color = "black"),
    panel.background  = element_rect(fill = "white", color = "white"),
    plot.background   = element_rect(fill = "white", color = "white")
  )

# Draw the plot
print(plot_corr)

# And if you want the model summary:
summary(model_corr)


ggsave(
  filename = "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_Accuracy_Model_Plot.svg",
  plot     = plot_corr,
  device   = "svg",
  width    = 8,
  height   = 6,
  dpi      = 300
)

# 2) Save the model summary to TXT (same path, but .txt)
output_txt <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_Accuracy_Model_Plot.txt"
sink(output_txt)
cat("### Linear Mixed Model for Accuracy (ES Phase) ###\n\n")
print(summary(model_corr))
sink()

```

# is E chocie dependend on first,middle, last fixation location?

```{r}
# ── 1. packages ────────────────────────────────────────────────────────────────
library(readr)    # read_csv()
library(dplyr)    # %>%  mutate()  filter()
library(lme4)     # glmer()
library(emmeans)  # pairwise contrasts

# ── 2. load & filter ───────────────────────────────────────────────────────────
excluded_subs <- c(1, 4, 5, 6, 14, 99)

df <- read_csv(
  "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
) %>% 
   filter(phase == "ES",          # keep ES phase only
         !sub_id %in% excluded_subs) %>% 
  mutate(left_chosen = as.integer(left_chosen))


mod0  <- glmer(left_chosen ~ 1                 + (1|sub_id), df, family = binomial)        # null
modESE<- glmer(left_chosen ~ ESE               + (1|sub_id), df, family = binomial)
modESS<- glmer(left_chosen ~ ESS               + (1|sub_id), df, family = binomial)
modEEE<- glmer(left_chosen ~ EEE               + (1|sub_id), df, family = binomial)
modEES<- glmer(left_chosen ~ EES               + (1|sub_id), df, family = binomial)

modSES<- glmer(left_chosen ~ SES               + (1|sub_id), df, family = binomial)
modSEE<- glmer(left_chosen ~ SEE               + (1|sub_id), df, family = binomial)
modSSS<- glmer(left_chosen ~ SSS               + (1|sub_id), df, family = binomial)
modSSE<- glmer(left_chosen ~ SSE               + (1|sub_id), df, family = binomial)

modES_first<- glmer(left_chosen ~ ES_first               + (1|sub_id), df, family = binomial)
modEE_first<- glmer(left_chosen ~ EE_first               + (1|sub_id), df, family = binomial)
modES_final<- glmer(left_chosen ~ ES_final               + (1|sub_id), df, family = binomial)
modEE_final<- glmer(left_chosen ~ EE_final               + (1|sub_id), df, family = binomial)
modSS_middle<- glmer(left_chosen ~ SS_middle               + (1|sub_id), df, family = binomial)
modSE_middle<- glmer(left_chosen ~ SE_middle               + (1|sub_id), df, family = binomial)

modFirstFix_Left<- glmer(left_chosen ~ FirstFix_Left               + (1|sub_id), df, family = binomial)
modFirstFix_Right<- glmer(left_chosen ~ FirstFix_Right               + (1|sub_id), df, family = binomial)


AICtab <- AIC(mod0, modESE, modESS, modEEE,modEES, modSES, modSEE,modSSS,modSSE,modES_first,modEE_first,modES_final,modEE_final,modSS_middle,modSE_middle,modFirstFix_Left,modFirstFix_Right)

print(AICtab[order(AICtab$AIC), ])          # lower AIC = better fit

anova(mod0, modEE_first,  test = "Chisq")  # repeat for the others

#fixef(modSSS)["SSS"]      # log-odds
#exp(fixef(modSSS)["SSS"]) # odds ratio

library(purrr)
library(broom)

# Put all models into a list
models <- list(
  modESE, modESS, modEEE, modEES, modSES, modSEE,
  modSSS, modSSE, modES_first, modEE_first,
  modES_final, modEE_final, modSS_middle, modSE_middle,
  modFirstFix_Left, modFirstFix_Right
)

model_names <- c(
  "ESE", "ESS", "EEE", "EES", "SES", "SEE",
  "SSS", "SSE", "ES_first", "EE_first",
  "ES_final", "EE_final", "SS_middle", "SE_middle",
  "FirstFix_Left", "FirstFix_Right"
)

# Run LRT against the null model and extract p-values
lrt_results <- map_df(models, ~ tidy(anova(mod0, .x, test = "Chisq")[2, ]),
                      .id = "model")

# Add model names
lrt_results$model <- model_names

# Apply Holm correction
lrt_results$p.value.corrected <- p.adjust(lrt_results$p.value, method = "bonferroni")

# Sort by raw p-value
lrt_results <- lrt_results[order(lrt_results$p.value), ]
lrt_results
#print(lrt_results[, c("model", "p.value", "p.value.corrected", "statistic", "Df")])

```

```{r}
library(dplyr)
library(broom.mixed)

nice_coefs <- tidy(best, conf.int = TRUE) %>%
  mutate(term = recode(term,
                       `(Intercept)` = "base (LLL ref.)",
                       first_sideR   = "first = Right",
                       mid_sideR     = "middle = Right",
                       last_sideR    = "last = Right")) %>%
  select(y.level, term, estimate, conf.low, conf.high, p.value) %>%
  arrange(y.level, desc(abs(estimate)))

print(nice_coefs, n = Inf)

```

```{r}
# exclude specific subjects
excluded_subs <- c(99, 6)
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs & OV_num_2 != "" & !is.na(OV_num_2))


# Fit the mixed model for accuracy
model_corr <- lmer(corr ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = ee_data)

# Extract fixed effects coefficients
betas_corr <- coef(summary(model_corr))
beta_corr_df <- as.data.frame(betas_corr)
beta_corr_df$Predictor <- rownames(beta_corr_df)
rownames(beta_corr_df) <- NULL
colnames(beta_corr_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

# Drop intercept, compute CIs, significance, and label positions
beta_corr_df <- beta_corr_df %>%
  filter(Predictor != "(Intercept)") %>%
  mutate(
    CI_Lower   = Estimate - 1.96 * SE,
    CI_Upper   = Estimate + 1.96 * SE,
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01  ~ "**",
      p < 0.05  ~ "*",
      TRUE      ~ "n.s."
    ),
    Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")),
    # If positive, put star just above CI_Upper; if negative, just below CI_Lower
    label_y   = ifelse(Estimate > 0, CI_Upper + 0.02, CI_Lower - 0.07)
  )

# Extract per‐subject random slopes
random_corr <- coef(model_corr)$sub_id[, c("OV_num_2", "AbsValueDiff_2")]
random_corr_df <- as.data.frame(random_corr) %>%
  rownames_to_column("sub_id") %>%
  pivot_longer(c("OV_num_2","AbsValueDiff_2"),
               names_to="Predictor", values_to="Beta") %>%
  mutate(Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")))

# Create the plot
plot_corr <- ggplot() +
  
  # Fixed‐effect bars
  geom_bar(data = beta_corr_df,
           aes(x = Predictor, y = Estimate, fill = Predictor),
           stat = "identity",
           alpha = 0.7,
           color = "black",
           width = 0.5,
           linewidth = 1) +
  
  # 95% CI error bars
  geom_errorbar(data = beta_corr_df,
                aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper),
                width = 0.05,
                color = "black",
                linewidth = 1) +
  
  # Individual subject slopes
  geom_jitter(data = random_corr_df,
              aes(x = Predictor, y = Beta),
              width = 0.1,
              fill = "white",
              color = "black",
              shape = 21,
              size = 4.5,
              alpha = 0.8,
              stroke = 1) +
  
  # Significance stars above or below depending on the sign
  geom_text(data = beta_corr_df,
            aes(x = Predictor, y = label_y, label = Significance),
            color = "black",
            size = 9,
            fontface = "bold") +
  
  # Zero line
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  
  # Labels & scales
  labs(title = "Beta Coefficients for OV and VD on Accuracy (EE Phase)",
       x = "",
       y = "Beta Coefficients") +
  scale_x_discrete(labels = c("OV_num_2" = "OV",
                              "AbsValueDiff_2" = "VD")) +
  scale_fill_manual(values = c("OV_num_2"        = "deepskyblue",
                               "AbsValueDiff_2" = "deepskyblue")) +
  
  # Theme tweaks
  theme_minimal() +
  theme(
    legend.position   = "none",
    panel.grid        = element_blank(),
    axis.line.y       = element_line(color = "black", linewidth = 1),
    axis.line.x       = element_blank(),
    axis.text         = element_text(size = 14, color = "black"),
    axis.title.y      = element_text(size = 16, color = "black"),
    plot.title        = element_text(size = 18, hjust = 0.5, color = "black"),
    panel.background  = element_rect(fill = "white", color = "white"),
    plot.background   = element_rect(fill = "white", color = "white")
  )

# Draw the plot
print(plot_corr)

# And if you want the model summary:
summary(model_corr)


ggsave(
  filename = "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_Accuracy_Model_Plot.svg",
  plot     = plot_corr,
  device   = "svg",
  width    = 8,
  height   = 6,
  dpi      = 300
)

# 2) Save the model summary to TXT (same path, but .txt)
output_txt <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_Accuracy_Model_Plot.txt"
sink(output_txt)
cat("### Linear Mixed Model for Accuracy (ES Phase) ###\n\n")
print(summary(model_corr))
sink()

```

```{r}
# 1) Fit the mixed model for reaction time

excluded_subs <- c(99, 6)
ee_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs & OV_num_2 != "" & !is.na(OV_num_2))


model_rtime <- lmer(rtime ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = es_data)

# 2) Extract fixed‐effect coefficients into a data.frame
betas_rtime <- coef(summary(model_rtime))
beta_rtime_df <- as.data.frame(betas_rtime)
beta_rtime_df$Predictor <- rownames(beta_rtime_df)
rownames(beta_rtime_df) <- NULL
colnames(beta_rtime_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

# 3) Drop intercept, compute CIs, significance stars, and y‐positions for labels
beta_rtime_df <- beta_rtime_df %>%
  filter(Predictor != "(Intercept)") %>%
  mutate(
    CI_Lower    = Estimate - 1.96 * SE,
    CI_Upper    = Estimate + 1.96 * SE,
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01  ~ "**",
      p < 0.05  ~ "*",
      TRUE      ~ "n.s."
    ),
    Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")),
    # If Estimate positive → star above CI_Upper; if negative → below CI_Lower
    label_y    = ifelse(Estimate > 0, CI_Upper + 0.02, CI_Lower - 0.07)
  )

# 4) Get per‐subject random slopes and tidy for plotting
random_rtime <- coef(model_rtime)$sub_id[, c("OV_num_2", "AbsValueDiff_2")]
random_rtime_df <- as.data.frame(random_rtime) %>%
  rownames_to_column("sub_id") %>%
  pivot_longer(c("OV_num_2","AbsValueDiff_2"), names_to="Predictor", values_to="Beta") %>%
  mutate(Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")))

# 5) Build the plot
plot_rtime <- ggplot() +
  # fixed‐effect bars
  geom_bar(data = beta_rtime_df,
           aes(x = Predictor, y = Estimate, fill = Predictor),
           stat = "identity", alpha = 0.7, color = "black",
           width = 0.5, linewidth = 1) +
  # 95% CI error bars
  geom_errorbar(data = beta_rtime_df,
                aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper),
                width = 0.05, color = "black", linewidth = 1) +
  # individual subject slopes
  geom_jitter(data = random_rtime_df,
              aes(x = Predictor, y = Beta),
              width = 0.1, fill = "white", color = "black",
              shape = 21, size = 4.5, alpha = 0.8, stroke = 1) +
  # significance stars above/below
  geom_text(data = beta_rtime_df,
            aes(x = Predictor, y = label_y, label = Significance),
            color = "black", size = 9, fontface = "bold") +
  # zero‐line
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  # labels & scales
  labs(title = "Beta Coefficients for OV and VD on RT (ES Phase)",
       x = "", y = "Beta Coefficients") +
  scale_x_discrete(labels = c("OV_num_2"        = "OV",
                              "AbsValueDiff_2" = "VD")) +
  scale_fill_manual(values = c("OV_num_2"        = "darkorchid",
                               "AbsValueDiff_2" = "darkorchid")) +
  # theme tweaks
  theme_minimal() +
  theme(
    legend.position   = "none",
    panel.grid        = element_blank(),
    axis.line.y       = element_line(color = "black", linewidth = 1),
    axis.line.x       = element_blank(),
    axis.text         = element_text(size = 14, color = "black"),
    axis.title.y      = element_text(size = 16, color = "black"),
    plot.title        = element_text(size = 18, hjust = 0.5, color = "black"),
    panel.background  = element_rect(fill = "white", color = "white"),
    plot.background   = element_rect(fill = "white", color = "white")
  )

# 6) Draw it
print(plot_rtime)

# 7) (Optional) Print model summary to console
summary(model_rtime)


# 8) Save the plot as SVG
ggsave(
  filename = "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_RTime_Model_Plot.svg",
  plot     = plot_rtime,
  device   = "svg",
  width    = 8,
  height   = 6,
  dpi      = 300
)

# 9) Save the model summary to TXT
txt_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_RTime_Model_Plot.txt"
sink(txt_path)
cat("### Linear Mixed Model for Reaction Times (ES Phase) ###\n\n")
print(summary(model_rtime))
sink()

```

```{r}
excluded_subs <- c(99, 6)
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs & OV_num_2 != "" & !is.na(OV_num_2))


model_rtime <- lmer(rtime ~ OV_num_2 + AbsValueDiff_2 + (1 | sub_id), data = ee_data)

# 2) Extract fixed‐effect coefficients into a data.frame
betas_rtime <- coef(summary(model_rtime))
beta_rtime_df <- as.data.frame(betas_rtime)
beta_rtime_df$Predictor <- rownames(beta_rtime_df)
rownames(beta_rtime_df) <- NULL
colnames(beta_rtime_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

# 3) Drop intercept, compute CIs, significance stars, and y‐positions for labels
beta_rtime_df <- beta_rtime_df %>%
  filter(Predictor != "(Intercept)") %>%
  mutate(
    CI_Lower    = Estimate - 1.96 * SE,
    CI_Upper    = Estimate + 1.96 * SE,
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01  ~ "**",
      p < 0.05  ~ "*",
      TRUE      ~ "n.s."
    ),
    Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")),
    # If Estimate positive → star above CI_Upper; if negative → below CI_Lower
    label_y    = ifelse(Estimate > 0, CI_Upper + 0.02, CI_Lower - 0.07)
  )

# 4) Get per‐subject random slopes and tidy for plotting
random_rtime <- coef(model_rtime)$sub_id[, c("OV_num_2", "AbsValueDiff_2")]
random_rtime_df <- as.data.frame(random_rtime) %>%
  rownames_to_column("sub_id") %>%
  pivot_longer(c("OV_num_2","AbsValueDiff_2"), names_to="Predictor", values_to="Beta") %>%
  mutate(Predictor = factor(Predictor, levels = c("OV_num_2", "AbsValueDiff_2")))

# 5) Build the plot
plot_rtime <- ggplot() +
  # fixed‐effect bars
  geom_bar(data = beta_rtime_df,
           aes(x = Predictor, y = Estimate, fill = Predictor),
           stat = "identity", alpha = 0.7, color = "black",
           width = 0.5, linewidth = 1) +
  # 95% CI error bars
  geom_errorbar(data = beta_rtime_df,
                aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper),
                width = 0.05, color = "black", linewidth = 1) +
  # individual subject slopes
  geom_jitter(data = random_rtime_df,
              aes(x = Predictor, y = Beta),
              width = 0.1, fill = "white", color = "black",
              shape = 21, size = 4.5, alpha = 0.8, stroke = 1) +
  # significance stars above/below
  geom_text(data = beta_rtime_df,
            aes(x = Predictor, y = label_y, label = Significance),
            color = "black", size = 9, fontface = "bold") +
  # zero‐line
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  # labels & scales
  labs(title = "Beta Coefficients for OV and VD on RT (ES Phase)",
       x = "", y = "Beta Coefficients") +
  scale_x_discrete(labels = c("OV_num_2"        = "OV",
                              "AbsValueDiff_2" = "VD")) +
  scale_fill_manual(values = c("OV_num_2"        = "deepskyblue",
                               "AbsValueDiff_2" = "deepskyblue")) +
  # theme tweaks
  theme_minimal() +
  theme(
    legend.position   = "none",
    panel.grid        = element_blank(),
    axis.line.y       = element_line(color = "black", linewidth = 1),
    axis.line.x       = element_blank(),
    axis.text         = element_text(size = 14, color = "black"),
    axis.title.y      = element_text(size = 16, color = "black"),
    plot.title        = element_text(size = 18, hjust = 0.5, color = "black"),
    panel.background  = element_rect(fill = "white", color = "white"),
    plot.background   = element_rect(fill = "white", color = "white")
  )

# 6) Draw it
print(plot_rtime)

# 7) (Optional) Print model summary to console
summary(model_rtime)


# 8) Save the plot as SVG
ggsave(
  filename = "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_RTime_Model_Plot.svg",
  plot     = plot_rtime,
  device   = "svg",
  width    = 8,
  height   = 6,
  dpi      = 300
)

# 9) Save the model summary to TXT
txt_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_RTime_Model_Plot.txt"
sink(txt_path)
cat("### Linear Mixed Model for Reaction Times (ES Phase) ###\n\n")
print(summary(model_rtime))
sink()

```

```{r}
ggplot() +
  # Bar plot of fixed effects
  geom_bar(data = beta_df, aes(x = Predictor, y = Estimate, fill = Predictor), 
           stat = "identity", alpha = 0.7, color = "black", width = 0.5) +
  
  geom_errorbar(data = beta_df, aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper), 
                width = 0.2, color = "black") +
  
  # individual participant estimates as jitter
  geom_jitter(data = random_effects_df, aes(x = Predictor, y = Beta), 
              width = 0.1, color = "black", size = 3, alpha = 0.8) +
  
  labs(title = "Beta Coefficients for Accuracy Model",
       x = "", y = "Beta Coefficients") +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_fill_manual(values = c("OV_num_2" = "purple", "AbsValueDiff_2" = "darkorchid"))

```

# ES - Accuracy by OV and AbsVD plot and stats

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# ES phase filtering
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, corr) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

# meaan and SE
summary_df <- es_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()), # SD/sqrt(n)
    .groups = 'drop'
  )

############### OV ##########################################################
# mean and SE per OV category
overall_summary <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary)
print(total_summary)

############## VD ###########################################################

# mean accuracy and SE per VD category
overall_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

############# plot ########################################################

p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_accuracy, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = mean_accuracy - se_accuracy, ymax = mean_accuracy + se_accuracy), 
                width = 0.08, linewidth = 0.8) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + 
  scale_color_manual(values = c("darkorchid1", "darkorchid3", "darkmagenta")) + 
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Accuracy by Overall Value and Absolute Value Difference - ES",
    x = "Overall Value",
    y = "Accuracy (%)",
    color = "Absolute Value"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_Accuracy_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p

# kruskal wallis test for comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(corr ~ OVcate_2)

posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(corr ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- ee_data %>%
  kruskal_test(corr ~ Abscate_2)

posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(corr ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")
```

# ES - RT by OV and AbsVD + plot + stats

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# filter for ES
es_data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, rtime) %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

print(colSums(is.na(es_data)))

# meaan and SE for RT
summary_df <- es_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_rtime = mean(rtime, na.rm = TRUE),
    se_rtime = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
################### OV #######################################################

# mean RT and SE per OV category
overall_summary_OV <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
total_summary_OV <- es_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_OV)
print(total_summary_OV)

#################### VD #####################################################

# mean RT and SE per VD
overall_summary_VD <- es_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()), 
    .groups = 'drop'
  )

total_summary_VD <- es_data %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

#########################################################################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_rtime, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = mean_rtime - se_rtime, ymax = mean_rtime + se_rtime), 
                width = 0.08, linewidth = 0.8) +  
  geom_hline(yintercept = median(summary_df$mean_rtime, na.rm = TRUE), 
             linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = c("darkorchid1", "darkorchid3", "darkmagenta")) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "RT by Overall Value and Absolute Value Difference - ES",
    x = "Overall Value",
    y = "Reaction Time (ms)",
    color = "Absolute Value"
  )

p

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_RTime_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")


################################################

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- es_data %>%
  kruskal_test(rtime ~ OVcate_2)
posthoc_accuracy_ov <- es_data %>%
  pairwise_wilcox_test(rtime ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- es_data %>%
  kruskal_test(rtime ~ Abscate_2)
posthoc_accuracy_abs <- es_data %>%
  pairwise_wilcox_test(rtime ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")

print(kruskal_accuracy_ov)
print(posthoc_accuracy_ov)
print(kruskal_accuracy_abs)
print(posthoc_accuracy_abs)

```

# EE- Accuracy by OV and AbsVD + plots + stats

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# ES phase filtering
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, corr) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

# meaan and SE
summary_df <- ee_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()), # SD/sqrt(n)
    .groups = 'drop'
  )

############### OV ##########################################################
# mean and SE per OV category
overall_summary <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_accuracy = mean(corr, na.rm = TRUE),
    se_accuracy = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary)
print(total_summary)

############## VD ###########################################################

# mean accuracy and SE per VD category
overall_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

total_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_accuracy_VD = mean(corr, na.rm = TRUE),
    se_accuracy_VD = sd(corr, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

############# plot ########################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_accuracy, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = mean_accuracy - se_accuracy, ymax = mean_accuracy + se_accuracy), 
                width = 0.08, linewidth = 0.8) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + 
  scale_color_manual(values = c("blue", "deepskyblue", "navy")) + 
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Accuracy by Overall Value and Absolute Value Difference - EE",
    x = "Overall Value",
    y = "Accuracy (%)",
    color = "Absolute Value"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_Accuracy_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(corr ~ OVcate_2)

posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(corr ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- ee_data %>%
  kruskal_test(corr ~ Abscate_2)

posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(corr ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")
```

# EE - RT by OV and AbsVD

```{r}
data <- read.csv(file, na.strings = c("", "NA"))
excluded_subs <- c(99, 6)

# filter for ES
ee_data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs) %>%
  drop_na(OVcate_2, Abscate_2, rtime) %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low", "medium", "high")),  # order
    Abscate_2 = factor(Abscate_2, levels = c("low", "medium", "high"))
  ) %>%
  droplevels()

print(colSums(is.na(ee_data)))

# meaan and SE for RT
summary_df <- ee_data %>%
  group_by(OVcate_2, Abscate_2) %>%
  summarise(
    mean_rtime = mean(rtime, na.rm = TRUE),
    se_rtime = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
################### OV #######################################################

# mean RT and SE per OV category
overall_summary_OV <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )
total_summary_OV <- ee_data %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime_OV = mean(rtime, na.rm = TRUE),
    se_rtime_OV = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_OV)
print(total_summary_OV)

#################### VD #####################################################

# mean RT and SE per VD
overall_summary_VD <- ee_data %>%
  group_by(Abscate_2) %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()), 
    .groups = 'drop'
  )

total_summary_VD <- ee_data %>%
  summarise(
    mean_rtime_VD = mean(rtime, na.rm = TRUE),
    se_rtime_VD = sd(rtime, na.rm = TRUE) / sqrt(n()) 
  )

print(overall_summary_VD)
print(total_summary_VD)

#########################################################################################################

# plot
p <- ggplot(summary_df, aes(x = OVcate_2, y = mean_rtime, group = Abscate_2, color = Abscate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = mean_rtime - se_rtime, ymax = mean_rtime + se_rtime), 
                width = 0.08, linewidth = 0.8) +  
  geom_hline(yintercept = median(summary_df$mean_rtime, na.rm = TRUE), 
             linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = c("blue", "deepskyblue", "navy")) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "RT by Overall Value and Absolute Value Difference - EE",
    x = "Overall Value",
    y = "Reaction Time (ms)",
    color = "Absolute Value"
  )

p

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_RTime_OV_Abs_dot_plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")


################################################

# kruskal wallis test comparing levels
kruskal_accuracy_ov <- ee_data %>%
  kruskal_test(rtime ~ OVcate_2)
posthoc_accuracy_ov <- ee_data %>%
  pairwise_wilcox_test(rtime ~ OVcate_2, paired = FALSE, p.adjust.method = "bonferroni")

kruskal_accuracy_abs <- es_data %>%
  kruskal_test(rtime ~ Abscate_2)
posthoc_accuracy_abs <- ee_data %>%
  pairwise_wilcox_test(rtime ~ Abscate_2, paired = FALSE, p.adjust.method = "bonferroni")

print(kruskal_accuracy_ov)
print(posthoc_accuracy_ov)
print(kruskal_accuracy_abs)
print(posthoc_accuracy_abs)

```

# ES - Eye-tracking (choose right, corr, rtime) (similar to CCTs paper)

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)


output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/ES_eye_predict/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

# dependent variable


dep_var <- "chose_right"  # others: 'corr', 'rtime', 'chose_right'

eye_metrics <- c("FinalFixLoc")

data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subs)

data <- data %>%
  mutate(
    OV = OV_2,
    VD = AbsValueDiff_2
  ) %>%
  select(-OV_2, -AbsValueDiff_2)


# z-score VD & OV & gaze metrics at  OV Level
data <- data %>%
  group_by(OV) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()

# z-score VD & eye metrics within individual sub_id
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1], 
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()


# loop through eye-tracking metrics
for (eye_metric in eye_metrics) {
  # interaction 
  interaction_term <- paste0("OV:", eye_metric)
  #logistic regression
  #glmer
  model <- glmer(as.formula(paste(dep_var, "~ OV *", eye_metric, "+ (1 | sub_id)")),data = data,family = binomial(link = "logit"))


  stats_file <- paste0(output_dir, "ES_Logistic_Model_", dep_var, "_", eye_metric, ".txt")

  # summary and tab_model
  sink(stats_file)
  cat("### Logistic Mixed Model - ES Phase ###\n\n")
  cat("#### Model Summary ####\n")
  print(summary(model)) 
  cat("\n#### Tab Model Output ####\n")
  print(tab_model(model, transform = NULL))  
  sink()

  #fixed effects + predictor names
  beta_df <- as.data.frame(coef(summary(model)))
  beta_df$Predictor <- rownames(beta_df)
  rownames(beta_df) <- NULL
  colnames(beta_df) <- c("Estimate", "SE", "z", "p", "Predictor")

  # get 95% CI
  beta_df <- beta_df %>%
    mutate(
      CI_Lower = Estimate - 1.96 * SE,  # CI Lower
      CI_Upper = Estimate + 1.96 * SE   # CI Upper
    ) %>%
    filter(Predictor != "(Intercept)") 
  # sig. display can be modified to include numbers
  beta_df <- beta_df %>%
    mutate(
      Significance = case_when(
        p < 0.001 ~ "***",
        p < 0.01 ~ "**",
        p < 0.05 ~ "*",
        TRUE ~ "" 
      )
    )

  # order
  beta_df <- beta_df %>%
  filter(Predictor %in% c(eye_metric, interaction_term))
  beta_df$Predictor <- factor(beta_df$Predictor, levels = c(eye_metric, interaction_term))
  output_path <- paste0(output_dir, "ES_", eye_metric, ".pdf")

  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.05, color = "black", linewidth = 1) +

    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.09, CI_Upper + 0.09), 
                  label = Significance),
              color = "black", size = 10, fontface = "bold") +  

    geom_hline(yintercept = 0, color = "black", linewidth = 1) +

    labs(title = paste("OV &", eye_metric, "on Symbolic Choice"),
         x = "", y = "Beta Coefficients") +
    
    scale_fill_manual(values = setNames(rep("darkorchid", 4), c("VD", "OV", eye_metric, interaction_term))) +    
    scale_x_discrete(labels = c("FinalFixLoc" = "FF",
                              "OV:FinalFixLoc" = "OV:FF")) +
    theme_minimal() +
    theme(
      legend.position = "none", 
      panel.grid = element_blank(), 
      axis.line.y = element_line(color = "black", linewidth = 1),  
      axis.line.x = element_blank(),  
      axis.text = element_text(size = 18, color = "black"), 
      axis.title = element_text(size = 18, color = "black"),  
      plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
      panel.background = element_rect(fill = "white", color = "white"),  
      plot.background = element_rect(fill = "white", color = "white") 
    )

  ggsave(output_path, plot = plot_figure, device = "pdf", width = 3, height = 5, dpi = 300)
  cat("saved log regression plot for", eye_metric, "as PDF at:", output_path, "\n")

}
plot_figure
summary(model)
tab_model(model, transform = NULL)  

```

```{r}
data
```

# EE - Eye-tracking (choose right, corr, rtime)

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)


output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/EE_eye_predict/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

# dependent variable


dep_var <- "chose_right"  # others: 'corr', 'rtime', 'chose_right'

eye_metrics <- c("DwellTimeAdvantage")

data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs)

data <- data %>%
  mutate(
    OV = OV_2,
    VD = AbsValueDiff_2
  ) %>%
  select(-OV_2, -AbsValueDiff_2)


# z-score VD & OV & gaze metrics at  OV Level
data <- data %>%
  group_by(OV) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()

# z-score VD & eye metrics within individual sub_id
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1], 
    across(all_of(eye_metrics), ~ scale(.x, center = TRUE, scale = TRUE)[,1]) 
  ) %>%
  ungroup()

# loop through eye-tracking metrics
for (eye_metric in eye_metrics) {
  # interaction 
  interaction_term <- paste0("OV:", eye_metric)
  #logistic regression
  #glmer
  model <- glmer(as.formula(paste(dep_var, "~ OV *", eye_metric, "+ (1 | sub_id)")),data = data,family = binomial(link = "logit"))


  stats_file <- paste0(output_dir, "EE_Logistic_Model_", dep_var, "_", eye_metric, ".txt")

  # summary and tab_model
  sink(stats_file)
  cat("### Logistic Mixed Model - EE Phase ###\n\n")
  cat("#### Model Summary ####\n")
  print(summary(model)) 
  cat("\n#### Tab Model Output ####\n")
  print(tab_model(model, transform = NULL))  
  sink()

  #fixed effects + predictor names
  beta_df <- as.data.frame(coef(summary(model)))
  beta_df$Predictor <- rownames(beta_df)
  rownames(beta_df) <- NULL
  colnames(beta_df) <- c("Estimate", "SE", "z", "p", "Predictor")

  # get 95% CI
  beta_df <- beta_df %>%
    mutate(
      CI_Lower = Estimate - 1.96 * SE,  # CI Lower
      CI_Upper = Estimate + 1.96 * SE   # CI Upper
    ) %>%
    filter(Predictor != "(Intercept)") 
  # sig. display can be modified to include numbers
  beta_df <- beta_df %>%
    mutate(
      Significance = case_when(
        p < 0.001 ~ "***",
        p < 0.01 ~ "**",
        p < 0.05 ~ "*",
        TRUE ~ "" 
      )
    )

  # order
  beta_df <- beta_df %>%
  filter(Predictor %in% c(eye_metric, interaction_term))
  beta_df$Predictor <- factor(beta_df$Predictor, levels = c(eye_metric, interaction_term))
  output_path <- paste0(output_dir, "EE_", eye_metric, ".pdf")

  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.05, color = "black", linewidth = 1) +

    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.09, CI_Upper + 0.09), 
                  label = Significance),
              color = "black", size = 10, fontface = "bold") +  

    geom_hline(yintercept = 0, color = "black", linewidth = 1) +

    labs(title = paste("OV &", eye_metric, "on Choosing Right"),
         x = "", y = "Beta Coefficients") +
    
    scale_fill_manual(values = setNames(rep("deepskyblue", 4), c("VD", "OV", eye_metric, interaction_term))) +    
    scale_x_discrete(labels = c("DwellTimeAdvantage" = "DTA",
                              "OV:DwellTimeAdvantage" = "OV:DTA")) +
    theme_minimal() +
    theme(
      legend.position = "none", 
      panel.grid = element_blank(), 
      axis.line.y = element_line(color = "black", linewidth = 1),  
      axis.line.x = element_blank(),  
      axis.text = element_text(size = 18, color = "black"), 
      axis.title = element_text(size = 18, color = "black"),  
      plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
      panel.background = element_rect(fill = "white", color = "white"),  
      plot.background = element_rect(fill = "white", color = "white") 
    )

  ggsave(output_path, plot = plot_figure, device = "pdf", width = 3, height = 5, dpi = 300)
  cat("saved log regression plot for", eye_metric, "as PDF at:", output_path, "\n")

}
plot_figure
summary(model)
tab_model(model, transform = NULL)  
```

# ES - AttentionW and InattentionW as predictors for accuracy and RT - Model comparison

```{r}


# folder for model comparison
base_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_model_comparisons_ES/"
dir.create(base_path, showWarnings = FALSE)

data <- read.csv("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs.csv") %>%
  filter(phase == "ES" & !sub_id %in% c(1, 4, 5, 6, 14, 99)) %>%
  rename(OV = OV_2) %>%
  group_by(sub_id) %>%
  mutate(across(c(OV, AttentionW, InattentionW), ~ scale(.)[,1]),
         rtime = scale(log(rtime))[,1]) %>%
  ungroup()
# log transfrom rtime

process_model <- function(model, model_name, dv_type = c("accuracy", "rt")) {
  dv_type <- match.arg(dv_type)
  # Save model summary
  summary_path <- paste0(base_path, model_name, "_summary.txt")
  sink(summary_path)
  cat(paste("###", toupper(dv_type), "MODEL:", model_name, "###\n\n"))
  print(summary(model))
  cat("\nR² (marginal/conditional):\n")
  print(r2(model))  
  sink()
  # get betas
 beta_df <- coef(summary(model)) %>%
  as.data.frame() %>%
  rownames_to_column("Predictor")

# Rename columns dynamically
if (dv_type == "accuracy") {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|z|)`)
} else {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|t|)`)
}


  beta_df <- beta_df %>%
    mutate(CI_Lower = Estimate - 1.96 * SE,
           CI_Upper = Estimate + 1.96 * SE) %>%
    filter(str_detect(Predictor, "OV:AttentionW|OV:InattentionW")) %>%
    mutate(Predictor = factor(Predictor, levels = c("OV:AttentionW", "OV:InattentionW")))

  plot_title <- ifelse(dv_type == "accuracy", "Accuracy", "Reaction Time")
  plot_path <- paste0(base_path, model_name, "_plot.svg")
  
  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.1, color = "black", linewidth = 1) +
    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05),
                  label = sprintf("p = %.3f", p)), color = "black", size = 8, fontface = "bold") +
    geom_hline(yintercept = 0, color = "black", linewidth = 1) +
    labs(title = paste("OV × (In)Attention on", plot_title), y = "Beta Coefficients", x = NULL) +
    scale_fill_manual(values = rep("darkorchid", 2)) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid = element_blank(),
      axis.line.y = element_line(color = "black", linewidth = 1),
      axis.line.x = element_blank(),
      axis.text = element_text(size = 20, color = "black"),
      axis.title.y = element_text(size = 20, color = "black"),
      plot.title = element_text(size = 20, hjust = 0.5, color = "black", face = "bold"),
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white")
    )

  ggsave(plot_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
}

# accuracy ~ model
m1_corr <- glmer(corr ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
m2_corr <- glmer(corr ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data, family = binomial)
m3_corr <- glmer(corr ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
process_model(m1_corr, "m1_corr", "accuracy")
process_model(m2_corr, "m2_corr", "accuracy")
process_model(m3_corr, "m3_corr", "accuracy")
anova(m1_corr, m2_corr, m3_corr) 

# rtime ~ model
m1_rt <- lmer(rtime ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data)
m2_rt <- lmer(rtime ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data)
m3_rt <- lmer(rtime ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data)
process_model(m1_rt, "m1_rt", "rt")
process_model(m2_rt, "m2_rt", "rt")
process_model(m3_rt, "m3_rt", "rt")
anova(m1_rt, m2_rt, m3_rt)  

# using AIC or BIC to compare (better option)
print(AIC(m1_corr, m2_corr, m3_corr))
print(AIC(m1_rt, m2_rt, m3_rt))

```

# EE - AttentionW and InattentionW as predictors for accuracy and RT - Model comparison

```{r}

# folder for model comparison
base_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_model_comparisons_EE/"
dir.create(base_path, showWarnings = FALSE)

data <- read.csv("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs.csv") %>%
  filter(phase == "EE" & !sub_id %in% c(1, 4, 5, 6, 14, 99)) %>%
  rename(OV = OV_2) %>%
  group_by(sub_id) %>%
  mutate(across(c(OV, AttentionW, InattentionW), ~ scale(.)[,1]),
         rtime = scale(log(rtime))[,1]) %>%
  ungroup()
# log transfrom rtime

process_model <- function(model, model_name, dv_type = c("accuracy", "rt")) {
  dv_type <- match.arg(dv_type)
  # Save model summary
  summary_path <- paste0(base_path, model_name, "_summary.txt")
  sink(summary_path)
  cat(paste("###", toupper(dv_type), "MODEL:", model_name, "###\n\n"))
  print(summary(model))
  cat("\nR² (marginal/conditional):\n")
  print(r2(model))  
  sink()
  # get betas
 beta_df <- coef(summary(model)) %>%
  as.data.frame() %>%
  rownames_to_column("Predictor")

# Rename columns dynamically
if (dv_type == "accuracy") {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|z|)`)
} else {
  beta_df <- beta_df %>%
    rename(Estimate = Estimate, SE = `Std. Error`, p = `Pr(>|t|)`)
}


  beta_df <- beta_df %>%
    mutate(CI_Lower = Estimate - 1.96 * SE,
           CI_Upper = Estimate + 1.96 * SE) %>%
    filter(str_detect(Predictor, "OV:AttentionW|OV:InattentionW")) %>%
    mutate(Predictor = factor(Predictor, levels = c("OV:AttentionW", "OV:InattentionW")))

  plot_title <- ifelse(dv_type == "accuracy", "Accuracy", "Reaction Time")
  plot_path <- paste0(base_path, model_name, "_plot.svg")
  
  plot_figure <- ggplot(beta_df, aes(x = Predictor, y = Estimate, fill = Predictor)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
    geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.1, color = "black", linewidth = 1) +
    geom_text(aes(y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05),
                  label = sprintf("p = %.3f", p)), color = "black", size = 8, fontface = "bold") +
    geom_hline(yintercept = 0, color = "black", linewidth = 1) +
    labs(title = paste("OV × (In)Attention on", plot_title), y = "Beta Coefficients", x = NULL) +
    scale_fill_manual(values = rep("deepskyblue", 2)) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid = element_blank(),
      axis.line.y = element_line(color = "black", linewidth = 1),
      axis.line.x = element_blank(),
      axis.text = element_text(size = 20, color = "black"),
      axis.title.y = element_text(size = 20, color = "black"),
      plot.title = element_text(size = 20, hjust = 0.5, color = "black", face = "bold"),
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white")
    )

  ggsave(plot_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
}

# accuracy ~ model
m1_corr <- glmer(corr ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
m2_corr <- glmer(corr ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data, family = binomial)
m3_corr <- glmer(corr ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data, family = binomial)
process_model(m1_corr, "m1_corr", "accuracy")
process_model(m2_corr, "m2_corr", "accuracy")
process_model(m3_corr, "m3_corr", "accuracy")
anova(m1_corr, m2_corr, m3_corr) 

# rtime ~ model
m1_rt <- lmer(rtime ~ OV:AttentionW + OV:InattentionW + (1 | sub_id), data = data)
m2_rt <- lmer(rtime ~ OV:AttentionW + InattentionW + (1 | sub_id), data = data)
m3_rt <- lmer(rtime ~ AttentionW + OV:InattentionW + (1 | sub_id), data = data)
process_model(m1_rt, "m1_rt", "rt")
process_model(m2_rt, "m2_rt", "rt")
process_model(m3_rt, "m3_rt", "rt")
anova(m1_rt, m2_rt, m3_rt)  

# using AIC or BIC to compare (better option)
print(AIC(m1_corr, m2_corr, m3_corr))
print(AIC(m1_rt, m2_rt, m3_rt))

```

```{r}
data <- read.csv(file_path)

data <- data %>%
  rename(OV = OV_2, VD = AbsValueDiff_2)
excluded_subs <- c(1, 4, 5, 6, 14, 99)

# ES filter
data <- data %>%
  filter(phase == "EE" & !sub_id %in% excluded_subs)

# Z-score OV and VD at the individual level (within each subject)
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    VD = scale(VD, center = TRUE, scale = TRUE)[,1],  # Z-score per subject
    OV = scale(OV, center = TRUE, scale = TRUE)[,1]   # Z-score per subject
  ) %>%
  ungroup()

# dependent variable
dep_var <- "FinalFixDur" # AttentionW or any other thing you want to test, e.g. first or final fixations

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

model_formula <- as.formula(paste(dep_var, "~ OV + VD + (1 | sub_id)"))
model <- lmer(model_formula, data = data)

# Extract fixed effects
betas <- coef(summary(model))
beta_df <- as.data.frame(betas)

beta_df$Predictor <- rownames(beta_df)
rownames(beta_df) <- NULL

colnames(beta_df) <- c("Estimate", "SE", "df", "t", "p", "Predictor")

beta_df <- beta_df %>%
  filter(Predictor != "(Intercept)")

# Compute 95% CI
beta_df <- beta_df %>%
  mutate(
    CI_Lower = Estimate - 1.96 * SE,
    CI_Upper = Estimate + 1.96 * SE
  )

# random slopes for visualization
random_effects <- coef(model)$sub_id[, c("OV", "VD")]

random_effects_df <- as.data.frame(random_effects) %>%
  rownames_to_column(var = "sub_id") %>%
  pivot_longer(cols = c("OV", "VD"), names_to = "Predictor", values_to = "Beta")

beta_df <- beta_df %>%
  mutate(
    Significance = case_when(
      p < 0.001 ~ "***",
      p < 0.01 ~ "**",
      p < 0.05 ~ "*",
      TRUE ~ "n.s."
    )
  )

# order
beta_df$Predictor <- factor(beta_df$Predictor, levels = c("OV", "VD"))
random_effects_df$Predictor <- factor(random_effects_df$Predictor, levels = c("OV", "VD"))

output_path <- paste0(output_dir, "ES_", dep_var, "on_OV_VD.svg")

# plot
plot_figure <- ggplot() +
  geom_bar(data = beta_df, aes(x = Predictor, y = Estimate, fill = Predictor), 
           stat = "identity", alpha = 0.7, color = "black", width = 0.5, linewidth = 1) +
  
  geom_errorbar(data = beta_df, aes(x = Predictor, ymin = CI_Lower, ymax = CI_Upper), 
                width = 0.05, color = "black", linewidth = 1) +
  
  geom_jitter(data = random_effects_df, aes(x = Predictor, y = Beta), 
              width = 0.1, fill = "white", color = "black", shape = 21, size = 4.5, alpha = 0.8, stroke = 1) +
  
  geom_text(data = beta_df, aes(x = Predictor, y = ifelse(Estimate < 0, CI_Lower - 0.05, CI_Upper + 0.05), label = Significance),
            color = "black", size = 9, fontface = "bold") +  
  
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  
  labs(title = paste("EE - Beta Coefficients for OV & VD on", dep_var),
       x = "", y = "Beta Coefficients") +
  
  scale_x_discrete(labels = c("OV", "VD")) +
  
  scale_fill_manual(values = setNames(rep("deepskyblue", 2), c("OV", "VD"))) +    
  
  theme_minimal() +
  theme(
    legend.position = "none", 
    panel.grid = element_blank(), 
    axis.line.y = element_line(color = "black", linewidth = 1),  
    axis.line.x = element_blank(),  
    axis.text = element_text(size = 18, color = "black"), 
    axis.title.y = element_text(size = 16, color = "black"),  
    plot.title = element_text(size = 18, hjust = 0.5, color = "black"), 
    panel.background = element_rect(fill = "white", color = "white"),  
    plot.background = element_rect(fill = "white", color = "white") 
  )

# save
ggsave(output_path, plot = plot_figure, device = "svg", width = 8, height = 6, dpi = 300)
cat("Saved plot as SVG at:", output_path, "\n")
print(plot_figure)
```

# ES - Dwell-Time Advantage

```{r}

data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right )

data <- data %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight > -1,          # ← keep only trials where both sides logged > 0 ms
    DwellLeft  > -1
  ) %>% 
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)


data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()



summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 18),  
    legend.title = element_text(size = 18),
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5,color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage on Choice - ES Phase",
    x = "Dwell Time Advantage (S > E)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DTA.pdf", 
       plot = p, width = 5, height = 6, device = "pdf", bg = "white"
       )

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# DTA split by E \> S, S \> E

```{r}
library(dplyr)
library(ggplot2)
library(lme4)
library(emmeans)
library(ez)

data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight > 0, DwellLeft > 0
  ) %>% 
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)          # DwellRight > 0, DwellLeft > 0

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low","medium","high"))

# 2) Define a new factor that splits on p1 vs. p2 values
#    (assuming your data has columns p1 and p2)
data <- data %>%
  mutate(val_cmp = if_else(p1 < p2, "E < S", "E > S"))

# 3) Quantile‐binning within each subject × OV level (unchanged)
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(
    DwellTimeAdvantage_bin = cut(
      DwellTimeAdvantage,
      breaks = unique(quantile(DwellTimeAdvantage, probs=seq(0,1,length.out=6), na.rm=TRUE)),
      labels = c("E>>S","E>S","E~S","S>E","S>>E"),
      include.lowest = TRUE
    )
  ) %>% ungroup()

# 4) Summarise for plotting
summary_df <- data %>%
  group_by(val_cmp, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm=TRUE),
    ci = 1.96 * sd(chose_right, na.rm=TRUE)/sqrt(n()),
    .groups="drop"
  )

# COLOUR PALETTE
colors <- c("low"="darkorchid1", "medium"="darkorchid3", "high"="darkmagenta")


p_facet <- ggplot(summary_df,
                  aes(x=DwellTimeAdvantage_bin, y=p_choose_right,
                      group=OVcate_2, color=OVcate_2)) +
  geom_point(size=4) +
  geom_line(linewidth=1.2) +
  geom_errorbar(aes(ymin=p_choose_right-ci, ymax=p_choose_right+ci),
                width=0.2, linewidth=0.8) +
  geom_hline(yintercept=0.5, linetype="dotted", color="gray50", linewidth=1) +
  scale_color_manual(values=colors, name="OV Level") +
  facet_wrap(~val_cmp, nrow=1) +
  theme_minimal() +
  theme(
    panel.grid=element_blank(),
    axis.line=element_line(color="black", linewidth=0.8),
    legend.position="top",
    legend.text=element_text(size=16),
    axis.text=element_text(size=19, color="black"),
    axis.title=element_text(size=20, color="black"),
    strip.text = element_text(size=18, face="bold")
  ) +
  labs(
    title="Dwell‐Time Advantage Effect on Choice by Value‐Comparison",
    x="Dwell Time Advantage (Symbolic > Experiential)",
    y="P(Choose Symbolic)"
  )

print(p_facet)
# ggsave("DwellTimeAdv_by_valcmp_facet.svg", plot=p_facet, width=12, height=6)

```

```{r}
library(tidyverse)
library(lme4); library(emmeans)


phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight > 0, DwellLeft > 0

  ) %>% 
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)          # DwellRight > 0, DwellLeft > 0

# 2. EARLY / LATE SPLIT -----------------------------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE) / 2
data <- data %>% mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 3. SET FACTORS ------------------------------------------------------------
data <- data %>% mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 4. ROBUST 5-QUANTILE BINNING PER RT GROUP --------------------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()

# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_right,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_right - ci,
                      ymax = p_choose_right + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Symbolic > Experiential)",
         y = "P(Choose Symbolic)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)


```

## Early late

```{r}
library(tidyverse)
library(lme4)   # optional, for the model

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN (no OV needed)
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight > -1, DwellLeft > -1
  ) %>% 
  drop_na(DwellTimeAdvantage, chose_right, rtime)

# 2) EARLY / LATE SPLIT (same rule as before)
threshold_rt <- mean(data$rtime, na.rm = TRUE) / 2
data <- data %>% mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 3) 5-QUANTILE BINNING per RT group
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()

# 4) SUMMARY FOR PLOT (collapse over OV)
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 5) PLOT (two lines: early vs late)
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_right,
                       group = RT_group, colour = RT_group)) +
  geom_point(size = 4) +
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = p_choose_right - ci,
                    ymax = p_choose_right + ci),
                width = .2, linewidth = .8) +
  geom_hline(yintercept = .5, linetype = "dotted",
             colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(early = "steelblue3", late = "firebrick3"),
                      name = "RT group") +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage (no OV stratification)",
       x = "Dwell-Time Advantage (Symbolic > Experiential)",
       y = "P(Choose Symbolic)")

# 6) OPTIONAL STATS: does Early vs Late differ across bins?
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~ RT_group * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# Early late - mean split

```{r}
library(tidyverse)
library(lme4)   # optional, for the model

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN (no OV needed)
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    LeftFixNR > 1, RightFixNR > 1
  ) %>% 
  drop_na(DwellTimeAdvantage, chose_right, rtime)


# 2) EARLY / LATE SPLIT (mean RT as threshold)
threshold_rt <- mean(data$rtime, na.rm = TRUE)
data <- data %>% 
  mutate(RT_group = if_else(rtime < threshold_rt, "early", "late"))

# 3) 5-QUANTILE BINNING per RT group
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()

# 4) SUMMARY FOR PLOT (collapse over OV)
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 5) PLOT (two lines: early vs late)
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_right,
                       group = RT_group, colour = RT_group)) +
  geom_point(size = 4) +
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = p_choose_right - ci,
                    ymax = p_choose_right + ci),
                width = .2, linewidth = .8) +
  geom_hline(yintercept = .5, linetype = "dotted",
             colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(early = "steelblue3", late = "firebrick3"),
                      name = "RT group") +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage (no OV stratification)",
       x = "Dwell-Time Advantage (Symbolic > Experiential)",
       y = "P(Choose Symbolic)")

# 6) OPTIONAL STATS: does Early vs Late differ across bins?
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~ RT_group * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# pie lower EV, image lower EV

```{r}
library(tidyverse)
library(lme4)   # optional, for the model

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN (no OV needed) — keep trials with >1 fixation on both sides
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    LeftFixNR > 1, RightFixNR > 1
  ) %>% 
  drop_na(DwellTimeAdvantage, chose_right, rtime, p1, p2)

# 2) VALUE-CONDITION SPLIT
# image lower EV: p1 < p2
# pie   lower EV: p2 < p1
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_   # ties dropped below
  )) %>% 
  filter(!is.na(EV_group))

# 3) 5-QUANTILE BINNING per VALUE group
data <- data %>% 
  group_by(EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()

# 4) SUMMARY FOR PLOT (collapse over OV)
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 5) PLOT (two lines: value-condition groups)
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_right,
                       group = EV_group, colour = EV_group)) +
  geom_point(size = 4) +
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = p_choose_right - ci,
                    ymax = p_choose_right + ci),
                width = .2, linewidth = .8) +
  geom_hline(yintercept = .5, linetype = "dotted",
             colour = "grey50", linewidth = 1) +
  scale_colour_manual(
    values = c(image_lowerEV = "steelblue3", pie_lowerEV = "firebrick3"),
    name   = "Value condition",
    labels = c("Image lower EV (p1 < p2)", "Pie chart lower EV (p2 < p1)")
  ) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage by Value Condition",
       x = "Dwell-Time Advantage (Symbolic > Experiential)",
       y = "P(Choose Symbolic)")

# 6) OPTIONAL STATS: does Value condition differ across bins?
agg_data <- data %>% 
  group_by(sub_id, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~ EV_group * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

```{r}
library(tidyverse)
library(lme4)   # optional, for the model

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN (keep trials with >1 fixation on both sides)
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    LeftFixNR > 0, RightFixNR > 0
  ) %>% 
  drop_na(DwellTimeAdvantage, chose_right, rtime, p1, p2)

# 2) VALUE-CONDITION SPLIT (drop ties)
# image lower EV: p1 < p2; pie lower EV: p2 < p1
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_
  )) %>% 
  filter(!is.na(EV_group))

# 3) EARLY / LATE SPLIT (mean RT threshold; after filtering)
threshold_rt <- mean(data$rtime, na.rm = TRUE)
data <- data %>% 
  mutate(RT_group = if_else(rtime < threshold_rt, "early", "late"))

# 4) 5-QUANTILE BINNING within each (RT_group × EV_group) cell
data <- data %>% 
  group_by(RT_group, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()

# 5) SUMMARY FOR PLOT
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(
    DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels),
    # nice facet ordering
    RT_group = factor(RT_group, levels = c("early","late")),
    EV_group = factor(EV_group, levels = c("image_lowerEV","pie_lowerEV"),
                      labels = c("Image lower EV (p1 < p2)", "Pie lower EV (p2 < p1)"))
  )

# 6) PLOT (2×2 facets: rows = early/late, cols = EV condition)
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_right, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_grid(RT_group ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage by RT group and Value condition",
       x = "Dwell-Time Advantage (Symbolic > Experiential)",
       y = "P(Choose Symbolic)")

# 7) OPTIONAL STATS: 2×2×5 ANOVA-style mixed model on subject means per cell
agg_data <- data %>% 
  group_by(sub_id, RT_group, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~ RT_group * EV_group * factor(DwellTimeAdvantage_bin) + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# only trials with 1 fixation

```{r}
library(tidyverse)
library(lme4)   # optional, for the model

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN (allow zeros so single-fixation trials survive)
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight >= 0, DwellLeft >= 0
  ) %>% 
  drop_na(DwellTimeAdvantage, chose_right, rtime)

# 1b) KEEP ONLY single-fixation trials -------------------------------
# Try several common column names for total fixation count
cand_total <- c("n_fix", "nFix", "Nfix", "FixCount", "n_fixations", "TotalFix", "TotalFixations")
fix_count_col <- cand_total[cand_total %in% names(data)][1]

if (!is.na(fix_count_col)) {
  # Case 1: total count available
  data <- data %>% filter(.data[[fix_count_col]] == 1)
} else if (all(c("FixCount_Left", "FixCount_Right") %in% names(data))) {
  # Case 2: per-side counts available
  data <- data %>% filter((FixCount_Left + FixCount_Right) == 1)
} else {
  # Case 3: fallback proxy — exactly one location was ever dwelled
  # (one side has dwell > 0 and the other is 0)
  data <- data %>% filter( (DwellRight > 0 & DwellLeft == 0) | (DwellLeft > 0 & DwellRight == 0) )
}

# Safety: if this created empty data, stop with a helpful message
if (nrow(data) == 0) {
  stop("No single-fixation trials found with the available columns/criteria. 
       Check that you have a fixation-count column or adjust the fallback rule.")
}

# 2) EARLY / LATE SPLIT (mean RT as threshold)
threshold_rt <- mean(data$rtime, na.rm = TRUE)
data <- data %>% 
  mutate(RT_group = if_else(

```

# Early late - within participant

```{r}

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    RightFixNR > 1, LeftFixNR > 1
  ) %>% 
  drop_na(FixationAdvantage, OVcate_2, chose_right)        #DwellRight > 0, DwellLeft > 0


# 2. SUBJECT-SPECIFIC EARLY / LATE SPLIT -----------------------------
data <- data %>% 
  group_by(sub_id) %>%                              # 1 subject at a time
  mutate(
    rt_median  = median(rtime, na.rm = TRUE),       # individual cut-off
    RT_group   = if_else(rtime <= rt_median,
                         "early", "late")           # label each trial
  ) %>% 
  ungroup()

# 3. SET FACTORS ------------------------------------------------------
data <- data %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    RT_group = factor(RT_group,  levels = c("early","late"))   # keep order
  )

# 4. 5-QUANTILE BINNING INSIDE *EACH* RT GROUP -----------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(FixationAdvantage, 5)) %>% 
  ungroup()


# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_right,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_right - ci,
                      ymax = p_choose_right + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Symbolic > Experiential)",
         y = "P(Choose Symbolic)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# try also fixation advantage

```{r}
phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    RightFixNR > 1, LeftFixNR > -1
  ) %>% 
  drop_na(FixationAdvantage_Corr, OVcate_2, corr)        #DwellRight > 0, DwellLeft > 0


# 2. SUBJECT-SPECIFIC EARLY / LATE SPLIT -----------------------------
data <- data %>% 
  group_by(sub_id) %>%                              # 1 subject at a time
  mutate(
    rt_median  = median(rtime, na.rm = TRUE),       # individual cut-off
    RT_group   = if_else(rtime <= rt_median,
                         "early", "late")           # label each trial
  ) %>% 
  ungroup()

# 3. SET FACTORS ------------------------------------------------------
data <- data %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    RT_group = factor(RT_group,  levels = c("early","late"))   # keep order
  )

# 4. 5-QUANTILE BINNING INSIDE *EACH* RT GROUP -----------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(FixationAdvantage_Corr, 5)) %>% 
  ungroup()


# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_corr,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_corr - ci,
                      ymax = p_corr + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Corr > Incorr)",
         y = "P(Choose Corr)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_corr ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)
```

```{r}
phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    DwellRight > 0, DwellLeft > 0
  ) %>% 
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)        #DwellRight > 0, DwellLeft > 0


# 2. SUBJECT-SPECIFIC EARLY / LATE SPLIT -----------------------------
data <- data %>% 
  group_by(sub_id) %>%                              # 1 subject at a time
  mutate(
    rt_median  = median(rtime, na.rm = TRUE),       # individual cut-off
    RT_group   = if_else(rtime <= rt_median,
                         "early", "late")           # label each trial
  ) %>% 
  ungroup()

# 3. SET FACTORS ------------------------------------------------------
data <- data %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    RT_group = factor(RT_group,  levels = c("early","late"))   # keep order
  )

# 4. 5-QUANTILE BINNING INSIDE *EACH* RT GROUP -----------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellTimeAdvantage, 5)) %>% 
  ungroup()


# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_right,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_right - ci,
                      ymax = p_choose_right + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Symbolic > Experiential)",
         y = "P(Choose Symbolic)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)
```

# DTA early late corr

```{r}

library(tidyverse)
library(lme4); library(emmeans)


phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
     DwellRight > 0, DwellLeft > 0
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr)          # DwellRight > 0, DwellLeft > 0

# 2. EARLY / LATE SPLIT -----------------------------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE) / 2
data <- data %>% mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 3. SET FACTORS ------------------------------------------------------------
data <- data %>% mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 4. ROBUST 5-QUANTILE BINNING PER RT GROUP --------------------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_corr - ci,
                      ymax = p_choose_corr + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Corr > Inc)",
         y = "P(Choose corr)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

## DTA correct/incorrect - mean threshold

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1. READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr, rtime)

# 2. EARLY / LATE SPLIT (mean RT as threshold) ------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE)
data <- data %>% 
  mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 3. SET FACTORS ------------------------------------------------------------
data <- data %>% mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 4. ROBUST 5-QUANTILE BINNING PER RT GROUP --------------------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 5. SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6. PLOTTER ---------------------------------------------------------------
make_plot <- function(df, rt_group){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_corr - ci,
                      ymax = p_choose_corr + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", rt_group, " trials)", sep=""),
         x = "Dwell-Time Advantage (Corr > Inc)",
         y = "P(Choose corr)")
}

for(rt in c("early","late")){
  print(make_plot(filter(summary_df, RT_group == rt), rt))
}

# 7. OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~
                    RT_group * OVcate_2 * DwellTimeAdvantage_bin +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# DTA - FirstFixLoc 1 or 2

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 1, Fix_sub > 1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr, FirstFixLoc) %>%
  # keep only valid first-fix codes 1 or 2
  filter(FirstFixLoc %in% c(1, 2)) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    FF_group = factor(if_else(FirstFixLoc == 1, "FirstFix = 1", "FirstFix = 2"),
                      levels = c("FirstFix = 1","FirstFix = 2"))
  )

# 2) 5-QUANTILE BINNING within FirstFix group ------------------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>% 
  group_by(FF_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 3) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(FF_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 4) PLOTTER ---------------------------------------------------------------
make_plot <- function(df, ff_label){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_corr - ci,
                      ymax = p_choose_corr + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1",
                                   medium="darkorchid3",
                                   high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", ff_label, ")", sep=""),
         x = "Dwell-Time Advantage (Corr > Inc)",
         y = "P(Choose correct)")
}

for(ff in levels(data$FF_group)){
  print(make_plot(filter(summary_df, FF_group == ff), ff))
}

# 5) OPTIONAL STATS ---------------------------------------------------------
# Subject means per cell and mixed model with FirstFix group instead of RT group
agg_data <- data %>% 
  group_by(sub_id, FF_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ FF_group * OVcate_2 * factor(DwellTimeAdvantage_bin) +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

# Pairwise bin tests within each (FF_group × OVcate_2), Holm-adjusted
emm_bins <- emmeans(lmm_model, ~ factor(DwellTimeAdvantage_bin) | FF_group * OVcate_2)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each FirstFix × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

```

# DTA FinalFixLoc 1 or 2

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 1, Fix_sub > 1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr, FinalFixLoc) %>%
  filter(FinalFixLoc %in% c(1, 2)) %>% 
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    FF_group = factor(if_else(FinalFixLoc == 1, "FinalFix = 1", "FinalFix = 2"),
                      levels = c("FinalFix = 1","FinalFix = 2"))
  )

# 2) 5-QUANTILE BINNING within FinalFix group ------------------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>% 
  group_by(FF_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 3) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(FF_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels))

# 4) PLOTTER ---------------------------------------------------------------
make_plot <- function(df, ff_label){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                 group = OVcate_2, colour = OVcate_2)) +
    geom_point(size = 4) +
    geom_line(linewidth = 1.2) +
    geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                  width = .2, linewidth = .8) +
    geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
    scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                        name = "OV level") +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage × OV level (", ff_label, ")", sep=""),
         x = "Dwell-Time Advantage (Corr > Inc)",
         y = "P(Choose correct)")
}

for(ff in levels(data$FF_group)){
  print(make_plot(filter(summary_df, FF_group == ff), ff))
}

# 5) OPTIONAL STATS ---------------------------------------------------------
# Subject means per cell; mixed model with FinalFix group (FF_group)
agg_data <- data %>% 
  group_by(sub_id, FF_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model
lmm_model <- lmer(mean_p_choose_corr ~ FF_group * OVcate_2 * factor(DwellTimeAdvantage_bin) +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

# Pairwise bin tests within each (FF_group × OVcate_2), Holm-adjusted
emm_bins <- emmeans(lmm_model, ~ factor(DwellTimeAdvantage_bin) | FF_group * OVcate_2)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each FinalFix × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

```

# DTA - FinalFixLoc and FirstFixLoc

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > - 1, Fix_sub > -1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr, FirstFixLoc, FinalFixLoc) %>%
  # keep only valid codes
  filter(FirstFixLoc %in% c(1,2), FinalFixLoc %in% c(1,2)) %>%
  # keep only trials where First and Final match (both 1 or both 2)
  filter((FirstFixLoc == 1 & FinalFixLoc == 2) | (FirstFixLoc == 2 & FinalFixLoc == 1)) %>%
  mutate(
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")),
    Seq_group = case_when(
      FirstFixLoc == 1 & FinalFixLoc == 2 ~ "First=1 & Final=1",
      FirstFixLoc == 2 & FinalFixLoc == 1 ~ "First=2 & Final=2"
    ),
    Seq_group = factor(Seq_group, levels = c("First=1 & Final=1","First=2 & Final=2"))
  )

# 2) 5-QUANTILE BINNING within sequence group ------------------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>%
  group_by(Seq_group) %>%
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>%
  ungroup()

# 3) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Seq_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels))

# 4) PLOT -------------------------------------------------------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_wrap(~ Seq_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage by First & Final Fixation (matching only) and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 5) OPTIONAL STATS ---------------------------------------------------------
# Subject means per cell
agg_data <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Seq_group, DTA_bin, OVcate_2) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept for subject)
lmm_model <- lmer(mean_p_choose_corr ~ Seq_group * OVcate_2 * DTA_bin + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

# Pairwise bin tests within each (Seq_group × OVcate_2), Holm-adjusted
emm_bins <- emmeans(lmm_model, ~ DTA_bin | Seq_group * OVcate_2)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each (First&Final) × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

```

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, FirstFixLoc, FinalFixLoc) %>%
  # keep only valid codes
  filter(FirstFixLoc %in% c(1,2), FinalFixLoc %in% c(1,2)) %>%
  # keep only trials where First and Final are opposite (as in your original code)
  filter((FirstFixLoc == 1 & FinalFixLoc == 2) | (FirstFixLoc == 2 & FinalFixLoc == 1)) %>%
  mutate(
   Seq_group = case_when(
     FirstFixLoc == 1 & FinalFixLoc == 2 ~ "First=1 & Final=2",
     FirstFixLoc == 2 & FinalFixLoc == 1 ~ "First=2 & Final=1"
   ) %>% factor(levels = c("First=1 & Final=2","First=2 & Final=1"))
 )

# 2) 5-QUANTILE BINNING within sequence group ------------------------------
data <- data %>%
  group_by(Seq_group) %>%
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>%
  ungroup()

# 3) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Seq_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels))

# 4) PLOT -------------------------------------------------------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_wrap(~ Seq_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Dwell-Time Advantage by First & Final Fixation (matching only)",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 5) OPTIONAL STATS ---------------------------------------------------------
# Subject means per cell
agg_data <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Seq_group, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept for subject), no OVcate term
lmm_model <- lmer(mean_p_choose_corr ~ Seq_group * DTA_bin + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

# Pairwise bin tests within each Seq_group, Holm-adjusted
emm_bins <- emmeans(lmm_model, ~ DTA_bin | Seq_group)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Seq_group (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

```

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 1, Fix_sub > 1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, rtime)

# 2) EARLY / LATE SPLIT (mean RT threshold) ---------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE)     # use median(...) if you prefer
data <- data %>% 
  mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 3) 5-QUANTILE BINNING within RT group ------------------------------------
data <- data %>% 
  group_by(RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 4) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels),
         RT_group = factor(RT_group, levels = c("early","late")))

# 5) PLOTTER (one line per plot) -------------------------------------------
make_plot <- function(df, rt_group, col = "steelblue3"){
  ggplot(df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
    geom_point(size = 4, colour = col) +
    geom_line(linewidth = 1.2, colour = col) +
    geom_errorbar(aes(ymin = p_choose_corr - ci,
                      ymax = p_choose_corr + ci),
                  width = .2, linewidth = .8, colour = col) +
    geom_hline(yintercept = .5, linetype = "dotted",
               colour = "grey50", linewidth = 1) +
    theme_minimal(base_size = 16) +
    theme(panel.grid = element_blank(),
          axis.line  = element_line(colour = "black"),
          plot.title = element_text(face = "bold", hjust = .5)) +
    labs(title = paste("Dwell-Time Advantage (", rt_group, " trials)", sep = ""),
         x = "Dwell-Time Advantage (Corr > Inc)",
         y = "P(Choose corr)")
}

# print early and late panels
print(make_plot(filter(summary_df, RT_group == "early"), "early"))
print(make_plot(filter(summary_df, RT_group == "late"),  "late", col = "firebrick3"))

# 6) OPTIONAL STATS (no OV factor) -----------------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ RT_group * factor(DwellTimeAdvantage_bin) + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# DTA correct/incorrect - EV

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > -1, Fix_sub > -1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, rtime, p1, p2)

# 2) VALUE SPLIT (drop ties; keep if you want as a 3rd group) --------------
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",  # image value < pie value
    p2 < p1 ~ "pie_lowerEV",    # pie value < image value
    TRUE    ~ NA_character_
  )) %>%
  filter(!is.na(EV_group))

# 3) EARLY / LATE SPLIT (median RT threshold) ------------------------------
threshold_rt <- median(data$rtime, na.rm = TRUE)  # use mean(...) if you prefer
data <- data %>% 
  mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# 4) 5-QUANTILE BINNING within each (RT_group × EV_group) ------------------
data <- data %>% 
  group_by(RT_group, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 5) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(RT_group, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(
    DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels),
    RT_group = factor(RT_group, levels = c("early","late")),
    EV_group = factor(EV_group, levels = c("image_lowerEV","pie_lowerEV"),
                      labels = c("Image lower EV (p1 < p2)", "Pie lower EV (p2 < p1)"))
  )

# 6) PLOT (2×2 facets: rows = early/late, cols = EV condition) -------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_grid(RT_group ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by RT and Value Condition",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 7) OPTIONAL STATS (subject means per cell) --------------------------------
agg_data <- data %>% 
  group_by(sub_id, RT_group, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ RT_group * EV_group * factor(DwellTimeAdvantage_bin) + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# DTA correct/incorrect - poor/good perfromer

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > -1, Fix_sub > -1
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, rtime)

# 2) DEFINE PERFORMER GROUPS (median split on accuracy per subject) ---------
subj_perf <- data %>%
  group_by(sub_id) %>%
  summarise(acc = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median <- median(subj_perf$acc, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf, by = "sub_id") %>%
  mutate(Performer = if_else(acc < acc_median, "poor", "good")) %>%
  mutate(Performer = factor(Performer, levels = c("poor","good")))

# 3) EARLY / LATE SPLIT (median RT threshold on filtered data) --------------
threshold_rt <- median(data$rtime, na.rm = TRUE)
data <- data %>% 
  mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"),
         RT_group = factor(RT_group, levels = c("early","late")))

# 4) 5-QUANTILE BINNING within (Performer × RT_group) ----------------------
data <- data %>% 
  group_by(Performer, RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 5) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Performer, RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(
    DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin, levels = 1:5, labels = bin_labels)
  )

# 6) PLOT (2×2 facets: rows = Performer, cols = RT_group) -------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_grid(Performer ~ RT_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer and RT group",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 7) OPTIONAL STATS: subject means per cell ---------------------------------
agg_data <- data %>% 
  group_by(sub_id, Performer, RT_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ Performer * RT_group * factor(DwellTimeAdvantage_bin) + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# DTA correct/incorrect - poor/good perfromer - OV

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, rtime, OVcate_2)

# Make OVcate an ordered factor
data <- data %>% mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 2) DEFINE PERFORMER GROUPS (median split on accuracy per subject) ---------
subj_perf <- data %>%
  group_by(sub_id) %>%
  summarise(acc = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median <- median(subj_perf$acc, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf, by = "sub_id") %>%
  mutate(Performer = if_else(acc < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))
# ----GLOBAL SPLIT
# 3) EARLY / LATE SPLIT (median RT threshold on filtered data) --------------
#threshold_rt <- mean(data$rtime, na.rm = TRUE)
#data <- data %>% 
#  mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"),
#         RT_group = factor(RT_group, levels = c("early","late")))



# ----- SUBJECT SPLIT

# 3) EARLY / LATE SPLIT (within-subject median RT) -------------------------
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    threshold_rt = median(rtime, na.rm = TRUE),       # per subject
    RT_group     = if_else(rtime <= threshold_rt, "early", "late")
  ) %>%
  ungroup() %>%
  mutate(RT_group = factor(RT_group, levels = c("early","late"))) %>%
  select(-threshold_rt)


# 4) 5-QUANTILE BINNING within (Performer × RT_group) ----------------------
# (Not by OVcate_2 — keeps the x-bins identical across the 3 lines in each panel)
data <- data %>% 
  group_by(Performer, RT_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()


# --- 5a) Subject means per cell -------------------------------------------
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%  # make sure it's a factor
  group_by(sub_id, Performer, RT_group, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# --- 5b) Mixed model -------------------------------------------------------
m_bin <- lmer(mean_p_choose_corr ~ Performer * RT_group * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

# --- 5c) Emmeans: pairwise bin tests within each (Performer × RT × OV) ----
library(emmeans)
emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * RT_group * OVcate_2)

# Get pairwise contrasts with Holm correction (within each stratum)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()

# quick sanity: see available columns
# print(names(pairwise_tbl))

# Only keep useful columns (keep 'p.value'!)
pairwise_tbl <- pairwise_tbl %>%
  relocate(Performer, RT_group, OVcate_2) %>%
  select(Performer, RT_group, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

# Significant pairs (uncorrected or corrected—choose one):
pairwise_sig_unc <- pairwise_tbl %>% filter(p.value < 0.05)
# (p.value here is already Holm-adjusted because we set adjust="holm")

print(pairwise_tbl, n = 50)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig_unc, n = 50)



# 6) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Performer, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT (2×2 facets: rows = Performer, cols = RT_group; 3 lines by OV) ---
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ RT_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer, RT group, and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 8) OPTIONAL STATS ---------------------------------------------------------
agg_data <- data %>% 
  group_by(sub_id, Performer, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ Performer * RT_group * OVcate_2 * factor(DwellTimeAdvantage_bin) +
                    (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

## split now based on LE preformance

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter_ES   <- "ES"
phase_perf_LE     <- "LE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 0) READ ONCE ---------------------------------------------------------------
data_all <- read_csv(file, show_col_types = FALSE)

# 1) PERFORMER GROUPS FROM LE PHASE (median split on accuracy) --------------
subj_perf_LE <- data_all %>%
  filter(
    phase == phase_perf_LE,
    !sub_id %in% excluded_subjects
  ) %>%
  drop_na(corr) %>%
  group_by(sub_id) %>%
  summarise(acc_LE = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median_LE <- median(subj_perf_LE$acc_LE, na.rm = TRUE)

# 2) ES DATA FOR ANALYSIS & PLOTS -------------------------------------------
data <- data_all %>%
  filter(
    phase == phase_filter_ES,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>%
  drop_na(DwellPropAdvantageCorrect, corr, rtime, OVcate_2) %>%
  mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high"))) %>%
  # attach LE accuracy + define Performer from LE
  left_join(subj_perf_LE, by = "sub_id") %>%
  filter(!is.na(acc_LE)) %>%
  mutate(
    Performer = if_else(acc_LE < acc_median_LE, "poor", "good"),
    Performer = factor(Performer, levels = c("poor","good"))
  )

# 3) EARLY / LATE SPLIT (mean RT threshold on ES data) -----------------------
#threshold_rt <- mean(data$rtime, na.rm = TRUE)
#data <- data %>%
#  mutate(
#    RT_group = if_else(rtime <= threshold_rt, "early", "late"),
#    RT_group = factor(RT_group, levels = c("early","late"))
#  )



# 3) EARLY / LATE SPLIT (within-subject median RT) -------------------------
data <- data %>%
  group_by(sub_id) %>%
  mutate(
    threshold_rt = median(rtime, na.rm = TRUE),       # per subject
    RT_group     = if_else(rtime <= threshold_rt, "early", "late")
  ) %>%
  ungroup() %>%
  mutate(RT_group = factor(RT_group, levels = c("early","late"))) %>%
  select(-threshold_rt)



# 4) 5-QUANTILE BINNING within (Performer × RT_group) -----------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>%
  group_by(Performer, RT_group) %>%
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>%
  ungroup()

# --- 5) STATS: pairwise tests among bins within each line & panel ----------
# Subject means per cell
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Performer, RT_group, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept per subject)
m_bin <- lmer(mean_p_choose_corr ~ Performer * RT_group * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

# Emmeans: pairwise bin tests within each (Performer × RT_group × OVcate_2)
emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * RT_group * OVcate_2)

# Pairwise contrasts of the 5 bins (Holm-adjusted within stratum)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble() %>%
  relocate(Performer, RT_group, OVcate_2) %>%
  select(Performer, RT_group, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

# Optional: print only significant pairs (Holm-adjusted p < .05)
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × RT × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 6) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>%
  group_by(Performer, RT_group, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT (2×2 facets: rows = Performer-from-LE, cols = ES early/late; 3 lines by OV) ---
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ RT_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "ES: Correct-vs-Incorrect Dwell Advantage by Performer (from LE), RT group, and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

```

# z-scored good/bad ES performer Dwell-time on correct/incorrect

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(z_DwellPropAdvantage, corr, rtime, OVcate_2, p1, p2) %>%
  mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 2) DEFINE PERFORMER GROUPS (median split on accuracy per subject) ---------
subj_perf <- data %>%
  group_by(sub_id) %>%
  summarise(acc = mean(corr, na.rm = TRUE), .groups = "drop")
acc_median <- median(subj_perf$acc, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf, by = "sub_id") %>%
  mutate(Performer = if_else(acc < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))

# 3) EV CONDITION (drop ties) -----------------------------------------------
# image lower EV: p1 < p2; pie lower EV: p2 < p1
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_
  )) %>%
  filter(!is.na(EV_group)) %>%
  mutate(EV_group = factor(EV_group,
                           levels = c("image_lowerEV","pie_lowerEV"),
                           labels = c("Image lower EV (p1 < p2)",
                                      "Pie lower EV (p2 < p1)")))

# 4) 5-QUANTILE BINNING within (Performer × EV_group) -----------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>% 
  group_by(Performer, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(z_DwellPropAdvantage, 5)) %>% 
  ungroup()

# --- 5) STATS: pairwise tests among bins within each line & panel ----------
# Subject means per cell
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%   # ensure factor 1..5
  group_by(sub_id, Performer, EV_group, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept per subject)
m_bin <- lmer(mean_p_choose_corr ~ Performer * EV_group * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

# Emmeans: pairwise bin tests within each (Performer × EV_group × OVcate_2)
emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * EV_group * OVcate_2)

# Pairwise contrasts of the 5 bins (Holm-adjusted within stratum)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble()

# Keep useful columns (include p.value!)
pairwise_tbl <- pairwise_tbl %>%
  relocate(Performer, EV_group, OVcate_2) %>%
  select(Performer, EV_group, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

# (Optional) show significant pairs (Holm-adjusted p < .05)
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × EV × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 6) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")  # Incorrect vs Correct dwell advantage labels
summary_df <- data %>% 
  group_by(Performer, EV_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT (2×2 facets: rows = Performer, cols = EV_group; 3 lines by OV) ---
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer, EV condition, and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")


```

# z-scored good/bad LE performer Dwell-time on correct/incorrect

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 0) READ ONCE ----------------------------------------------------------------
raw <- read_csv(file, show_col_types = FALSE)

# 1) DATA FOR PLOT (ES trials, same as before) --------------------------------
data <- raw %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(z_DwellPropAdvantage, corr, rtime, OVcate_2, p1, p2) %>%
  mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 2) DEFINE PERFORMER GROUPS **FROM LE PHASE** --------------------------------
subj_perf_LE <- raw %>%
  filter(
    phase == "LE",
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>%
  drop_na(corr) %>%
  group_by(sub_id) %>%
  summarise(acc_LE = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median <- median(subj_perf_LE$acc_LE, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf_LE, by = "sub_id") %>%
  filter(!is.na(acc_LE)) %>%  # ensure we have an LE accuracy for the subject
  mutate(Performer = if_else(acc_LE < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))

# 3) EV CONDITION (drop ties) --------------------------------------------------
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_
  )) %>%
  filter(!is.na(EV_group)) %>%
  mutate(EV_group = factor(EV_group,
                           levels = c("image_lowerEV","pie_lowerEV"),
                           labels = c("Image lower EV (p1 < p2)",
                                      "Pie lower EV (p2 < p1)")))

# 4) 5-QUANTILE BINNING within (Performer × EV_group) -------------------------
data <- data %>% 
  group_by(Performer, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(z_DwellPropAdvantage, 5)) %>% 
  ungroup()

# --- 5) STATS ----------------------------------------------------------------
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Performer, EV_group, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

m_bin <- lmer(mean_p_choose_corr ~ Performer * EV_group * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * EV_group * OVcate_2)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% 
  as_tibble() %>%
  relocate(Performer, EV_group, OVcate_2) %>%
  select(Performer, EV_group, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × EV × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 6) SUMMARY FOR PLOT ----------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Performer, EV_group, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT ----------------------------------------------------------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer (LE-based), EV condition, and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

```

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"                   # analyze ES trials
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 0) READ ONCE ----------------------------------------------------------------
raw <- read_csv(file, show_col_types = FALSE)

# 1) DATA FOR PLOT (ES trials) ------------------------------------------------
data <- raw %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(z_DwellPropAdvantage, corr, rtime, OVcate_2) %>%   # no p1/p2 needed now
  mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high")))

# 2) DEFINE PERFORMER GROUPS **FROM LE PHASE** --------------------------------
subj_perf_LE <- raw %>%
  filter(
    phase == "LE",
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>%
  drop_na(corr) %>%
  group_by(sub_id) %>%
  summarise(acc_LE = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median <- median(subj_perf_LE$acc_LE, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf_LE, by = "sub_id") %>%
  filter(!is.na(acc_LE)) %>%  # ensure we have an LE accuracy for the subject
  mutate(Performer = if_else(acc_LE < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))

# 3) 5-QUANTILE BINNING within **Performer** (no EV split) --------------------
data <- data %>% 
  group_by(Performer) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(z_DwellPropAdvantage, 5)) %>% 
  ungroup()

# 4) STATS --------------------------------------------------------------------
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Performer, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

m_bin <- lmer(mean_p_choose_corr ~ Performer * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * OVcate_2)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% 
  as_tibble() %>%
  relocate(Performer, OVcate_2) %>%
  select(Performer, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 5) SUMMARY FOR PLOT ---------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Performer, DwellTimeAdvantage_bin, OVcate_2) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6) PLOT ---------------------------------------------------------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ .) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer (LE-based) and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

```

# EV -split

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(z_DwellPropAdvantage, corr, rtime, p1, p2)

# 2) DEFINE PERFORMER GROUPS (median split on ES accuracy per subject) ------
subj_perf <- data %>%
  group_by(sub_id) %>%
  summarise(acc = mean(corr, na.rm = TRUE), .groups = "drop")
acc_median <- median(subj_perf$acc, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf, by = "sub_id") %>%
  mutate(Performer = if_else(acc < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))

# Replace your EV_group step with this
data <- data %>%
  mutate(
    p1s = if_else(p1 > 1, p1/100, p1),
    p2s = if_else(p2 > 1, p2/100, p2),
    EV_group = case_when(
      p1s < 0.4 & p2s < 0.4~ "Both low (<0.5)",
      p1s > 0.6 &p2s > 0.6~ "Both high (>0.5)",
      TRUE                  ~ NA_character_
    )
  ) %>%
  filter(!is.na(EV_group)) %>%
  mutate(EV_group = factor(EV_group, levels = c("Both low (<0.5)","Both high (>0.5)")))


# 4) 5-QUANTILE BINNING within (Performer × EV_group) -----------------------
data <- data %>% 
  group_by(Performer, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(z_DwellPropAdvantage, 5)) %>% 
  ungroup()

# --- 5) STATS: pairwise tests among bins within each panel -----------------
# Subject means per cell
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%   # ensure factor 1..5
  group_by(sub_id, Performer, EV_group, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept per subject)
m_bin <- lmer(mean_p_choose_corr ~ Performer * EV_group * DTA_bin + (1 | sub_id),
              data = agg_bin)

# Emmeans: pairwise bin tests within each (Performer × EV_group)
emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * EV_group)

# Pairwise contrasts of the 5 bins (Holm-adjusted within stratum)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble() %>%
  relocate(Performer, EV_group) %>%
  select(Performer, EV_group, contrast, estimate, SE, df, t.ratio, p.value)

# (Optional) show significant pairs (Holm-adjusted p < .05)
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × EV_group (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 6) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>% 
  group_by(Performer, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT (2×2 facets: rows = Performer, cols = EV_group; one line per panel) ---
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_grid(Performer ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer and joint EV level",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")


```

# same but now with LE performance median split

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

phase_filter_ES   <- "ES"
phase_perf_LE     <- "LE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 0) READ ONCE ---------------------------------------------------------------
data_all <- read_csv(file, show_col_types = FALSE)

# 1) PERFORMER GROUPS FROM LE PHASE (median split on accuracy) --------------
subj_perf_LE <- data_all %>%
  filter(
    phase == phase_perf_LE,
    !sub_id %in% excluded_subjects
  ) %>%
  drop_na(corr) %>%
  group_by(sub_id) %>%
  summarise(acc_LE = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median_LE <- median(subj_perf_LE$acc_LE, na.rm = TRUE)

# 2) ES DATA FOR ANALYSIS & PLOTS -------------------------------------------
data <- data_all %>%
  filter(
    phase == phase_filter_ES,
    !sub_id %in% excluded_subjects,
    Fix_opt > 1, Fix_sub > 1
  ) %>%
  drop_na(DwellPropAdvantageCorrect, corr, rtime, OVcate_2, p1, p2) %>%
  mutate(OVcate_2 = factor(OVcate_2, levels = c("low","medium","high"))) %>%
  # attach LE accuracy + define Performer from LE
  left_join(subj_perf_LE, by = "sub_id") %>%
  filter(!is.na(acc_LE)) %>%
  mutate(
    Performer = if_else(acc_LE < acc_median_LE, "poor", "good"),
    Performer = factor(Performer, levels = c("poor","good"))
  )

# 3) EV CONDITION (drop ties) -----------------------------------------------
# image lower EV: p1 < p2; pie lower EV: p2 < p1
data <- data %>%
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_
  )) %>%
  filter(!is.na(EV_group)) %>%
  mutate(EV_group = factor(EV_group,
                           levels = c("image_lowerEV","pie_lowerEV"),
                           labels = c("Image lower EV (p1 < p2)",
                                      "Pie lower EV (p2 < p1)")))

# 4) 5-QUANTILE BINNING within (Performer × EV_group) -----------------------
# (Not by OVcate_2 — keeps x-bins identical across the 3 lines in each panel)
data <- data %>%
  group_by(Performer, EV_group) %>%
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>%
  ungroup()

# --- 5) STATS: pairwise tests among bins within each line & panel ----------
# Subject means per cell
agg_bin <- data %>%
  mutate(DTA_bin = factor(DwellTimeAdvantage_bin)) %>%
  group_by(sub_id, Performer, EV_group, OVcate_2, DTA_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

# Mixed model (random intercept per subject)
m_bin <- lmer(mean_p_choose_corr ~ Performer * EV_group * OVcate_2 * DTA_bin + (1 | sub_id),
              data = agg_bin)

# Emmeans: pairwise bin tests within each (Performer × EV_group × OVcate_2)
emm_bins <- emmeans(m_bin, ~ DTA_bin | Performer * EV_group * OVcate_2)

# Pairwise contrasts of the 5 bins (Holm-adjusted within stratum)
pairwise_tbl <- summary(pairs(emm_bins, adjust = "holm")) %>% as_tibble() %>%
  relocate(Performer, EV_group, OVcate_2) %>%
  select(Performer, EV_group, OVcate_2, contrast, estimate, SE, df, t.ratio, p.value)

# Optional: print only significant pairs (Holm-adjusted p < .05)
pairwise_sig <- pairwise_tbl %>% filter(p.value < 0.05)

cat("\n==== Pairwise DTA-bin contrasts within each Performer × EV × OV level (Holm-adjusted) ====\n")
print(pairwise_tbl, n = 100)
cat("\n---- Significant (Holm-adjusted p < .05) ----\n")
print(pairwise_sig, n = 100)

# 6) SUMMARY FOR PLOT -------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")
summary_df <- data %>%
  group_by(Performer, EV_group, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 7) PLOT (2×2 facets: rows = Performer-from-LE, cols = EV_group; 3 lines by OV) ---
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr,
                       group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  scale_colour_manual(values = c(low="darkorchid1", medium="darkorchid3", high="darkmagenta"),
                      name = "OV level") +
  facet_grid(Performer ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "ES: Correct-vs-Incorrect Dwell Advantage by Performer (from LE), EV condition, and OV",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")


```

# DTA correct/incorrect - poor/good EV split

```{r}
library(tidyverse)
library(lme4); library(emmeans)

phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# 1) READ & CLEAN -----------------------------------------------------------
data <- read_csv(file, show_col_types = FALSE) %>% 
  filter(
    phase == phase_filter,
    !sub_id %in% excluded_subjects,
    Fix_opt > 0, Fix_sub > 0
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, corr, rtime, p1, p2)

# 2) DEFINE PERFORMER GROUPS (median split on subject accuracy in ES) -------
subj_perf <- data %>%
  group_by(sub_id) %>%
  summarise(acc = mean(corr, na.rm = TRUE), .groups = "drop")

acc_median <- median(subj_perf$acc, na.rm = TRUE)

data <- data %>%
  left_join(subj_perf, by = "sub_id") %>%
  mutate(Performer = if_else(acc < acc_median, "poor", "good"),
         Performer = factor(Performer, levels = c("poor","good")))

# 3) EV CONDITION (drop ties) -----------------------------------------------
# image lower EV: p1 < p2; pie lower EV: p2 < p1
data <- data %>% 
  mutate(EV_group = case_when(
    p1 < p2 ~ "image_lowerEV",
    p2 < p1 ~ "pie_lowerEV",
    TRUE    ~ NA_character_
  )) %>%
  filter(!is.na(EV_group)) %>%
  mutate(EV_group = factor(EV_group,
                           levels = c("image_lowerEV","pie_lowerEV"),
                           labels = c("Image lower EV (p1 < p2)",
                                      "Pie lower EV (p2 < p1)")))

# 4) 5-QUANTILE BINNING within (Performer × EV_group) -----------------------
data <- data %>% 
  group_by(Performer, EV_group) %>% 
  mutate(DwellTimeAdvantage_bin = ntile(DwellPropAdvantageCorrect, 5)) %>% 
  ungroup()

# 5) SUMMARY FOR PLOT --------------------------------------------------------
bin_labels <- c("I>>C","I>C","C~I","C>I","C>>I")   # I = Incorrect, C = Correct
summary_df <- data %>% 
  group_by(Performer, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>% 
  mutate(DwellTimeAdvantage_bin = factor(DwellTimeAdvantage_bin,
                                         levels = 1:5,
                                         labels = bin_labels))

# 6) PLOT (2×2 facets: rows = Performer, cols = EV_group) -------------------
ggplot(summary_df, aes(DwellTimeAdvantage_bin, p_choose_corr, group = 1)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci),
                width = .2, linewidth = .6) +
  geom_hline(yintercept = .5, linetype = "dotted", colour = "grey50", linewidth = 1) +
  facet_grid(Performer ~ EV_group) +
  theme_minimal(base_size = 16) +
  theme(panel.grid = element_blank(),
        axis.line  = element_line(colour = "black"),
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = "Correct-vs-Incorrect Dwell Advantage by Performer and EV condition",
       x = "Dwell-Time Advantage (Corr > Inc)",
       y = "P(Choose correct)")

# 7) OPTIONAL STATS: subject means per cell ---------------------------------
agg_data <- data %>% 
  group_by(sub_id, Performer, EV_group, DwellTimeAdvantage_bin) %>% 
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_corr ~ Performer * EV_group * factor(DwellTimeAdvantage_bin) + (1 | sub_id),
                  data = agg_data)
anova(lmm_model)

```

# ES - Dwell-time Advantage RT

```{r}
###############################################################################
#  Dwell-time Advantage  →  Reaction Time  (ES phase)
###############################################################################
library(tidyverse)
library(lme4)
library(emmeans)
library(ez)
library(broom)

# ── file paths ───────────────────────────────────────────────────────────────
#file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

#results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/OV_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DwellTimeAdvantage_RT_Results.txt"
#plot_file    <- "D:/Aberdeen_Uni_June24/cap/THESIS/OV_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DwellTimeAdvantage_RT.svg"

phase_filter      <- "EE"
excluded_subjects <- c()   #1, 4, 5, 6, 14, 9
rt_column         <- "rtime"   # <-- change if needed
set.seed(123)

# ── 1. read & filter ────────────────────────────────────────────────────────
data <- read_csv(file, show_col_types = FALSE) %>%
  filter(phase == phase_filter,
         !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, !!sym(rt_column))

data$OVcate_2 <- factor(data$OVcate_2,
                        levels = c("low", "medium", "high"))

# ── 2. 5-tile binning with ntile()  (per subject × OV) ──────────────────────
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DTA_bin_idx = ntile(DwellTimeAdvantage, 5)) %>%   # 1 … 5
  ungroup() %>%
  mutate(DTA_bin = factor(DTA_bin_idx,
                          levels = 1:5,
                          labels = c("L>>R", "L>R", "L~R", "R>L", "R>>L")))

# ── 3. summarise mean RT (+95 % CI) per bin × OV ────────────────────────────
summary_df <- data %>%
  group_by(DTA_bin, OVcate_2) %>%
  summarise(
    mean_rt = mean(.data[[rt_column]], na.rm = TRUE),
    ci      = 1.96 * sd(.data[[rt_column]], na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

# ── 4. plot ─────────────────────────────────────────────────────────────────
cols <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")

p <- ggplot(summary_df,
            aes(DTA_bin, mean_rt, group = OVcate_2, colour = OVcate_2)) +
  geom_point(size = 4) +
  geom_line(linewidth = 1.2) +
  geom_errorbar(aes(ymin = mean_rt - ci, ymax = mean_rt + ci),
                width = .2, linewidth = .8) +
  scale_colour_manual(values = cols, name = "OV Level") +
  theme_minimal(base_size = 18) +
  theme(
    panel.grid  = element_blank(),
    axis.line   = element_line(colour = "black", linewidth = .8),
    legend.position = "top"
  ) +
  labs(
    title = "Dwell-Time Advantage - RT (EE phase) - EXP1",
    x     = "Dwell-time Advantage (R > L)",
    y     = "Mean Response Time (ms)"
  )

#ggsave(plot_file, p, width = 8, height = 6, device = "svg", bg = "white")
print(p)

# ── 5. statistics ───────────────────────────────────────────────────────────
agg_rt <- data %>%
  group_by(sub_id, DTA_bin, OVcate_2) %>%
  summarise(mean_rt = mean(.data[[rt_column]], na.rm = TRUE), .groups = "drop")

## 5a  two-way LMM
lmm_rt    <- lmer(mean_rt ~ OVcate_2 * DTA_bin + (1 | sub_id), data = agg_rt)
anova_lmm <- tidy(anova(lmm_rt))

## 5b  pair-wise bin contrasts (Bonferroni)
pw_bins <- emmeans(lmm_rt, "DTA_bin") |>
           contrast("pairwise", adjust = "bonferroni") |>
           as.data.frame()

## 5c  one-way rm-ANOVA on bins
ez_rt <- ezANOVA(
  data     = agg_rt,
  dv       = mean_rt,
  wid      = sub_id,
  within   = DTA_bin,
  type     = 3,
  detailed = TRUE
)

pw_rmanova <- emmeans(
  lm(mean_rt ~ factor(DTA_bin), data = agg_rt),
  pairwise ~ DTA_bin,
  adjust = "bonferroni"
) |> as.data.frame()

# ── 6. round p’s to 3 decimals ──────────────────────────────────────────────
round_p <- \(df) df %>%
  mutate(across(matches("p\\.value|Pr\\(>F\\)|p.value"),
                ~ round(.x, 3)))

anova_lmm  <- round_p(anova_lmm)
pw_bins    <- round_p(pw_bins)
pw_rmanova <- round_p(pw_rmanova)

# ── 7. save results ---------------------------------------------------------
#sink(results_file)

#cat("\n===== 2-way LMM  (OV × Bin) =====\n")
#print(anova_lmm)

#cat("\n----- Pair-wise bin contrasts (Bonferroni) -----\n")
#print(pw_bins)

#cat("\n===== 1-way repeated-measures ANOVA on bins =====\n")
#print(ez_rt)

#cat("\n----- Pair-wise bin contrasts (Bonferroni, rm-ANOVA) -----\n")
#print(pw_rmanova)

#sink()
#cat("\nResults saved to:", results_file, "\n")


```

# ES - p(chose E vs S) per gaze bin

```{r}
library(tidyverse)
library(ggplot2)


data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)
 
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

## ----------------------------------------------------------
## 1.  Subject-level probabilities for choosing E vs S
## ----------------------------------------------------------
# chose_right == 0  ➜  “E” chosen
# chose_right == 1  ➜  “S” chosen
agg <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(
    p_E = mean(chose_right == 0, na.rm = TRUE),
    p_S = mean(chose_right == 1, na.rm = TRUE),
    .groups = "drop"
  ) %>%                                # long format makes life easier for ggplot
  pivot_longer(cols = c(p_E, p_S),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice,
                         levels = c("p_E", "p_S"),
                         labels = c("E", "S")))

## ----------------------------------------------------------
## 2.  Grand-mean ± SEM for each gaze bin × choice
## ----------------------------------------------------------
summary_df <- agg %>%
  group_by(DwellTimeAdvantage_bin, Choice) %>%
  summarise(
    mean_prob = mean(prob, na.rm = TRUE),
    sem       = sd(prob,  na.rm = TRUE) / sqrt(n()),   # SEM across participants
    .groups   = "drop"
  )

## keep the descriptive bin labels you used before
summary_df$DwellTimeAdvantage_bin <- factor(
  summary_df$DwellTimeAdvantage_bin,
  levels = 1:5,
  labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E")
)

## ----------------------------------------------------------
## 3.  Bar plot with SEM
## ----------------------------------------------------------
p <- ggplot(summary_df,
            aes(x = DwellTimeAdvantage_bin,
                y = mean_prob,
                fill = Choice)) +
  geom_col(position = position_dodge(width = 0.8),
           width     = 0.75) +
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width     = 0.2,
                linewidth = 0.7,
                position  = position_dodge(width = 0.8)) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_fill_manual(values = c("E" = "steelblue", "S" = "darkorchid"),
                    name   = "Chosen option") +
  labs(title = "Probability of Choosing E vs S by Gaze Bin (ES Phase)",
       x     = "Dwell-Time Advantage Bin",
       y     = "Probability") +
  theme_minimal(base_size = 15) +
  theme(
    legend.position   = "top",
    axis.line         = element_line(colour = "black"),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank()
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/Figures/ES_DwellTimeAdvantage_E_vs_S.svg",
       plot   = p,
       width  = 8,
       height = 6,
       device = "svg",
       bg     = "white")

print(p)

```

# ES - p (corr) per gaze bin

```{r}

library(tidyverse)
library(ggplot2)


data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, corr)
 
data <- data %>%
  group_by(sub_id) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

## ----------------------------------------------------------
agg <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(
    p_C = mean(corr == 1, na.rm = TRUE),
    p_I = mean(corr == 0, na.rm = TRUE),
    .groups = "drop"
  ) %>%                                # long format makes life easier for ggplot
  pivot_longer(cols = c(p_C, p_I),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice,
                         levels = c("p_C", "p_I"),
                         labels = c("Correct", "Incorrect")))

## ----------------------------------------------------------
## 2.  Grand-mean ± SEM for each gaze bin × choice
## ----------------------------------------------------------
summary_df <- agg %>%
  group_by(DwellTimeAdvantage_bin, Choice) %>%
  summarise(
    mean_prob = mean(prob, na.rm = TRUE),
    sem       = sd(prob,  na.rm = TRUE) / sqrt(n()),   
    .groups   = "drop"
  )


## keep the descriptive bin labels you used before
summary_df$DwellTimeAdvantage_bin <- factor(
  summary_df$DwellTimeAdvantage_bin,
  levels = 1:5,
  labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E")
)

## ----------------------------------------------------------
## 3.  Bar plot with SEM
## ----------------------------------------------------------
p <- ggplot(summary_df,
            aes(x = DwellTimeAdvantage_bin,
                y = mean_prob,
                fill = Choice)) +
  geom_col(position = position_dodge(width = 0.8),
           width     = 0.75) +
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width     = 0.2,
                linewidth = 0.7,
                position  = position_dodge(width = 0.8)) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_fill_manual(values = c("Correct" = "grey", "Incorrect" = "orange"),
                    name   = "Choice") +
  labs(title = "Probability of correct choice by gaze bin (ES Phase)",
       x     = "Dwell-time adv. bin (S-E)",
       y     = "Probability") +
  theme_minimal(base_size = 15) +
  theme(
    legend.position   = "top",
    axis.line         = element_line(colour = "black"),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank()
  )


print(p)


```

# ES - p(E vs S) per rtime bin

```{r}
library(tidyverse)
library(ggplot2)

library(tidyverse)
library(ggplot2)

data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)    # 1, 4, 5, 6, 14, 99

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(rtime_bin = cut(rtime, 
                         breaks = unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                         labels = 1:(length(unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                         include.lowest = TRUE)) %>%
  ungroup()

## ----------------------------------------------------------
## 1.  Subject-level probabilities for choosing E vs S
## ----------------------------------------------------------
# chose_right == 0  ➜  “E” chosen
# chose_right == 1  ➜  “S” chosen
agg <- data %>%
  group_by(sub_id, rtime_bin) %>%
  summarise(
    p_E = mean(chose_right == 0, na.rm = TRUE),
    p_S = mean(chose_right == 1, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(p_E, p_S),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice,
                         levels = c("p_E", "p_S"),
                         labels = c("E", "S")))

## ----------------------------------------------------------
## 2.  Grand-mean ± SEM for each gaze bin × choice
## ----------------------------------------------------------
summary_df <- agg %>%
  group_by(rtime_bin, Choice) %>%
  summarise(
    mean_prob = mean(prob, na.rm = TRUE),
    sem       = sd(prob,  na.rm = TRUE) / sqrt(n()),   # SEM across participants
    .groups   = "drop"
  )

## keep the descriptive bin labels you used before
summary_df$rtime_bin <- factor(
  summary_df$rtime_bin,
  levels = 1:5,
  labels = c("0-20%", "20-40%", "40-60%", "60-80%", "80-100%")
)

p <- ggplot(summary_df,
            aes(x = rtime_bin,
                y = mean_prob,
                group = Choice,
                color = Choice)) +
  geom_line(linewidth = 1) +  # straight lines only
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width = 0.15,
                linewidth = 0.7) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_color_manual(values = c("E" = "deepskyblue", "S" = "darkorchid"),
                     name   = "Chosen option") +
  labs(title = "Probability of Choosing E vs S-Option by Reaction Time Quintile",
       x     = "RT Bin (shortest to longest RT)",
       y     = "Probability") +
  coord_cartesian(ylim = c(0.30, 0.70)) +   # y-axis from 0.20 to 0.70
  theme_minimal(base_size = 15) +
  theme(
    legend.position = c(0.85, 0.90),  # (x,y) in [0,1], relative to plot panel
    legend.background = element_rect(fill = "white", color = NA),  # white box for readability
    legend.key = element_rect(fill = NA, color = NA),  
    legend.title = element_text(size = 16),
    legend.text  = element_text(size = 16),
  axis.line         = element_line(colour = "black"),
  panel.grid.major  = element_blank(),
  panel.grid.minor  = element_blank(),
  axis.text.x       = element_text(color = "black", size = 16),  # tick labels
  axis.text.y       = element_text(color = "black", size = 18),  # tick labels
  axis.title.x      = element_text(size = 18),                   # axis title
  axis.title.y      = element_text(size = 18)                    # axis title
)


ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/Figures/ES_rtimeAdvantage_E_vs_S_lines.pdf",
       plot   = p,width  = 6,height = 5,device = "pdf",bg     = "white")

print(p)

```

# combined Study 1 & 2 - chose E vs S per RT bin

```{r}
library(tidyverse)
library(ggplot2)

file1 <- "C:/Cluster_Github/HDDM_Vero/data_sets/data_sets_Garcia/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

file2 <- "C:/Cluster_Github/HDDM_Vero/data_sets/data_sets_OV/OVParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

# ---- Study 1 ----
data1 <- read.csv(file1)   # Garcia data
phase_filter <- "ES"
excluded_subjects1 <- c(1, 4, 5, 6, 14, 99)

data1 <- data1 %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects1) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right) %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(rtime_bin = cut(rtime,
                         breaks = unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                         labels = 1:(length(unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                         include.lowest = TRUE)) %>%
  ungroup()

agg1 <- data1 %>%
  group_by(sub_id, rtime_bin) %>%
  summarise(
    p_E = mean(chose_right == 0, na.rm = TRUE),
    p_S = mean(chose_right == 1, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(p_E, p_S),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice, levels = c("p_E", "p_S"), labels = c("E", "S")))

summary1 <- agg1 %>%
  group_by(rtime_bin, Choice) %>%
  summarise(mean_prob = mean(prob, na.rm = TRUE),
            sem       = sd(prob, na.rm = TRUE)/sqrt(n()),
            .groups = "drop") %>%
  mutate(Study = "Study1")

# ---- Study 2 ----
data2 <- read.csv(file2)   # OV data
excluded_subjects2 <- c(6, 14, 20, 26, 2, 9, 18)

data2 <- data2 %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects2) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right) %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(rtime_bin = cut(rtime,
                         breaks = unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                         labels = 1:(length(unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                         include.lowest = TRUE)) %>%
  ungroup()

agg2 <- data2 %>%
  group_by(sub_id, rtime_bin) %>%
  summarise(
    p_E = mean(chose_right == 0, na.rm = TRUE),
    p_S = mean(chose_right == 1, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(p_E, p_S),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice, levels = c("p_E", "p_S"), labels = c("E", "S")))

summary2 <- agg2 %>%
  group_by(rtime_bin, Choice) %>%
  summarise(mean_prob = mean(prob, na.rm = TRUE),
            sem       = sd(prob, na.rm = TRUE)/sqrt(n()),
            .groups = "drop") %>%
  mutate(Study = "Study2")

# ---- Combine both studies ----
summary_df <- bind_rows(summary1, summary2)

summary_df$rtime_bin <- factor(summary_df$rtime_bin,
                               levels = 1:5,
                               labels = c("0-20%", "20-40%", "40-60%", "60-80%", "80-100%"))

# ---- Plot ----
p <- ggplot(summary_df,
            aes(x = rtime_bin, y = mean_prob,
                group = interaction(Choice, Study),
                color = Choice, linetype = Study)) +
  geom_line(linewidth = 1) +
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width = 0.15, linewidth = 0.6) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_color_manual(values = c("E" = "deepskyblue", "S" = "darkorchid"),
                     name = "Chosen option") +
  scale_linetype_manual(values = c("Study1" = "solid", "Study2" = "longdash"),
                        name = "Study") +
  labs(title = "Probability of Choosing E vs S-Option by RT Quintile",
       x = "RT Bin (shortest to longest RT)", y = "Probability") +
  coord_cartesian(ylim = c(0.20, 0.70)) +
  theme_minimal(base_size = 15) +
  theme(
    legend.position   = "top",
    legend.key.size   = unit(0.8, "cm"),
    axis.line         = element_line(colour = "black"),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank(),
    axis.text.x       = element_text(color = "black", size = 14),
    axis.text.y       = element_text(color = "black", size = 14)
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/Figures/Combined_ES_rtimeAdvantage_E_vs_S_lines.svg",
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)

```






# GLMM - chocie E vs S per RT bin
```{r}
library(tidyverse)
library(lme4)

# --------------------------
# 1. Preprocessing
# --------------------------
data <- read.csv(file)

excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == "ES",
         !sub_id %in% excluded_subjects,
         rtime >= 0.25,   # RT >= 250 ms
         rtime <= 8.0) %>% # RT <= 8000 ms
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

# Bin RTs globally
brks <- quantile(data$rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)

data <- data %>%
  mutate(rtime_bin = cut(rtime,
                         breaks = brks,
                         labels = 1:5,
                         include.lowest = TRUE))

# recode choice: 1 = E, 0 = S
data$chooseE <- as.integer(data$chose_right == 0)

# --------------------------
# 2. Trial-level GLMM per bin
# --------------------------
by_bin <- lapply(levels(data$rtime_bin), function(b) {
  d <- filter(data, rtime_bin == b)
  
  # model: log-odds of choosing E, random intercepts for subjects
  m <- glmer(chooseE ~ 1 + (1|sub_id),
             data = d,
             family = binomial,
             control = glmerControl(optimizer="bobyqa"))
  
  est <- fixef(m)[1]
  se  <- sqrt(vcov(m)[1,1])
  z   <- est/se
  p   <- 2*pnorm(-abs(z))
  
  data.frame(
    rtime_bin = b,
    n_trials  = nrow(d),
    n_subj    = length(unique(d$sub_id)),
    prop_hat  = plogis(est),
    logit_est = est,
    se        = se,
    z         = z,
    p_value   = p
  )
})

glmm_results <- bind_rows(by_bin)
print(glmm_results)


```




```{r}
library(tidyverse)
library(lme4)
library(emmeans)

# --------------------------
# 1. Preprocessing
# --------------------------
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- read.csv(file) %>%
  filter(phase == "ES",
         !sub_id %in% excluded_subjects,
         rtime >= 0.25,   # >= 250 ms
         rtime <= 8.0) %>% # <= 8000 ms
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right) %>%
  mutate(
    chooseE = as.integer(chose_right == 0),
    log_rtime = scale(log(rtime)) # log + z-scale for stability
  )

# --------------------------
# 2. Mixed logistic model
# --------------------------
m <- glmer(chooseE ~ log_rtime + (1|sub_id),
           data = data,
           family = binomial,
           control = glmerControl(optimizer="bobyqa"))

summary(m)

# --------------------------
# 3. Predicted probabilities at quantiles
# --------------------------
# Pick the 20% (fast RTs) and 80% (slow RTs) quantiles
q <- quantile(data$log_rtime, probs = c(0.2, 0.8), na.rm = TRUE)

preds <- emmeans(m, ~ log_rtime,
                 at = list(log_rtime = q),
                 type = "response") # gives probabilities

print(preds)

```


```{r}

library(tidyverse)
library(lme4)
library(emmeans)

# --------------------------
# 1. Preprocessing
# --------------------------
excluded_subjects <- c(6, 99)

data <- read.csv(file) %>%
  filter(phase == "ES",
         !sub_id %in% excluded_subjects,
         rtime >= 0.25,   # >= 250 ms
         rtime <= 8.0) %>% # <= 8000 ms
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right) %>%
  mutate(
    chooseE = as.integer(chose_right == 0),
    log_rtime = scale(log(rtime)) # log + z-scale for stability
  )

# --------------------------
# 2. Mixed logistic model
# --------------------------
m <- glmer(chooseE ~ log_rtime + (1|sub_id),
           data = data,
           family = binomial,
           control = glmerControl(optimizer="bobyqa"))

summary(m)

# get predictions at the 5 bin midpoints
q_edges <- quantile(data$log_rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)
q_mid <- (head(q_edges, -1) + tail(q_edges, -1)) / 2

preds_mid <- emmeans(m, ~ log_rtime,
                     at = list(log_rtime = q_mid),
                     type = "link")  # keep logit scale for tests

# Test each estimated logit vs 0 (logit(0.5))
tests <- contrast(preds_mid, method = "eff", by = NULL)  # 'eff' compares vs 0
summary(tests, infer = TRUE)




```

# fixation by fixation 
```{r}
library(tidyverse)
library(jsonlite)
library(lme4)
library(broom.mixed)

MAX_BACK <- 4
excluded_subjects <- c(1,4, 5, 6, 14, 99)

# Step 1: Load and preprocess
dat <- read.csv(file)
es <- dat %>%
  filter(phase == "ES", !sub_id %in% excluded_subjects) %>%
  drop_na(sub_id, rtime, Fixations)

# Step 2: Fixation parsing
parse_fixes <- function(x){
  if (is.null(x) || is.na(x) || x=="") return(NULL)
  if (is.list(x)) return(as.data.frame(x))
  try1 <- tryCatch(fromJSON(x, simplifyDataFrame=TRUE), error=function(e) NULL)
  if (!is.null(try1)) return(as.data.frame(try1))
  x2 <- gsub("'", "\"", x)
  try2 <- tryCatch(fromJSON(x2, simplifyDataFrame=TRUE), error=function(e) NULL)
  if (!is.null(try2)) return(as.data.frame(try2))
  NULL
}

gather_fixseq <- function(fix_str, rt_sec, back_cap=MAX_BACK){
  fx <- parse_fixes(fix_str)
  if (is.null(fx) || nrow(fx)==0 || !all(c("start_time","roi") %in% names(fx))) return(character(0))
  fx <- fx %>% arrange(start_time)
  t0 <- fx$start_time[1]; rt_ms <- rt_sec * 1000
  usable <- fx %>%
    mutate(rel_start = start_time - t0) %>%
    filter(rel_start <= rt_ms, roi %in% c(1,2))
  if (nrow(usable) == 0) return(character(0))
  lab <- ifelse(usable$roi == 1, "E", "S")
  rev(lab)[seq_len(min(length(lab), back_cap + 1))]
}

# Step 3: Build long table
es_seq <- es %>%
  mutate(fix_seq = map2(Fixations, rtime, gather_fixseq)) %>%
  filter(map_int(fix_seq, length) > 1)

fix_long <- es_seq %>%
  transmute(sub_id,
            fix_idx_list = map(fix_seq, ~ seq(0, length(.x) - 1)),
            label_list   = fix_seq) %>%
  unnest(c(fix_idx_list, label_list)) %>%
  rename(fix_idx = fix_idx_list, label = label_list) %>%
  filter(fix_idx <= MAX_BACK) %>%
  mutate(label = factor(label, levels = c("S", "E")),  # S is reference
         y = as.integer(label == "E"))

# Step 4: Fix model (don't create y manually, just use label)
model_results <- map_dfr(0:MAX_BACK, function(idx) {
  df_i <- fix_long %>%
    filter(fix_idx == idx) %>%
    filter(!sub_id %in% excluded_subjects)  # re-apply exclusion here

  if (n_distinct(df_i$sub_id) < 6) return(NULL)  # too few subjects
  
  model <- tryCatch(
    glmer(label ~ 1 + (1 | sub_id), data = df_i, family = binomial),
    error = function(e) NULL
  )
  
  if (is.null(model)) return(NULL)
  
  tidy(model, effects = "fixed") %>%
    mutate(fix_idx = idx, x = ifelse(idx == 0, 0, -idx))
})

# Step 5: Format output
ttests <- model_results %>%
  transmute(
    fix_idx,
    x,
    beta    = estimate,
    se      = std.error,
    z       = statistic,
    p_raw   = p.value
  ) %>%
  mutate(p_fdr = p.adjust(p_raw, method = "BH")) %>%
  arrange(fix_idx)

print(ttests, n = Inf)

```
# mean nr of fixtions
```{r}
es_seq <- es %>%
  mutate(fix_seq = map2(Fixations, rtime, gather_fixseq)) %>%
  filter(map_int(fix_seq, length) > 1)


# Add a column for number of fixations per trial
es_seq <- es_seq %>%
  mutate(n_fix = map_int(fix_seq, length))

# Mean number of fixations
mean_fixations <- mean(es_seq$n_fix)

# Optional: also get SD, median, etc.
sd_fixations <- sd(es_seq$n_fix)
median_fixations <- median(es_seq$n_fix)

mean_fixations
sd_fixations
```

# ES - p(corr) per rtime bin

```{r}
library(tidyverse)
library(ggplot2)


data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(6, 99)    #1, 4, 5, 6, 14, 99

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)
 
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(rtime_bin = cut(rtime, 
                                      breaks = unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(rtime, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

## ----------------------------------------------------------
## 1.  Subject-level probabilities for choosing E vs S
## ----------------------------------------------------------
# chose_right == 0  ➜  “E” chosen
# chose_right == 1  ➜  “S” chosen
agg <- data %>%
  group_by(sub_id, rtime_bin) %>%
  summarise(
    p_C = mean(corr == 1, na.rm = TRUE),
    p_I = mean(corr == 0, na.rm = TRUE),
    .groups = "drop"
  ) %>%                                # long format makes life easier for ggplot
  pivot_longer(cols = c(p_C, p_I),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice,
                         levels = c("p_C", "p_I"),
                         labels = c("Correct", "Incorrect")))

## ----------------------------------------------------------
## 2.  Grand-mean ± SEM for each gaze bin × choice
## ----------------------------------------------------------
summary_df <- agg %>%
  group_by(rtime_bin, Choice) %>%
  summarise(
    mean_prob = mean(prob, na.rm = TRUE),
    sem       = sd(prob,  na.rm = TRUE) / sqrt(n()),   # SEM across participants
    .groups   = "drop"
  )

## keep the descriptive bin labels you used before
summary_df$rtime_bin <- factor(
  summary_df$rtime_bin,
  levels = 1:5,
  labels = c("0-20%", "20-40%", "40-60%", "60-80%", "80-100%")
)

## ----------------------------------------------------------
## 3.  Bar plot with SEM
## ----------------------------------------------------------
p <- ggplot(summary_df,
            aes(x = rtime_bin,
                y = mean_prob,
                fill = Choice)) +
  geom_col(position = position_dodge(width = 0.8),
           width     = 0.75) +
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width     = 0.2,
                linewidth = 0.7,
                position  = position_dodge(width = 0.8)) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_fill_manual(values = c("Correct" = "grey", "Incorrect" = "orange"),
                    name   = "Choice") +
  labs(title = "Probability of correct choice by RT bin (ES Phase)",
       x     = "RT Bin (shortest to longest RT)",
       y     = "Probability") +
  theme_minimal(base_size = 15) +
  theme(
    legend.position   = "top",
    axis.line         = element_line(colour = "black"),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank()
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/Figures/ES_correctAdvantage_E_vs_S.svg",
       plot   = p,
       width  = 8,
       height = 6,
       device = "svg",
       bg     = "white")

print(p)
```

# ES - p(chose E vs S) per accuracy bin

```{r}
library(tidyverse)

# ----------------------------------------------------------
# 1.  Load & filter
# ----------------------------------------------------------
data <- read.csv(file)
phase_filter      <- "ES"
excluded_subjects <- c()   # e.g. c(1,4,5,6,14,99)

data <- read.csv(file, stringsAsFactors = FALSE) %>%
  filter(phase == phase_filter,
         !sub_id %in% excluded_subjects) %>%
  drop_na(corr, chose_right)

# ----------------------------------------------------------
# 2.  Subject-level ACCURACY RATE  (continuous 0–1)
# ----------------------------------------------------------
acc_tbl <- data %>%
  group_by(sub_id) %>%
  summarise(acc_rate = mean(corr), .groups = "drop")

# attach the accuracy rate to every trial
data <- left_join(data, acc_tbl, by = "sub_id")

# assign each participant to an accuracy-quintile bin
data <- data %>%
  mutate(acc_bin = ntile(acc_rate, 5),          # 1–5
         acc_bin = factor(acc_bin,
                          levels = 1:5,
                          labels = c("0–20 %", "20–40 %", "40–60 %",
                                     "60–80 %", "80–100 %")))

# ----------------------------------------------------------
# 3.    P(E) vs P(S) per accuracy bin (subject-level first)
# ----------------------------------------------------------
agg <- data %>%
  group_by(sub_id, acc_bin) %>%
  summarise(
    p_E = mean(chose_right == 0),   # chose E
    p_S = mean(chose_right == 1),   # chose S
    .groups = "drop"
  ) %>%
  pivot_longer(c(p_E, p_S),
               names_to  = "Choice",
               values_to = "prob") %>%
  mutate(Choice = factor(Choice,
                         levels = c("p_E", "p_S"),
                         labels = c("E", "S")))

# group-level mean ± SEM
summary_df <- agg %>%
  group_by(acc_bin, Choice) %>%
  summarise(mean_prob = mean(prob),
            sem       = sd(prob) / sqrt(n()),
            .groups   = "drop")

# ----------------------------------------------------------
# 4.  Plot
# ----------------------------------------------------------
p <- ggplot(summary_df,
            aes(x = acc_bin,
                y = mean_prob,
                fill = Choice)) +
  geom_col(position = position_dodge(0.8), width = 0.75) +
  geom_errorbar(aes(ymin = mean_prob - sem,
                    ymax = mean_prob + sem),
                width = 0.2,
                position = position_dodge(0.8)) +
  geom_hline(yintercept = 0.5, linetype = "dotted") +
  scale_fill_manual(values = c("E" = "steelblue",
                               "S" = "darkorchid"),
                    name   = "Chosen option") +
  labs(title = "Probability of Choosing E vs S by Accuracy Quintile (ES Phase)",
       x     = "Participant accuracy quintile",
       y     = "Probability") +
  theme_minimal(base_size = 15) +
  theme(
    legend.position   = "top",
    axis.line         = element_line(colour = "black"),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank()
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/Figures/ES_accbins_E_vs_S.svg",
       plot   = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


```

# ES - Fixtion Advantage

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                      breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()



summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Fixaion-Advantage Effect on Choice - ES Phase",
    x = "FixationAdvantage (Symbolic > Experiential)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_Fixation_Advantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_FixationAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = FixationAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(FixationAdvantage_bin), data = agg_data),  
  pairwise ~ FixationAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

#EE - Fixation Aadvantage

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                      breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()



summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("L>>R", "L>R", "L~R", "R>L", "R>>L"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")

p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Fixation-Advantage Effect on Choice - EE Phase",
    x = "FixationAdvantage (R - L)",
    y = "P(Choose Right)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_Fixation_Advantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_FixationAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FixationAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FixationAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FixationAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = FixationAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(FixationAdvantage_bin), data = agg_data),  
  pairwise ~ FixationAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# EE - Fixation Advantage Corr

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage_Corr, OVcate_2, corr)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage_Corr, 
                                      breaks = unique(quantile(FixationAdvantage_Corr, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(FixationAdvantage_Corr, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()



summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("I>>C", "I>C", "I~C", "C>L", "C>>L"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")

p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_corr, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 17, color = "black"), 
    axis.title = element_text(size = 17, color = "black"),  
    plot.title = element_text(size = 17, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Fixation-Advantage Effect on correct Choice - EE Phase",
    x = "FixationAdvantage (C - I)",
    y = "P(Correct Choice)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_Fixation_CORRAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_corr ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_CorrFixationAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FixationAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FixationAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FixationAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

glmm_model <- glmer(
  corr ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
  data   = data,     # trial-level! no aggregation needed
  family = binomial
)

anova(glmm_model)  # Type-II Wald χ² tests

posthoc_result1 <- emmeans(glmm_model,
        pairwise ~ OVcate_2 | FixationAdvantage_bin,
        adjust = "bonferroni",
        type = "response")     # probability scale

posthoc_result1
```

# ES - Fixation Advantge Corr

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage_Corr, OVcate_2, corr)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage_Corr, 
                                      breaks = unique(quantile(FixationAdvantage_Corr, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(FixationAdvantage_Corr, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()



summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("I>>C", "I>C", "I~C", "C>L", "C>>L"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_corr, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 17, color = "black"), 
    axis.title = element_text(size = 17, color = "black"),  
    plot.title = element_text(size = 17, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Fixation-Advantage Effect on correct Choice - ES Phase",
    x = "FixationAdvantage (C - I)",
    y = "P(Correct Choice)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_Fixation_CORRAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_corr ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_CorrFixationAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FixationAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FixationAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FixationAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

glmm_model <- glmer(
  corr ~ OVcate_2 * FixationAdvantage_bin + (1 | sub_id),
  data   = data,     # trial-level! no aggregation needed
  family = binomial
)

anova(glmm_model)  # Type-II Wald χ² tests

posthoc_result1 <- emmeans(glmm_model,
        pairwise ~ OVcate_2 | FixationAdvantage_bin,
        adjust = "bonferroni",
        type = "response")     # probability scale

posthoc_result1
```

# ES - Gaze difference per bin

```{r}
library(dplyr)
library(ggplot2)

# 1. Compute absolute values, then do your original per‐subject & per‐OV quantile‐binning
data2 <- data %>%
  mutate(
    DwellTimeAdvantage_abs = abs(DwellTimeAdvantage)                # keep ms magnitude
  ) %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(
    # your original breaks on the *raw* difference (may be negative)
    DwellTimeAdvantage_bin = cut(
      DwellTimeAdvantage,
      breaks = unique(quantile(DwellTimeAdvantage,
                               probs = seq(0, 1, length.out = 6),
                               na.rm = TRUE)),
      # number of labels = number of intervals = length(breaks)−1
      labels = 1:(length(unique(quantile(DwellTimeAdvantage,
                                         probs = seq(0, 1, length.out = 6),
                                         na.rm = TRUE))) - 1),
      include.lowest = TRUE
    )
  ) %>%
  ungroup() %>%
  # relabel 1:5 → E>>S … S>>E
  mutate(
    DwellTimeAdvantage_bin = factor(
      DwellTimeAdvantage_bin,
      levels = 1:5,
      labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E")
    )
  )

# 2. Violin + box + points of *absolute* ms per bin
ggplot(data2, aes(x = DwellTimeAdvantage_bin,
                  y = DwellTimeAdvantage_abs,
                  fill = OVcate_2)) +
  geom_violin(position = position_dodge(width = 0.9),
              alpha = 0.5, trim = FALSE) +
  geom_boxplot(width = 0.1,
               position = position_dodge(width = 0.9),
               outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2,
                                              dodge.width = 0.9),
              shape = 21, size = 1.5, alpha = 0.6) +
  scale_fill_manual(values = colors, name = "OV Level") +
  labs(
    title = "Violin Plot of Absolute Gaze-Time Difference per Bin",
    x     = "Dwell-Time Advantage Bin",
    y     = "Absolute Gaze-Time Advantage (ms)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "top",
    axis.text  = element_text(size = 14),
    axis.title = element_text(size = 16)
  )


```

# ES - gaze difference per bin

```{r}
library(dplyr)
library(ggplot2)


file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

data <- read.csv(file)
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# 1. Compute absolute values & original quintile bins
data2 <- data %>%
  mutate(DwellTimeAdvantage_abs = abs(DwellTimeAdvantage)) %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(
    DwellTimeAdvantage_bin = cut(
      DwellTimeAdvantage,
      breaks = unique(quantile(DwellTimeAdvantage,
                               probs = seq(0, 1, length.out = 6),
                               na.rm = TRUE)),
      labels = 1:(length(unique(quantile(DwellTimeAdvantage,
                                         probs = seq(0, 1, length.out = 6),
                                         na.rm = TRUE))) - 1),
      include.lowest = TRUE
    )
  ) %>%
  ungroup() %>%
  mutate(
    DwellTimeAdvantage_bin = factor(
      DwellTimeAdvantage_bin,
      levels = 1:5,
      labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E")
    )
  )

colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")


# 2. Drop outliers by bin & OVcate_2 using 1.5*IQR
data2_clean <- data2 %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  filter(
    DwellTimeAdvantage_abs >= (quantile(DwellTimeAdvantage_abs, 0.25) - 1.5 * IQR(DwellTimeAdvantage_abs)) &
    DwellTimeAdvantage_abs <= (quantile(DwellTimeAdvantage_abs, 0.75) + 1.5 * IQR(DwellTimeAdvantage_abs))
  ) %>%
  ungroup()

library(dplyr)
library(ggplot2)

# ─── 1. (Your existing) subject_summary ────────────────────────────────
subject_summary <- data2_clean %>%
  group_by(sub_id, OVcate_2, DwellTimeAdvantage_bin) %>%
  summarise(
    mean_abs = mean(DwellTimeAdvantage_abs, na.rm = TRUE),
    .groups  = "drop"
  )

# ─── 2. Compute bar‐heights and SEM by OVcate_2 × bin ────────────────
group_summary2 <- subject_summary %>%
  group_by(OVcate_2, DwellTimeAdvantage_bin) %>%
  summarise(
    Mean = mean(mean_abs),
    SEM  = sd(mean_abs) / sqrt(n()),
    .groups = "drop"
  )

# ─── 3. Bar chart + SEM + overlayed points ────────────────────────────
ggplot() +
  
  # Bars
  geom_col(
    data     = group_summary2,
    aes(
      x    = DwellTimeAdvantage_bin,
      y    = Mean,
      fill = OVcate_2
    ),
    color    = "black",
    position = position_dodge(width = 0.9),
    width    = 0.7
  ) +
  
  # SEM error bars
  geom_errorbar(
    data     = group_summary2,
    aes(
      x      = DwellTimeAdvantage_bin,
      ymin   = Mean - SEM,
      ymax   = Mean + SEM,
      group  = OVcate_2
    ),
    position = position_dodge(width = 0.9),
    width    = 0.2
  ) +
  
  # One point per subject
  geom_point(
    data     = subject_summary,
    aes(
      x     = DwellTimeAdvantage_bin,
      y     = mean_abs,
      group = OVcate_2
    ),
    shape    = 21,
    fill     = alpha("white", 0.6),
    color    = "black",
    size     = 2,
    position = position_dodge(width = 0.9)
  ) +
  
  # Your custom colours
  scale_fill_manual(
    name   = "OV Level",
    values = colors
  ) +
  
  labs(
    title = "Mean Absolute Dwell-Time by Advantage Bin & OV Level",
    x     = "Dwell-Time Advantage Bin",
    y     = "Mean Absolute Dwell-Time (ms)"
  ) +
  
  theme_classic() +
  theme(
    legend.position = "top",
    axis.text  = element_text(size = 14),
    axis.title = element_text(size = 16)
  )


```

#EE gaze difference per bin

```{r}

library(dplyr)
library(ggplot2)

file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

data <- read.csv(file_path)
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)



data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

data2 <- data %>%
  mutate(DwellTimeAdvantage_abs = abs(DwellTimeAdvantage)) %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(
    DwellTimeAdvantage_bin = cut(
      DwellTimeAdvantage,
      breaks = unique(quantile(DwellTimeAdvantage,
                               probs = seq(0, 1, length.out = 6),
                               na.rm = TRUE)),
      labels = 1:(length(unique(quantile(DwellTimeAdvantage,
                                         probs = seq(0, 1, length.out = 6),
                                         na.rm = TRUE))) - 1),
      include.lowest = TRUE
    )
  ) %>%
  ungroup() %>%
  mutate(
    DwellTimeAdvantage_bin = factor(
      DwellTimeAdvantage_bin,
      levels = 1:5,
      labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L")
    )
  )

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")   # blue , deepskyblue navy



# 2. Drop outliers by bin & OVcate_2 using 1.5*IQR
data2_clean <- data2 %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  filter(
    DwellTimeAdvantage_abs >= (quantile(DwellTimeAdvantage_abs, 0.25) - 1.5 * IQR(DwellTimeAdvantage_abs)) &
    DwellTimeAdvantage_abs <= (quantile(DwellTimeAdvantage_abs, 0.75) + 1.5 * IQR(DwellTimeAdvantage_abs))
  ) %>%
  ungroup()

library(dplyr)
library(ggplot2)

# ─── 1. (Your existing) subject_summary ────────────────────────────────
subject_summary <- data2_clean %>%
  group_by(sub_id, OVcate_2, DwellTimeAdvantage_bin) %>%
  summarise(
    mean_abs = mean(DwellTimeAdvantage_abs, na.rm = TRUE),
    .groups  = "drop"
  )

# ─── 2. Compute bar‐heights and SEM by OVcate_2 × bin ────────────────
group_summary2 <- subject_summary %>%
  group_by(OVcate_2, DwellTimeAdvantage_bin) %>%
  summarise(
    Mean = mean(mean_abs),
    SEM  = sd(mean_abs) / sqrt(n()),
    .groups = "drop"
  )

# ─── 3. Bar chart + SEM + overlayed points ────────────────────────────
ggplot() +
  
  # Bars
  geom_col(
    data     = group_summary2,
    aes(
      x    = DwellTimeAdvantage_bin,
      y    = Mean,
      fill = OVcate_2
    ),
    color    = "black",
    position = position_dodge(width = 0.9),
    width    = 0.7
  ) +
  
  # SEM error bars
  geom_errorbar(
    data     = group_summary2,
    aes(
      x      = DwellTimeAdvantage_bin,
      ymin   = Mean - SEM,
      ymax   = Mean + SEM,
      group  = OVcate_2
    ),
    position = position_dodge(width = 0.9),
    width    = 0.2
  ) +
  
  # One point per subject
  geom_point(
    data     = subject_summary,
    aes(
      x     = DwellTimeAdvantage_bin,
      y     = mean_abs,
      group = OVcate_2
    ),
    shape    = 21,
    fill     = alpha("white", 0.6),
    color    = "black",
    size     = 2,
    position = position_dodge(width = 0.9)
  ) +
  
  # Your custom colours
  scale_fill_manual(
    name   = "OV Level",
    values = colors
  ) +
  
  labs(
    title = "Mean Absolute Dwell-Time by Advantage Bin & OV Level",
    x     = "Dwell-Time Advantage Bin",
    y     = "Mean Absolute Dwell-Time (ms)"
  ) +
  
  theme_classic() +
  theme(
    legend.position = "top",
    axis.text  = element_text(size = 14),
    axis.title = element_text(size = 16)
  )




```

# ES - gaze per probabiltiy level

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)

# ─── 1. Load & filter ────────────────────────────────────────────────────────
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

data <- read.csv(file_path) %>% 
  filter(
    phase == "ES",
    !sub_id %in% c(1, 4, 5, 6, 14, 99)
  ) %>% 
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right, DwellLeft, DwellRight)

# ─── 2. Long format & recode ────────────────────────────────────────────────
data_long <- data %>% 
  pivot_longer(
    cols      = c(DwellLeft, DwellRight),
    names_to  = "Option",
    values_to = "PropDwell"
  ) %>% 
  mutate(
    Option = if_else(Option == "DwellLeft", "E", "S"),
    Prob   = if_else(Option == "E", p1, p2)
  ) %>% 
  filter(!(Option == "E" & Prob == 50)) %>% 
  mutate(
    Prob = factor(
      Prob,
      levels = seq(10, 90, 10),
      labels = paste0(seq(10, 90, 10), "%")
    )
  )

# ─── 3. Subject-level summary *with outlier removal* ────────────────────────
subject_summary <- data_long %>% 
  group_by(sub_id, Option, Prob) %>% 
  summarise(mean_prop = mean(PropDwell), .groups = "drop") %>% 
  
  # Tag ± remove outliers (> 3 SD inside each Option × Prob cell)
  group_by(Option, Prob) %>% 
  mutate(
    z_score    = (mean_prop - mean(mean_prop)) / sd(mean_prop),
    is_outlier = abs(z_score) > 3
  ) %>% 
  ungroup() %>% 
  filter(!is_outlier) %>%         # ← toss outliers
  select(-z_score, -is_outlier)

# ─── 4. Group-level summary (bars + SEM) ────────────────────────────────────
group_summary <- subject_summary %>% 
  group_by(Option, Prob) %>% 
  summarise(
    Mean = mean(mean_prop),
    SEM  = sd(mean_prop) / sqrt(n()),   # ← SEM retained
    .groups = "drop"
  )

# ─── 5. Paired t-tests (only where both E & S exist) ────────────────────────
stats_by_prob <- subject_summary %>% 
  group_by(Prob) %>% 
  filter(n_distinct(Option) == 2) %>% 
  summarise(
    t_stat  = t.test(mean_prop[Option == "E"],
                     mean_prop[Option == "S"],
                     paired = TRUE)$statistic,
    p_value = t.test(mean_prop[Option == "E"],
                     mean_prop[Option == "S"],
                     paired = TRUE)$p.value,
    .groups = "drop"
  )

print(stats_by_prob)

subject_summary$Option <- factor(subject_summary$Option, levels = c("E","S"))
group_summary$Option   <- factor(group_summary$Option,   levels = c("E","S"))

ggplot() +
  
  # 1) Bars from group_summary
  geom_col(
    data     = group_summary,
    aes(
      x    = Prob,
      y    = Mean,
      fill = Option      # ← fill is mapped here
    ),
    color    = "black",
    position = position_dodge(width = 0.9),
    width    = 0.7
  ) +

  # 2) SEM error bars
  geom_errorbar(
    data     = group_summary,
    aes(
      x    = Prob,
      ymin = Mean - SEM,
      ymax = Mean + SEM,
      group = Option     # grouping tells it how to dodge
    ),
    position = position_dodge(width = 0.9),
    width    = 0.2
  ) +

  # 3) One dot per participant, dodged by Option
  geom_point(
    data     = subject_summary,
    aes(
      x     = Prob,
      y     = mean_prop,
      group = Option     # must group by Option for proper dodge
    ),
    shape    = 21,
    fill     = alpha("white", 0.6),
    color    = "black",
    size     = 2,
    position = position_dodge(width = 0.9)
  ) +

  # 4) Manual colours now match the factor levels
  scale_fill_manual(
    name   = "Option",
    values = c(E = "deepskyblue", S = "darkorchid")
  ) +

  labs(
    title = "Mean Dwell-Time by Probability & Option",
    x     = "Probability Level",
    y     = "Mean Dwell-Time (ms)"
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title      = element_text(hjust = 0.5)
  )

```

```{r}
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

data <- read.csv(file_path, sep=",")

names(data)

```

# ES - Dwell-Time Advantage for good learners as classified by their accuracy in the ES phase

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
#exclusion based on eye-tracking data
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# filter for poor learners
poor_learners <- c(2,3,10,12,13,15,16,23,24,25)

good_learners <- c(7,8,9,11,17,18,19,20,21,22,26)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects & !sub_id %in% poor_learners) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 16, color = "black"),  
    plot.title = element_text(size = 15, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage Effect on Choice - ES Phase - good performers",
    x = "Dwell Time Advantage (Symbolic > Experiential)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_goodPerformers_DwellTimeAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_goodperformers_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# ES - Dwell Time for poor perfromers in ES

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
#exclusion based on eye-tracking data
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# filter for poor learners
poor_learners <- c(2,3,10,12,13,15,16,23,24,25)

good_learners <- c(7,8,9,11,17,18,19,20,21,22,26)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects & !sub_id %in% good_learners) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 15, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage Effect on Choice - ES Phase - poor performers",
    x = "Dwell Time Advantage (Symbolic > Experiential)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_poorPerformers_DwellTimeAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_poorperformers_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# ES - Dwell-Time Advantage Correct & Incorrecet

```{r}
library(ggplot2)
library(dplyr)

# Load dataset
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# Filter for EE phase and exclude certain subjects
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr) 

# Ensure `OVcate_2` is a factor with correct levels
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# **Fix for Quantile Binning of `DwellTimeAdvantage`**
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellPropAdvantageCorrect_bin = cut(DwellPropAdvantageCorrect, 
                                      breaks = unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()


# Compute Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(DwellPropAdvantageCorrect_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% Confidence Interval
    .groups = 'drop'
  )

# Ensure bin order is correct
summary_df$DwellPropAdvantageCorrect_bin <- factor(summary_df$DwellPropAdvantageCorrect_bin, levels = 1:5, labels = c("I>>C", "I>C", "C ~ I", "C>I", "C>>I"))

# Define custom colors for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")   # blue , deepskyblue navy

# Plot
p <- ggplot(summary_df, aes(x = DwellPropAdvantageCorrect_bin, y = p_choose_corr, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  # Larger points
  geom_line(linewidth = 1.2) +  # Thicker lines
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), width = 0.2, linewidth = 0.8) +  # Error bars
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + # Chance Level Line
  scale_color_manual(values = colors, name = "OV Level") + # Custom Colors
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  # Remove major gridlines
    panel.grid.minor = element_blank(),  # Remove minor gridlines
    axis.line = element_line(color = "black", linewidth = 0.8),  # Add axis lines
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") # White background
  ) +
  labs(
    title = "Dwell-time on correct vs incorrect on choice - ES Phase",
    x = "Dwell Time Proportion (Better - Worse Option)",
    y = "P(Choose Correct)"
)

# Save as SVG
ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DwellPropCORRECT_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")
library(ez)


# Show plot
print(p)
##################################################################################################
# Aggregate by sub_id: Compute mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellPropAdvantageCorrect_bin, OVcate_2) %>%  # ✅ Keep OVcate_2 in the grouping
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

library(lme4)
library(lmerTest)
library(emmeans)

# Fit the LMM: Predict P(Choose Correct) using Dwell Time and OV level
lmm_model <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin * OVcate_2 +   # Fixed effects (interaction)
    (1 | sub_id),  # Random intercept for subjects
  data = agg_data
)

# Print model summary
summary(lmm_model)

emmeans_lmm <- emmeans(lmm_model, pairwise ~ DwellPropAdvantageCorrect_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellPropAdvantageCorrect_bin, adjust = "bonferroni")

# Print results
print(emmeans_OV)

# Print results
print(emmeans_lmm)

lmm_no_OV <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin +  # No interaction with OV
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  # Compare models


lmm_continuous <- lmer(corr ~ DwellPropAdvantageCorrect * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

# Define output directory (same as where the SVG is saved)
output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs"

# Define file name
stats_file <- paste0(output_dir, phase_filter, "_DwellPropCORRECT_LMM_Results.txt")

# Start saving output to the file
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Correct) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Dwell Time Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Dwell Proportion Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Dwell Time) ###\n")
print(summary(lmm_continuous))

# Stop saving to file
sink()

# Confirm output
print(paste("Statistics saved to:", stats_file))

```

# ES - Dwell time adv (S-E) on correct choice

```{r}
library(ggplot2)
library(dplyr)

# Load dataset
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# Filter for EE phase and exclude certain subjects
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, corr)  # ✅ Drop NAs in all relevant columns

# Ensure `OVcate_2` is a factor with correct levels
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")


# Plot
p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_corr, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  # Larger points
  geom_line(linewidth = 1.2) +  # Thicker lines
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), width = 0.2, linewidth = 0.8) +  # Error bars
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + # Chance Level Line
  scale_color_manual(values = colors, name = "OV Level") + # Custom Colors
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  # Remove major gridlines
    panel.grid.minor = element_blank(),  # Remove minor gridlines
    axis.line = element_line(color = "black", linewidth = 0.8),  # Add axis lines
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") # White background
  ) +
  labs(
    title = "Dwell-time on E vs S on correct choice - ES Phase",
    x = "Dwell Time Advantage (S - E)",
    y = "P(Choose Correct)"
)


library(ez)


# Show plot
print(p)
##################################################################################################
# Aggregate by sub_id: Compute mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%  
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

library(lme4)
library(lmerTest)
library(emmeans)

# Fit the LMM: Predict P(Choose Correct) using Dwell Time and OV level
lmm_model <- lmer(
  mean_p_choose_corr ~ DwellTimeAdvantage_bin * OVcate_2 +   # Fixed effects (interaction)
    (1 | sub_id),  # Random intercept for subjects
  data = agg_data
)

# Print model summary
summary(lmm_model)

emmeans_lmm <- emmeans(lmm_model, pairwise ~ DwellTimeAdvantage_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")

# Print results
print(emmeans_OV)

# Print results
print(emmeans_lmm)

lmm_no_OV <- lmer(
  mean_p_choose_corr ~ DwellTimeAdvantage_bin +  # No interaction with OV
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  # Compare models


lmm_continuous <- lmer(corr ~ DwellTimeAdvantage * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

```

# ES - Dwell-Time Advntage correct vs incorrect for poor performers

```{r}
library(ggplot2)
library(dplyr)

# Load dataset
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# Filter for EE phase and exclude certain subjects
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# filter for poor learners
poor_learners <- c(2,3,10,12,13,15,16,23,24,25)

good_learners <- c(7,8,9,11,17,18,19,20,21,22,26)



data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects & !sub_id %in% good_learners) %>%
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr)  
# Ensure `OVcate_2` is a factor with correct levels
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# **Fix for Quantile Binning of `DwellTimeAdvantage`**
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellPropAdvantageCorrect_bin = cut(DwellPropAdvantageCorrect, 
                                      breaks = unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()


# Compute Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(DwellPropAdvantageCorrect_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% Confidence Interval
    .groups = 'drop'
  )

# Ensure bin order is correct
summary_df$DwellPropAdvantageCorrect_bin <- factor(summary_df$DwellPropAdvantageCorrect_bin, levels = 1:5, labels = c("I>>C", "I>C", "C ~ I", "C>I", "C>>I"))

# Define custom colors for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")   # blue , deepskyblue navy

# Plot
p <- ggplot(summary_df, aes(x = DwellPropAdvantageCorrect_bin, y = p_choose_corr, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  # Larger points
  geom_line(linewidth = 1.2) +  # Thicker lines
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), width = 0.2, linewidth = 0.8) +  # Error bars
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + # Chance Level Line
  scale_color_manual(values = colors, name = "OV Level") + # Custom Colors
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  # Remove major gridlines
    panel.grid.minor = element_blank(),  # Remove minor gridlines
    axis.line = element_line(color = "black", linewidth = 0.8),  # Add axis lines
    legend.position = "top",
    plot.title = element_text(size = 14, hjust = 0.5, face="bold", color = "black"),
    plot.background = element_rect(fill = "white", color = "white") # White background
  ) +
  labs(
    title = "Dwell-time on correct vs incorrect on choice - ES Phase - poor performers",
    x = "Dwell Time Proportion (Better - Worse Option)",
    y = "P(Choose Correct)"
)

# Save as SVG
ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_DwellPropCORRECT_Plot_poorperformers.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")
library(ez)


# Show plot
print(p)
##################################################################################################
# Aggregate by sub_id: Compute mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellPropAdvantageCorrect_bin, OVcate_2) %>%  # ✅ Keep OVcate_2 in the grouping
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

library(lme4)
library(lmerTest)
library(emmeans)

# Fit the LMM: Predict P(Choose Correct) using Dwell Time and OV level
lmm_model <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin * OVcate_2 +   # Fixed effects (interaction)
    (1 | sub_id),  # Random intercept for subjects
  data = agg_data
)

# Print model summary
summary(lmm_model)

emmeans_lmm <- emmeans(lmm_model, pairwise ~ DwellPropAdvantageCorrect_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellPropAdvantageCorrect_bin, adjust = "bonferroni")

# Print results
print(emmeans_OV)

# Print results
print(emmeans_lmm)

lmm_no_OV <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin +  # No interaction with OV
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  # Compare models


lmm_continuous <- lmer(corr ~ DwellPropAdvantageCorrect * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

# Define output directory (same as where the SVG is saved)
output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs"

# Define file name
stats_file <- paste0(output_dir, phase_filter, "_DwellPropCORRECT_LMM_Results_poorperformer.txt")

# Start saving output to the file
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Correct) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Dwell Time Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Dwell Proportion Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Dwell Time) ###\n")
print(summary(lmm_continuous))

# Stop saving to file
sink()

# Confirm output
print(paste("Statistics saved to:", stats_file))

```

# ES - Dwell-Time on E & S as a function of p(correct choice)

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# filter for poor learners
poor_learners <- c(2,3,10,12,13,15,16,23,24,25)

good_learners <- c(7,8,9,11,17,18,19,20,21,22,26)


data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects & !sub_id %in% good_learners) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, corr)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_corr, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 14, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage Effect on correct Choice - ES Phase - poor performer",
    x = "Dwell Time Advantage (Symbolic > Experiential)",
    y = "P(Choose Corr)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_correctES_DwellTimeAdvantage_Plot_poorperformer.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_corr ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_CorrectES_DwelltimeAdvantage_Results_poorperformer.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_corr,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_corr ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# E=correct & S=correct trials split dwell-time

```{r}

library(tidyverse)   # loads readr + dplyr + ggplot2 etc.

#file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- read_csv(file, show_col_types = FALSE) %>%                     # 1. load
  mutate(
    chosen_type = if_else(cho == 2, "S", "E"),
    correct_type = case_when(
      corr == 1                     ~ chosen_type,
      chosen_type == "S" & corr==0  ~ "E",
      chosen_type == "E" & corr==0  ~ "S"
    ),
    correct_type = factor(correct_type, levels = c("E", "S")),
    OVcate_2     = factor(OVcate_2,  levels = c("low","medium","high"))
  ) %>%                                                                # 2. filter
  filter(
    phase == "ES",
    !sub_id %in% excluded_subjects
  ) %>% 
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr, correct_type) %>% # 3. bin
  group_by(sub_id, OVcate_2) %>% 
  mutate(
    Dwell_bin = ntile(DwellPropAdvantageCorrect, 5)        # ← safer
  ) %>% 
  ungroup() %>% 
  mutate(
    Dwell_bin = factor(Dwell_bin,
                       levels = 1:5,
                       labels = c("I>>C","I>C","C~I","C>I","C>>I"),
                       ordered = TRUE)
  )



# 2. ---- summarise for plotting
plot_df <- data |>
  group_by(correct_type, OVcate_2, Dwell_bin) |>
  summarise(
    p_choose_corr = mean(corr),
    ci            = 1.96 * sd(corr)/sqrt(n()),
    .groups       = "drop")



# 3a. ---- SINGLE figure with two facets
p <- ggplot(plot_df,
            aes(Dwell_bin, p_choose_corr,
                colour = OVcate_2, group = OVcate_2)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = p_choose_corr - ci,
                    ymax = p_choose_corr + ci),
                width = .15) +
  geom_hline(yintercept = .5, linetype = "dotted") +
  scale_color_manual(values = c(low="darkorchid1",
                                medium="darkorchid3",
                                high="darkmagenta"),
                     name = "OV level") +
  facet_wrap(~ correct_type, nrow = 1,
             labeller = as_labeller(c(E = "E-correct trials",
                                      S = "S-correct trials"))) +
  labs(title = "Dwell-time advantage × OV level\nsplit by correct option type - EXP1",
       x     = "Dwell-time advantage (Correct – Incorrect)",
       y     = "P(choose correct)") +
  theme_minimal(base_size = 14)

#ggsave("ES_DwellPropAdvantage_split_by_correctType.svg",
#       plot = p, width = 9, height = 5, bg = "white")

# 3b. ---- OR: two completely separate files ----
#for(ct in levels(plot_df$correct_type)) {
#  p_ct <- p + facet_wrap(~ correct_type, nrow = 1, scales = "free",
#                         labeller = as_labeller(setNames(ct, ct)))
#  ggsave(glue::glue("ES_DwellPropAdvantage_{ct}_correct.svg"),
#         plot = p_ct, width = 7, height = 5, bg = "white")
#}


print(p)
```

# same plot just for E vs S chosen

```{r}
library(tidyverse)   # loads readr + dplyr + ggplot2 etc.

#file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- read_csv(file, show_col_types = FALSE) %>%                     # 1. load
  mutate(
    chosen_type = if_else(cho == 2, "S", "E"),
    correct_type = case_when(
      corr == 1                     ~ chosen_type,
      chosen_type == "S" & corr==0  ~ "E",
      chosen_type == "E" & corr==0  ~ "S"
    ),
    correct_type = factor(correct_type, levels = c("E", "S")),
    OVcate_2     = factor(OVcate_2,  levels = c("low","medium","high"))
  ) %>%                                                                # 2. filter
  filter(
    phase == "ES",
    !sub_id %in% excluded_subjects
  ) %>% 
  drop_na(DwellPropAdvantage, OVcate_2, corr, correct_type) %>% # 3. bin
  group_by(sub_id, OVcate_2) %>% 
  mutate(
    Dwell_bin = ntile(DwellPropAdvantage, 5)        # ← safer
  ) %>% 
  ungroup() %>% 
  mutate(
    Dwell_bin = factor(Dwell_bin,
                       levels = 1:5,
                       labels = c("E>>S","E>S","E~S","S>E","S>>E"),
                       ordered = TRUE)
  )



# 2. ---- summarise for plotting
plot_df <- data |>
  group_by(correct_type, OVcate_2, Dwell_bin) |>
  summarise(
    p_chose_right = mean(chose_right),
    ci            = 1.96 * sd(chose_right)/sqrt(n()),
    .groups       = "drop")



# 3a. ---- SINGLE figure with two facets
p <- ggplot(plot_df,
            aes(Dwell_bin, p_chose_right,
                colour = OVcate_2, group = OVcate_2)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = p_chose_right - ci,
                    ymax = p_chose_right + ci),
                width = .15) +
  geom_hline(yintercept = .5, linetype = "dotted") +
  scale_color_manual(values = c(low="darkorchid1",
                                medium="darkorchid3",
                                high="darkmagenta"),
                     name = "OV level") +
  facet_wrap(~ correct_type, nrow = 1,
             labeller = as_labeller(c(E = "E-correct trials",
                                      S = "S-correct trials"))) +
  labs(title = "Dwell-time advantage × OV level\nsplit by correct option type - EXP1",
       x     = "Dwell-time advantage (Correct – Incorrect)",
       y     = "P(choose correct)") +
  theme_minimal(base_size = 14)

#ggsave("ES_DwellPropAdvantage_split_by_correctType.svg",
#       plot = p, width = 9, height = 5, bg = "white")

# 3b. ---- OR: two completely separate files ----
#for(ct in levels(plot_df$correct_type)) {
#  p_ct <- p + facet_wrap(~ correct_type, nrow = 1, scales = "free",
#                         labeller = as_labeller(setNames(ct, ct)))
#  ggsave(glue::glue("ES_DwellPropAdvantage_{ct}_correct.svg"),
#         plot = p_ct, width = 7, height = 5, bg = "white")
#}


print(p)
```

# Nr of fixations per ES/ EE

```{r}
library(tidyverse)

file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)  #1, 4, 5, 6, 14, 99

# ----------------------------------------------------------
# 1.  Load, filter, participant-level means
# ----------------------------------------------------------
fix_df <- read_csv(file, show_col_types = FALSE) %>% 
  filter(phase %in% c("EE", "ES"),
         !sub_id %in% excluded_subjects) %>% 
  group_by(sub_id, phase) %>% 
  summarise(mean_fix = mean(Nfix, na.rm = TRUE), .groups = "drop") %>% 

  ## ----- NEW LINE -----
  filter(is.finite(mean_fix)) %>%          # drop NaN / Inf rows
  ## ---------------------

  mutate(phase = factor(phase, levels = c("ES", "EE")))


# ----------------------------------------------------------
# 2.  Grand means (printed numerically)
# ----------------------------------------------------------
grand_means <- fix_df %>%
  group_by(phase) %>%
  summarise(grand_mean = mean(mean_fix), .groups = "drop")

print(grand_means)
#> # A tibble: 2 × 2
#>   phase grand_mean
#>   <fct>      <dbl>
#> 1 ES          6.42
#> 2 EE          7.11
#  (numbers will reflect your data)

# ----------------------------------------------------------
# 3.  Plot
# ----------------------------------------------------------
p_fix <- ggplot(fix_df, aes(phase, mean_fix, fill = phase)) +
  stat_summary(fun = mean, geom = "bar",
               width = 0.6, colour = "black") +
  stat_summary(fun.data = mean_se, geom = "errorbar",
               width = .15, linewidth = .9) +

  ## ------------  NEW point layer  ------------
  geom_jitter(         # circle with fill & stroke
              fill  = "white",    # inside of the dot
              colour = "black",   # outline
              stroke = .8,        # outline thickness
              alpha  = .7,        # transparency
              width  = .08,       # horizontal jitter
              height = 0,
              size   = 3,
              show.legend = FALSE) +

  scale_fill_manual(values = c(ES = "darkorchid", EE = "deepskyblue"), guide = "none") +
  labs(title = "Mean number of fixations per trial - EXP1",
       x = "Phase", y = "Mean Nr of fixations (per participant)") +
  theme_minimal(base_size = 14)

p_fix
## (optional) add numeric mean labels above bars
# p_fix <- p_fix +
#   geom_text(data = grand_means,
#             aes(x = phase, y = grand_mean, label = round(grand_mean, 2)),
#             vjust = -0.6, size = 5)

#print(p_fix)
#ggsave("Fixations_ES_vs_EE.svg",
#       plot = p_fix, width = 6, height = 5, bg = "white")


```

```{r}
library(tidyverse)

# 1. File & exclusions
file         <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
exclude_sids <- c(1, 4, 5, 6, 14, 99)

# 2. Read, filter ES, drop NAs
df_es <- read_csv(file, show_col_types = FALSE) %>%
  filter(phase == "ES",
         !sub_id %in% exclude_sids) %>%
  drop_na(OVcate_2, rtime, corr) %>%
  mutate(
    corr = as.integer(corr),
    OVcate_2 = factor(OVcate_2, levels = c("low","medium","high"))
  )

# 3. Per‐subject, per‐bin means
sub_rt  <- df_es %>%
  group_by(sub_id, OVcate_2) %>%
  summarise(mean_rtime = mean(rtime), .groups = "drop")

sub_acc <- df_es %>%
  group_by(sub_id, OVcate_2) %>%
  summarise(mean_acc   = mean(corr),  .groups = "drop")

# 4. Grand summaries (mean, SD, SEM)
summ_rt <- sub_rt %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime = mean(mean_rtime),
    sd_rtime   = sd(mean_rtime),
    sem_rtime  = sd_rtime / sqrt(n()),
    n_subs     = n(),
    .groups    = "drop"
  )

summ_acc <- sub_acc %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_acc = mean(mean_acc),
    sd_acc   = sd(mean_acc),
    sem_acc  = sd_acc / sqrt(n()),
    n_subs   = n(),
    .groups  = "drop"
  )

# 5. Print numeric summaries
cat("\n--- RT by OVcate_2 (ES phase) ---\n")
print(summ_rt)

cat("\n--- Accuracy by OVcate_2 (ES phase) ---\n")
print(summ_acc)

# 6. Plotting

# a) RT
plot_rt <- ggplot(sub_rt, aes(OVcate_2, mean_rtime, fill = OVcate_2)) +
  stat_summary(fun = mean,    geom = "col",   colour = "black", width = .6, show.legend = FALSE) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = .15, linewidth = .9) +
  geom_jitter(width = .1, size = 2, alpha = .7, colour = "black") +
  labs(
    title = "Mean RT by OV level (ES phase)",
    x     = "OV category",
    y     = "RT (ms)"
  ) +
  theme_minimal(base_size = 14)

# b) Accuracy
plot_acc <- ggplot(sub_acc, aes(OVcate_2, mean_acc, fill = OVcate_2)) +
  stat_summary(fun = mean,    geom = "col",   colour = "black", width = .6, show.legend = FALSE) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = .15, linewidth = .9) +
  geom_jitter(width = .1, size = 2, alpha = .7, colour = "black") +
  scale_y_continuous(labels = scales::percent_format(1)) +
  labs(
    title = "Mean Accuracy by OV level (ES phase)",
    x     = "OV category",
    y     = "Proportion correct"
  ) +
  theme_minimal(base_size = 14)

# 7. Render plots
print(plot_rt)
print(plot_acc)


```

```{r}
library(tidyverse)

# 1. File & exclusions (same as before)
file         <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
exclude_sids <- c(1, 4, 5, 6, 14, 99)

# 2. Read, filter EE, drop NAs
df_ee <- read_csv(file, show_col_types = FALSE) %>%
  filter(phase == "EE",            # EE phase now
         !sub_id %in% exclude_sids) %>%
  drop_na(OVcate_2, rtime, corr) %>%
  mutate(
    corr      = as.integer(corr),
    OVcate_2  = factor(OVcate_2, levels = c("low","medium","high"))
  )

# 3. Per‐subject, per‐bin means
sub_rt_ee  <- df_ee %>%
  group_by(sub_id, OVcate_2) %>%
  summarise(mean_rtime = mean(rtime), .groups = "drop")

sub_acc_ee <- df_ee %>%
  group_by(sub_id, OVcate_2) %>%
  summarise(mean_acc   = mean(corr),  .groups = "drop")

# 4. Grand summaries (mean, SD, SEM)
summ_rt_ee <- sub_rt_ee %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_rtime = mean(mean_rtime),
    sd_rtime   = sd(mean_rtime),
    sem_rtime  = sd_rtime / sqrt(n()),
    n_subs     = n(),
    .groups    = "drop"
  )

summ_acc_ee <- sub_acc_ee %>%
  group_by(OVcate_2) %>%
  summarise(
    mean_acc = mean(mean_acc),
    sd_acc   = sd(mean_acc),
    sem_acc  = sd_acc / sqrt(n()),
    n_subs   = n(),
    .groups  = "drop"
  )

# 5. Print numeric summaries
cat("\n--- RT by OVcate_2 (EE phase) ---\n")
print(summ_rt_ee)

cat("\n--- Accuracy by OVcate_2 (EE phase) ---\n")
print(summ_acc_ee)

# 6. Plotting

# a) RT
plot_rt_ee <- ggplot(sub_rt_ee, aes(OVcate_2, mean_rtime, fill = OVcate_2)) +
  stat_summary(fun = mean,    geom = "col",   colour = "black", width = .6, show.legend = FALSE) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = .15, linewidth = .9) +
  geom_jitter(width = .1, size = 2, alpha = .7, colour = "black") +
  labs(
    title = "Mean RT by OV level (EE phase)",
    x     = "OV category",
    y     = "RT (ms)"
  ) +
  theme_minimal(base_size = 14)

# b) Accuracy
plot_acc_ee <- ggplot(sub_acc_ee, aes(OVcate_2, mean_acc, fill = OVcate_2)) +
  stat_summary(fun = mean,    geom = "col",   colour = "black", width = .6, show.legend = FALSE) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = .15, linewidth = .9) +
  geom_jitter(width = .1, size = 2, alpha = .7, colour = "black") +
  scale_y_continuous(labels = scales::percent_format(1)) +
  labs(
    title = "Mean Accuracy by OV level (EE phase)",
    x     = "OV category",
    y     = "Proportion correct"
  ) +
  theme_minimal(base_size = 14)

# 7. Render plots
print(plot_rt_ee)
print(plot_acc_ee)

```

# Fix dur for ES and EE

```{r}
# ── libraries ────────────────────────────────────────────────────────────────
library(tidyverse)
library(broom)           # tidy() on models
library(lme4)            # lmer()
library(emmeans)         # pairwise contrasts
# install.packages(c("lme4","emmeans","broom")) if needed

# ── data & exclusions ────────────────────────────────────────────────────────
file <- "D:/Aberdeen_Uni_June24/cap/THESIS/OV_Analysis/data/data_sets/OVParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c()                        # add IDs to drop if necessary

raw <- read_csv(
         file,
         col_types = cols(.default = col_guess())
       ) %>%
       filter(!sub_id %in% excluded_subjects)

# phases we want and their order on screen
phase_levels <- c("LE", "ES", "EE")

# ── 1. helper to make ONE bar-plot (as you had before) ───────────────────────
plot_fix_durations <- function(data, phase_code,
                               bar_colour = "grey60",
                               dot_colour = "black") {

  df_phase <- data %>%
    filter(phase == phase_code) %>%
    group_by(sub_id) %>%
    summarise(
      First   = mean(FirstFixDur,      na.rm = TRUE),
      Middle  = mean(MiddleFixDur,     na.rm = TRUE),
      EachMid = mean(eachMiddleFixDur, na.rm = TRUE),
      Final   = mean(FinalFixDur,      na.rm = TRUE),
      .groups = "drop"
    ) %>%
    pivot_longer(-sub_id,
                 names_to  = "fix_type",
                 values_to = "mean_dur") %>%
    filter(is.finite(mean_dur))

  # grand means to console
  cat("\nGrand means (ms) –", phase_code, "\n")
  print(df_phase %>% group_by(fix_type) %>%
          summarise(grand_mean = mean(mean_dur), .groups = "drop"))

  # the plot
  ggplot(df_phase, aes(fix_type, mean_dur)) +
    stat_summary(fun = mean, geom = "bar",
                 width = .7, fill = bar_colour, colour = "black") +
    stat_summary(fun.data = mean_se, geom = "errorbar",
                 width = .18, linewidth = .9) +
    geom_jitter(width = .10, height = 0, size = 3, alpha = .7,
                colour = dot_colour) +
    scale_x_discrete(limits = c("First","Middle","EachMid","Final"),
                     labels = c("First","Middle",
                                "Each\nmiddle (mean mid)", "Final")) +
    labs(title = glue::glue("Fixation durations – {phase_code} phase - EXP2"),
         x = NULL, y = "Mean fixation duration (ms)") +
    coord_cartesian(ylim = c(0, 800)) +
    theme_minimal(base_size = 13)
}

# ── 2. build the three phase plots ───────────────────────────────────────────
p_LE <- plot_fix_durations(raw, "LE", bar_colour = "beige")
p_ES <- plot_fix_durations(raw, "ES", bar_colour = "darkorchid")
p_EE <- plot_fix_durations(raw, "EE", bar_colour = "deepskyblue")

# show them (one by one, or combine with patchwork / cowplot if desired)
print(p_LE); print(p_ES); print(p_EE)

# ── 3. prepare LONG data for stats across phases ────────────────────────────
long <- raw %>%
  filter(phase %in% phase_levels) %>%
  mutate(phase = factor(phase, levels = phase_levels)) %>%
  group_by(phase, sub_id) %>%
  summarise(
    First   = mean(FirstFixDur,      na.rm = TRUE),
    Middle  = mean(MiddleFixDur,     na.rm = TRUE),
    EachMid = mean(eachMiddleFixDur, na.rm = TRUE),
    Final   = mean(FinalFixDur,      na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(-c(phase, sub_id),
               names_to  = "fix_type",
               values_to = "mean_dur") %>%
  filter(is.finite(mean_dur))

# ── 4. numerical means ± SE for every combo (prints) ─────────────────────────
mean_table <- long %>%
  group_by(phase, fix_type) %>%
  summarise(
    n    = n(),
    mean = mean(mean_dur),
    sd   = sd(mean_dur),
    se   = sd/sqrt(n),
    .groups = "drop"
  )
cat("\nNumerical means (ms):\n")
print(mean_table, n = Inf, width = Inf)

# ── 5. stats: repeated-measures ANOVA + pairwise comparisons ─────────────────
anova_results  <- list()
pairwise_table <- list()

for (ft in unique(long$fix_type)) {

  dat <- filter(long, fix_type == ft)

  # random-intercept model subject | phase (same as one-way r.m. ANOVA)
  mod <- lmer(mean_dur ~ phase + (1 | sub_id), data = dat)

  anova_results[[ft]] <- anova(mod) %>% broom::tidy() %>% 
                        mutate(fix_type = ft, .before = 1)

  # pairwise phase contrasts with Bonferroni correction
  pw <- emmeans(mod, "phase") |>
        contrast("pairwise", adjust = "bonferroni") |>
        as.data.frame() |>
        mutate(fix_type = ft, .before = 1)

  pairwise_table[[ft]] <- pw
}

anova_table    <- bind_rows(anova_results)
pairwise_table <- bind_rows(pairwise_table)

cat("\nRepeated-measures ANOVA (phase effect per fixation type):\n")
print(anova_table, n = Inf, width = Inf)

cat("\nPair-wise phase contrasts (Bonferroni-adjusted):\n")
print(pairwise_table, n = Inf, width = Inf)

# save if you wish
#ggsave("FixDur_ES.svg", plot = p_ES, width = 7, height = 5, bg = "white")
#ggsave("FixDur_EE.svg", plot = p_EE, width = 7, height = 5, bg = "white")

```

# Fix dur

```{r}
# ── after building `anova_table` & `pairwise_table` ──────────────────────────
anova_table_print <- anova_table %>%
  mutate(across(matches("p\\.value|Pr\\(>F\\)"), ~ round(.x, 3)))

pairwise_table_print <- pairwise_table %>%
  mutate(across(matches("p\\.value"), ~ round(.x, 3)))

cat("\nRepeated-measures ANOVA (phase effect per fixation type):\n")
print(anova_table_print, n = Inf, width = Inf)

cat("\nPair-wise phase contrasts (Bonferroni-adjusted):\n")
print(pairwise_table_print, n = Inf, width = Inf)

```

# Fixation dur - good & poor performers

```{r}
library(tidyverse)
library(broom)        # for tidy() on t-tests
library(patchwork)    # only if you still want patchwork later

# ── assume df_raw already contains the learner labels ────────────────────────
# (see previous answer for how df_raw is built and learners are classified)

# ── 1. participant-level means and long format ───────────────────────────────
df_fix <- df_raw %>%
  group_by(phase, learner, sub_id) %>%
  summarise(
    First   = mean(FirstFixDur,      na.rm = TRUE),
    Middle  = mean(MiddleFixDur,     na.rm = TRUE),
    EachMid = mean(eachMiddleFixDur, na.rm = TRUE),
    Final   = mean(FinalFixDur,      na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(-c(phase, learner, sub_id),
               names_to  = "fix_type",
               values_to = "mean_dur") %>%
  filter(is.finite(mean_dur))

# ── 2. numerical means table (print to console or save) ──────────────────────
mean_table <- df_fix %>%
  group_by(phase, learner, fix_type) %>%
  summarise(
    n     = n(),
    mean  = mean(mean_dur),
    sd    = sd(mean_dur),
    se    = sd / sqrt(n),
    .groups = "drop"
  )

print(mean_table, n = Inf, width = Inf)   # full table in console
# write_csv(mean_table, "fixation_means_by_group.csv")   # if you want a file

# ── 3. statistical test: good vs poor inside each phase & fix-type ───────────
stats_table <- df_fix %>%
  group_by(phase, fix_type) %>%
  do(tidy(t.test(mean_dur ~ learner, data = .))) %>%
  ungroup()

print(stats_table, n = Inf, width = Inf)

# ── 4. nicer plot with facets instead of patchwork ───────────────────────────
pal <- c(good = "darkorchid", poor = "steelblue")

p <- ggplot(df_fix, aes(fix_type, mean_dur, fill = learner)) +
  stat_summary(fun = mean, geom = "bar", width = 0.7,
               colour = "black", position = position_dodge(width = 0.75)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", linewidth = 0.8,
               position = position_dodge(width = 0.75), width = 0.20) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.08,
                                              dodge.width  = 0.75),
              size = 2.5, alpha = .75, shape = 21, stroke = 0.3) +
  scale_fill_manual(values = pal, name = "Learner") +
  scale_x_discrete(limits = c("First","Middle","EachMid","Final"),
                   labels = c("First","Middle","Each\nmiddle (mean mid)","Final")) +
  coord_cartesian(ylim = c(0, 800)) +
  facet_grid(learner ~ phase, labeller = labeller(
    learner = c(good = "Good learners", poor = "Poor learners"),
    phase   = c(ES = "ES phase", EE = "EE phase")
  )) +
  labs(title = "Mean fixation durations by learner group and phase",
       x = NULL, y = "Mean fixation duration (ms)") +
  theme_minimal(base_size = 13) +
  theme(
    strip.text   = element_text(face = "bold", size = 12),
    axis.text.x  = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.box.spacing = unit(2, "pt")
  )

print(p)


```

```{r}
# ── libraries ────────────────────────────────────────────────────────────────
library(tidyverse)
library(broom)
file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

# ── read & prepare ───────────────────────────────────────────────────────────
df_raw <- read_csv(
  file,
  col_types = cols(.default = col_guess(), corr = col_double())
)

# median-split on ES phase ----------------------------------------------------
acc_ES <- df_raw %>%
  filter(phase == "ES") %>%
  group_by(sub_id) %>%
  summarise(acc_ES = mean(corr, na.rm = TRUE), .groups = "drop")

median_ES <- median(acc_ES$acc_ES, na.rm = TRUE)

learner_tbl <- acc_ES %>%
  mutate(learner = if_else(acc_ES > median_ES, "good", "poor"))

df_raw <- df_raw %>%
  inner_join(learner_tbl, by = "sub_id")

# restrict to the three phases & set display order ---------------------------
phase_levels <- c("LE", "ES", "EE")
df_raw <- df_raw %>%
  filter(phase %in% phase_levels) %>%
  mutate(
    phase   = factor(phase,   levels = phase_levels),
    learner = factor(learner, levels = c("good", "poor"))
  )

# ── participant-level means, one row per fix-type ────────────────────────────
df_fix <- df_raw %>%
  group_by(phase, learner, sub_id) %>%
  summarise(
    First   = mean(FirstFixDur,      na.rm = TRUE),
    Middle  = mean(MiddleFixDur,     na.rm = TRUE),
    EachMid = mean(eachMiddleFixDur, na.rm = TRUE),
    Final   = mean(FinalFixDur,      na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(-c(phase, learner, sub_id),
               names_to  = "fix_type",
               values_to = "mean_dur") %>%
  filter(is.finite(mean_dur))

# ── numeric means ±SE (prints to console) ────────────────────────────────────
mean_table <- df_fix %>%
  group_by(phase, learner, fix_type) %>%
  summarise(
    n    = n(),
    mean = mean(mean_dur),
    sd   = sd(mean_dur),
    se   = sd/sqrt(n),
    .groups = "drop"
  )
print(mean_table, n = Inf, width = Inf)

# ── independent t-tests good vs poor for every phase×fix-type ────────────────
stats_table <- df_fix %>%
  group_by(phase, fix_type) %>%
  do(tidy(t.test(mean_dur ~ learner, data = .))) %>%
  ungroup()
print(stats_table, n = Inf, width = Inf)

# ── plot ─────────────────────────────────────────────────────────────────────
pal <- c(good = "darkorchid", poor = "steelblue")

p <- ggplot(df_fix, aes(fix_type, mean_dur, fill = learner)) +
  ## bars = group means
  stat_summary(fun = mean, geom = "bar",
               width = .7, colour = "black") +
  ## error-bars = ±SE
  stat_summary(fun.data = mean_se, geom = "errorbar",
               width = .18, linewidth = .75) +
  ## black participant dots (slight horizontal jitter)
  geom_jitter(width = .08, height = 0,
              colour = "black", size = 2, alpha = .8) +
  scale_fill_manual(values = pal, name = "Learner") +
  scale_x_discrete(
    limits = c("First", "Middle", "EachMid", "Final"),
    labels = c("First", "Middle", "Each\nmiddle (mean mid)", "Final")
  ) +
  coord_cartesian(ylim = c(0, 800)) +
  facet_grid(learner ~ phase, labeller = labeller(
    learner = c(good = "Good learners", poor = "Poor learners"),
    phase   = c(LE = "LE phase", ES = "ES phase", EE = "EE phase")
  )) +
  labs(
    title = "Mean fixation durations by learner group and phase",
    x = NULL, y = "Mean fixation duration (ms)"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    strip.text  = element_text(face = "bold", size = 9),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom"
  )

print(p)

```

# Nr middle fix for ES and EE

```{r}

file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c()                # IDs to drop if needed

# ── 1. read & clean ──────────────────────────────────────────────────────────
df_mid <- read_csv(
           file,
           col_types = cols(                     # force Nfix to double
             Nfix  = col_double(),              # everything else guessed
             .default = col_guess())
         ) %>%
  filter(phase %in% c("ES", "EE"),              # keep only the two phases
         !sub_id %in% excluded_subjects) %>%
  mutate(
    # If Nfix was blank or non-numeric it is now NA, so drop those rows:
    Nfix = if_else(is.na(Nfix), NA_real_, Nfix),
    middle_fix = pmax(Nfix - 2, 0)              # never negative
  ) %>%
  filter(is.finite(middle_fix))                 # toss NA/Inf rows

# ── 2. participant-level means ───────────────────────────────────────────────
df_mid <- df_mid %>%
  group_by(phase, sub_id) %>%
  summarise(mean_mid_fix = mean(middle_fix),    # no NA left, so na.rm not needed
            .groups = "drop")

# ── 3. (optional) print grand means to console ───────────────────────────────
df_mid %>%
  group_by(phase) %>%
  summarise(grand_mean = mean(mean_mid_fix), .groups = "drop") %>%
  print()

# ── 4. plot ──────────────────────────────────────────────────────────────────
ggplot(df_mid, aes(phase, mean_mid_fix, fill = phase)) +
  stat_summary(fun = mean,  geom = "bar", width = .6,
               colour = "black", show.legend = FALSE) +
  stat_summary(fun.data = mean_se, geom = "errorbar",
               width = .15, linewidth = .9) +
  geom_jitter(width = .08, height = 0, size = 3,
              alpha = .7, colour = "black") +
  scale_fill_manual(values = c(ES = "darkorchid",
                               EE = "deepskyblue")) +
  labs(title = "Mean number of middle fixations - EXP1",
       x = NULL,
       y = "Mean count per participant") +
  theme_minimal(base_size = 14)


```

# get prob. first fix, middle fix, final fix on E vs S

```{r}
library(tidyverse)

# 1. Read file & keep ES phase, exclude subjects, drop NAs
file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
drop_sids <- c(1, 4, 5, 6, 14, 99)

df <- read_csv(file, col_types = cols(.default = col_guess())) %>%
  filter(phase == "ES",
         !sub_id %in% drop_sids) %>%
  mutate(across(c(FirstFixLoc, FinalFixLoc, MiddleDominantLoc),
                ~ as.integer(.)))  # ensure integer

# Helper to summarize + plot one measure
summarize_and_plot <- function(df, var, colname) {
  # drop NAs
  df2 <- df %>% filter(!is.na(.data[[var]]))
  
  # per-subject proportions
  df_prop <- df2 %>%
    group_by(sub_id) %>%
    summarise(
      p_E = mean(.data[[var]] == 1),
      p_S = mean(.data[[var]] == 2),
      .groups = "drop"
    ) %>%
    pivot_longer(c(p_E, p_S),
                 names_to  = "option",
                 values_to = "prop") %>%
    mutate(option = recode(option, p_E = "E", p_S = "S"))
  
  # grand summary
  grand <- df_prop %>%
    group_by(option) %>%
    summarise(
      mean   = mean(prop),
      sd     = sd(prop),
      sem    = sd(prop)/sqrt(n()),
      n_subs = n(),
      .groups = "drop"
    )
  
  # print numeric table
  cat("\n=== Summary for", colname, "===\n")
  print(grand)
  
  # plot
   # plot
  p <- ggplot(df_prop, aes(option, prop, fill = option)) +
    stat_summary(fun = mean, geom = "col",
                 colour = "black", width = .6, show.legend = TRUE) +    # legend on
    stat_summary(fun.data = mean_se, geom = "errorbar",
                 width = .15, linewidth = .9) +
    geom_jitter(width = .1, height = 0, size = 2,
                alpha = .7, colour = "black") +
    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
    scale_fill_manual(
      name   = "Option", 
      values = c(S = "darkorchid",   # now S → darkorchid
                 E = "deepskyblue")  # and E → deepskyblue
    ) +
    labs(
      title = paste0("First-fix probability: ", colname),
      x     = "Option",
      y     = "Probability"
    ) +
    theme_minimal(base_size = 14)


  print(p)
}

# 2. FirstFixLoc
summarize_and_plot(df, "FirstFixLoc",       "FirstFixLoc")

# 3. FinalFixLoc
summarize_and_plot(df, "FinalFixLoc",       "FinalFixLoc")

# 4. MiddleDominantLoc
summarize_and_plot(df, "MiddleDominantLoc", "MiddleDominantLoc")

```

# ES - Dwell-Time Advantage for good learners as classified by their accuracy in the ES phase

```{r}
data <- read.csv(file)

# phase ES
phase_filter <- "ES"
#exclusion based on eye-tracking data
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# filter for poor learners
poor_learners <- c(2,3,10,12,13,15,16,23,24,25)

good_learners <- c(7,8,9,11,17,18,19,20,21,22,26)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects & !sub_id %in% poor_learners) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()

summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),       # mean 
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

# bin order 
summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, 
                                            levels = 1:5, 
                                            labels = c("E>>S", "E>S", "E~S", "S>E", "S>>E"))

# colours for OV levels (low, medium, high)
colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")

p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 16),  
    axis.text = element_text(size = 19, color = "black"), 
    axis.title = element_text(size = 16, color = "black"),  
    plot.title = element_text(size = 15, hjust = 0.5, face="bold", color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage Effect on Choice - ES Phase - good performers",
    x = "Dwell Time Advantage (Symbolic > Experiential)",
    y = "P(Choose Symbolic)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_goodPerformers_DwellTimeAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


############### statistical analysis #####################################################################################

# group by subject and get prob. chosign right per bin
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  # Store ANOVA results

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# Post-hoc for OVcate_2 within each DwellTimeAdvantage_bin
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


# results folder
results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_goodperformers_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose correct) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# EE - Dwell-Time Advantage correct vs incorrect choice

```{r}
library(ggplot2)
library(dplyr)

# Load dataset
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# Filter for EE phase and exclude certain subjects
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellPropAdvantageCorrect, OVcate_2, corr)  # ✅ Drop NAs in all relevant columns

# Ensure `OVcate_2` is a factor with correct levels
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile Binning of DwellTimeAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellPropAdvantageCorrect_bin = cut(DwellPropAdvantageCorrect, 
                                      breaks = unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellPropAdvantageCorrect, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()


# Compute Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(DwellPropAdvantageCorrect_bin, OVcate_2) %>%
  summarise(
    p_choose_corr = mean(corr, na.rm = TRUE),
    ci = 1.96 * sd(corr, na.rm = TRUE) / sqrt(n()),  # 95% Confidence Interval
    .groups = 'drop'
  )

# Ensure bin order is correct
summary_df$DwellPropAdvantageCorrect_bin <- factor(summary_df$DwellPropAdvantageCorrect_bin, levels = 1:5, labels = c("I>>C", "I>C", "C ~ I", "C>I", "C>>I"))

# Define custom colors for OV levels (low, medium, high)
colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")   # blue , deepskyblue navy

# Plot
p <- ggplot(summary_df, aes(x = DwellPropAdvantageCorrect_bin, y = p_choose_corr, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  # Larger points
  geom_line(linewidth = 1.2) +  # Thicker lines
  geom_errorbar(aes(ymin = p_choose_corr - ci, ymax = p_choose_corr + ci), width = 0.2, linewidth = 0.8) +  # Error bars
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) + # Chance Level Line
  scale_color_manual(values = colors, name = "OV Level") + # Custom Colors
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  # Remove major gridlines
    panel.grid.minor = element_blank(),  # Remove minor gridlines
    axis.line = element_line(color = "black", linewidth = 0.8),  # Add axis lines
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white") # White background
  ) +
  labs(
    title = "Dwell-time on correct vs incorrect on choice - EE Phase",
    x = "Dwell Time Proportion (Better - Worse Option)",
    y = "P(Choose Correct)"
)

# Save as SVG
ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_DwellPropCORRECT_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")
library(ez)


# Show plot
print(p)
##################################################################################################
# Aggregate by sub_id: Compute mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellPropAdvantageCorrect_bin, OVcate_2) %>%  # ✅ Keep OVcate_2 in the grouping
  summarise(mean_p_choose_corr = mean(corr, na.rm = TRUE), .groups = 'drop')

library(lme4)
library(lmerTest)
library(emmeans)

# Fit the LMM: Predict P(Choose Correct) using Dwell Time and OV level
lmm_model <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin * OVcate_2 +   # Fixed effects (interaction)
    (1 | sub_id),  # Random intercept for subjects
  data = agg_data
)

# Print model summary
summary(lmm_model)

emmeans_lmm <- emmeans(lmm_model, pairwise ~ DwellPropAdvantageCorrect_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellPropAdvantageCorrect_bin, adjust = "bonferroni")

# Print results
print(emmeans_OV)

# Print results
print(emmeans_lmm)

lmm_no_OV <- lmer(
  mean_p_choose_corr ~ DwellPropAdvantageCorrect_bin +  # No interaction with OV
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  # Compare models


lmm_continuous <- lmer(corr ~ DwellPropAdvantageCorrect * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

# Define output directory (same as where the SVG is saved)
output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs"

# Define file name
stats_file <- paste0(output_dir, phase_filter, "_DwellPropCORRECT_LMM_Results.txt")

# Start saving output to the file
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Correct) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Dwell Time Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Dwell Proportion Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Dwell Time) ###\n")
print(summary(lmm_continuous))

# Stop saving to file
sink()

# Confirm output
print(paste("Statistics saved to:", stats_file))

```

# EE - Dwell-Time Advantage

```{r}
data <- read.csv(file)
phase_filter <- "EE"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(DwellTimeAdvantage, OVcate_2, chose_right)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(DwellTimeAdvantage_bin = cut(DwellTimeAdvantage, 
                                      breaks = unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                      labels = 1:(length(unique(quantile(DwellTimeAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                      include.lowest = TRUE)) %>%
  ungroup()


summary_df <- data %>%
  group_by(DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),  # 95% CI
    .groups = 'drop'
  )

summary_df$DwellTimeAdvantage_bin <- factor(summary_df$DwellTimeAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "deepskyblue", "medium" = "blue", "high" = "navy")   


p <- ggplot(summary_df, aes(x = DwellTimeAdvantage_bin, y = p_choose_right, 
                            group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), 
                width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8),  
    legend.position = "top",
    legend.text = element_text(size = 18),  
    legend.title = element_text(size = 18),
    axis.text = element_text(size = 18, color = "black"), 
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5,color = "black"), 
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = "Dwell-Time Advantage on Choice - EE-Phase",
    x = "Dwell Time Advantage (R > L)",
    y = "P(Choose Right)"
  )

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_DTA.pdf", 
       plot = p, width = 5, height = 6, device = "pdf", bg = "white"
       )

print(p)





agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')
anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * DwellTimeAdvantage_bin + (1 | sub_id),
                  data = agg_data)

anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | DwellTimeAdvantage_bin, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_DwelltimeAdvantage_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of DwellTimeAdvantage_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for DwellTimeAdvantage_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * DwellTimeAdvantage_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, DwellTimeAdvantage_bin) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,  
  wid = sub_id,              
  within = DwellTimeAdvantage_bin,  
  type = 3,               
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(DwellTimeAdvantage_bin), data = agg_data),  
  pairwise ~ DwellTimeAdvantage_bin,  
  adjust = "bonferroni"  
)

posthoc_result1


```

# ES - Final fixations on choice per VD and OV

```{r}

data <- read.csv(file_path)

# filter for ES phase and exclude subjects
phase_filter <- "ES" 
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

# OVcate_2 are the overall value categories - sort them
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# convert FinalFixLoc to categorical: "Right" or "Left"
data$FinalFixLocBinary <- ifelse(data$FinalFixLoc == 2, "S", "E")
data$FinalFixLocBinary <- factor(data$FinalFixLocBinary, levels = c("E", "S"))

# value difference (Right - Left)
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("E>>S", "E>S", "E ~ S", "S>E", "S>>E"),
                                   include.lowest = TRUE)) %>%
  ungroup()


# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FinalFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)


colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  

summary_df$FinalFixLocBinary <- factor(summary_df$FinalFixLocBinary,
                                        levels = c("E", "S"),
                                        labels = c("Line: E", "Dotted: S"))
line_types <- c("Line: E" = "solid", "Dotted: S" = "dashed")


# Keep your variables explicit (not only via interaction)
summary_df$OV_label <- summary_df$OVcate_2
summary_df$Fix_label <- summary_df$FinalFixLocBinary

p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right,
                            group = interaction(Fix_label, OV_label),
                            color = OV_label, linetype = Fix_label)) +
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  

  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(
    values = line_types,
    name = "Final Fixation",
    guide = guide_legend(
      override.aes = list(linetype = c(0, 0))  # no line keys in legend
    )
  ) +

  guides(
    linetype = guide_legend(order = 1),
    color    = guide_legend(order = 2)
  ) +

  theme_minimal(base_size = 10) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8), 
    legend.position = "top",
    legend.box = "vertical",
    legend.text = element_text(size = 17),  
    legend.title = element_text(size = 17),  
    legend.spacing.y = unit(-0.2, "cm"),   # reduce vertical spacing
    axis.text = element_text(size = 19, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = paste("Final Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (S > E)",
    y = "P(Choose Symbol)"
  )


ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/", phase_filter, "_FinalFix.pdf"), 
      plot = p, width = 5, height = 6, device = "pdf", bg = "white")

p



agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FinalFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FinalFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FinalFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/ES_FinalFixations_Results.txt"
sink(results_file) 



cat("\n===== ANOVA: Effect of FinalFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FinalFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FinalFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

# --- SETTINGS ---------------------------------------------------------------
phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# --- LOAD & CLEAN -----------------------------------------------------------
data <- read.csv(file_path)

data <- data %>%
  filter(phase == phase_filter, !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2, rtime)

# OV factor
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low","medium","high"))

# Final fixation: 2 = Right, else Left (adjust if your coding differs)
data$FinalFixLocBinary <- ifelse(data$FinalFixLoc == 2, "Right", "Left")
data$FinalFixLocBinary <- factor(data$FinalFixLocBinary, levels = c("Left","Right"))

# Value difference: Symbolic (p2) - Experiential (p1)
data$ValueDifference <- data$p2 - data$p1

# --- EARLY / LATE SPLIT (same rule as before) -------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE) / 2
data <- data %>% mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# --- 5-QUANTILE BINNING PER RT GROUP ---------------------------------------
# (keeps bins comparable within early/late)
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
data <- data %>%
  group_by(RT_group) %>%
  mutate(ValueDifference_bin = ntile(ValueDifference, 5)) %>%
  ungroup() %>%
  mutate(ValueDifference_bin = factor(ValueDifference_bin, levels = 1:5, labels = bin_labels))

# --- SUMMARY FOR PLOT (keep OV + final fix) --------------------------------
summary_df <- data %>%
  group_by(RT_group, ValueDifference_bin, OVcate_2, FinalFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

print(summary_df)

# --- PLOT -------------------------------------------------------------------
colors <- c(low="darkorchid1", medium="darkorchid3", high="darkmagenta")
summary_df$FinalFixLocBinary <- factor(summary_df$FinalFixLocBinary,
                                       levels = c("Left","Right"),
                                       labels = c("Line: Left","Dotted: Right"))
line_types <- c("Line: Left" = "solid", "Dotted: Right" = "dashed")

p <- ggplot(summary_df,
            aes(x = ValueDifference_bin, y = p_choose_right,
                group = interaction(FinalFixLocBinary, OVcate_2),
                color = OVcate_2, linetype = FinalFixLocBinary)) +
  geom_point(size = 3, position = position_dodge(width = 0.25)) +
  geom_line(linewidth = 1.2, position = position_dodge(width = 0.25)) +
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.25)) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +
  scale_color_manual(values = colors, name = "OV level") +
  scale_linetype_manual(values = line_types, name = "Final fixation") +
  facet_wrap(~ RT_group, nrow = 1) +
  theme_minimal(base_size = 12) +
  theme(panel.grid = element_blank(),
        axis.line = element_line(color = "black", linewidth = 0.8),
        legend.position = "top",
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = paste("Final Fixation × OV across Value Difference (", phase_filter, ")", sep = ""),
       x = "Value Difference (Symbolic − Experiential)",
       y = "P(Choose Symbolic)")

print(p)

ggsave(
  filename = file.path("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs",
                       paste0(phase_filter, "_FinalFixation_ValueDiff_EarlyLate.svg")),
  plot = p, width = 10, height = 6, device = "svg", bg = "white"
)

# --- OPTIONAL STATS ---------------------------------------------------------
# Subject-level mean per cell, including RT_group now
agg_data <- data %>%
  group_by(sub_id, RT_group, ValueDifference_bin, FinalFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = "drop")

lmm_model <- lmer(mean_p_choose_right ~
                    RT_group * OVcate_2 * ValueDifference_bin * FinalFixLocBinary +
                    (1 | sub_id),
                  data = agg_data)

anova_out <- anova(lmm_model)
print(anova_out)

# Post-hoc: OV differences within each (bin × final-fix × RT_group)
posthoc_results <- emmeans(
  lmm_model,
  pairwise ~ OVcate_2 | ValueDifference_bin * FinalFixLocBinary * RT_group,
  adjust = "bonferroni"
)
print(posthoc_results)

# Save results
out_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs"
if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)

write.csv(summary_df,
          file.path(out_dir, paste0(phase_filter, "_FinalFixation_ValueDiff_EarlyLate_summary.csv")),
          row.names = FALSE)

sink(file.path(out_dir, paste0(phase_filter, "_FinalFixation_ValueDiff_EarlyLate_results.txt")))
cat("=== LMM ANOVA ===\n"); print(anova_out)
cat("\n=== Post-hoc (OV within Bin × FinalFix × RT_group) ===\n"); print(posthoc_results)
sink()

```

# ES - First fixations on choice per VD and OV

```{r}

data <- read.csv(file_path)

# filter for ES phase and exclude subjects
phase_filter <- "ES" 
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FirstFixLoc, OVcate_2, chose_right, p1, p2)  

# OVcate_2 are the overall value categories - sort them
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# convert FirstFixLoc to categorical: "Right" or "Left"
data$FirstFixLocBinary <- ifelse(data$FirstFixLoc == 2, "Right", "Left")
data$FirstFixLocBinary <- factor(data$FirstFixLocBinary, levels = c("Left", "Right"))

# value difference (Right - Left)
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("E>>S", "E>S", "E ~ S", "S>E", "S>>E"),
                                   include.lowest = TRUE)) %>%
  ungroup()


# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FirstFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)


colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  

summary_df$FirstFixLocBinary <- factor(summary_df$FirstFixLocBinary,
                                        levels = c("Left", "Right"),
                                        labels = c("Line: Left", "Dotted: Right"))
line_types <- c("Line: Left" = "solid", "Dotted: Right" = "dashed")


# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FirstFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FirstFixLocBinary)) +
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "First Fixation") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8), 
    legend.position = "top",
    legend.text = element_text(size = 14),  
    axis.text = element_text(size = 19, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = paste("First Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Symbol - Experiential)",
    y = "P(Choose Symbol)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FirstFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

p


agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FirstFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FirstFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FirstFixLocBinary, adjust = "bonferroni")
print(posthoc_results)



results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_FirstFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FirstlFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FirstlFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FirstlFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

```{r}
library(tidyverse)
library(lme4)
library(emmeans)

# --- SETTINGS ---------------------------------------------------------------
phase_filter      <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

# --- LOAD & CLEAN -----------------------------------------------------------
data <- read.csv(file_path)

data <- data %>%
  filter(phase == phase_filter, !sub_id %in% excluded_subjects) %>%
  drop_na(FirstFixLoc, OVcate_2, chose_right, p1, p2, rtime)

# OV factor
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low","medium","high"))

# First fixation: 2 = Right, else Left (adjust if your coding differs)
data$FirstFixLocBinary <- ifelse(data$FirstFixLoc == 2, "Right", "Left")
data$FirstFixLocBinary <- factor(data$FirstFixLocBinary, levels = c("Left","Right"))

# Value difference: Symbolic (p2) - Experiential (p1)
data$ValueDifference <- data$p2 - data$p1

# --- EARLY / LATE SPLIT -----------------------------------------------------
threshold_rt <- mean(data$rtime, na.rm = TRUE) / 2
data <- data %>% mutate(RT_group = if_else(rtime <= threshold_rt, "early", "late"))

# --- 5-QUANTILE BINNING PER RT GROUP ---------------------------------------
bin_labels <- c("E>>S","E>S","E~S","S>E","S>>E")
data <- data %>%
  group_by(RT_group) %>%
  mutate(ValueDifference_bin = ntile(ValueDifference, 5)) %>%
  ungroup() %>%
  mutate(ValueDifference_bin = factor(ValueDifference_bin, levels = 1:5, labels = bin_labels))

# --- SUMMARY FOR PLOT -------------------------------------------------------
summary_df <- data %>%
  group_by(RT_group, ValueDifference_bin, OVcate_2, FirstFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    n  = n(),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

print(summary_df)

# --- PLOT -------------------------------------------------------------------
colors <- c(low="darkorchid1", medium="darkorchid3", high="darkmagenta")
summary_df$FirstFixLocBinary <- factor(summary_df$FirstFixLocBinary,
                                       levels = c("Left","Right"),
                                       labels = c("Line: Left","Dotted: Right"))
line_types <- c("Line: Left" = "solid", "Dotted: Right" = "dashed")

p <- ggplot(summary_df,
            aes(x = ValueDifference_bin, y = p_choose_right,
                group = interaction(FirstFixLocBinary, OVcate_2),
                color = OVcate_2, linetype = FirstFixLocBinary)) +
  geom_point(size = 3, position = position_dodge(width = 0.25)) +
  geom_line(linewidth = 1.2, position = position_dodge(width = 0.25)) +
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.25)) +
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +
  scale_color_manual(values = colors, name = "OV Level") +
  scale_linetype_manual(values = line_types, name = "First fixation") +
  facet_wrap(~ RT_group, nrow = 1) +
  theme_minimal(base_size = 12) +
  theme(panel.grid = element_blank(),
        axis.line = element_line(color = "black", linewidth = 0.8),
        legend.position = "top",
        plot.title = element_text(face = "bold", hjust = .5)) +
  labs(title = paste("First Fixation × OV across Value Difference (", phase_filter, ")", sep = ""),
       x = "Value Difference (Symbolic − Experiential)",
       y = "P(Choose Symbolic)")

print(p)

p
```

# EE - Final fixations on choice per VD and OV

```{r}
data <- read.csv(file_path)

# filter for ES phase and exclude subjects
phase_filter <- "EE" 
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

# OVcate_2 are the overall value categories - sort them
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# convert FinalFixLoc to categorical: "Right" or "Left"
data$FinalFixLocBinary <- ifelse(data$FinalFixLoc == 2, "R", "L")
data$FinalFixLocBinary <- factor(data$FinalFixLocBinary, levels = c("L", "R"))

# value difference (Right - Left)
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"),
                                   include.lowest = TRUE)) %>%
  ungroup()


# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FinalFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)


colors <- c("low" = "deepskyblue", "medium" = "blue", "high" = "navy")  

summary_df$FinalFixLocBinary <- factor(summary_df$FinalFixLocBinary,
                                        levels = c("L", "R"),
                                        labels = c("Line: L", "Dotted: R"))
line_types <- c("Line: L" = "solid", "Dotted: R" = "dashed")


# Keep your variables explicit (not only via interaction)
summary_df$OV_label <- summary_df$OVcate_2
summary_df$Fix_label <- summary_df$FinalFixLocBinary

p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right,
                            group = interaction(Fix_label, OV_label),
                            color = OV_label, linetype = Fix_label)) +
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  

  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(
    values = line_types,
    name = "Final Fixation",
    guide = guide_legend(
      override.aes = list(linetype = c(0, 0))  # no line keys in legend
    )
  ) +

  guides(
    linetype = guide_legend(order = 1),
    color    = guide_legend(order = 2)
  ) +

  theme_minimal(base_size = 10) +
  theme(
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),  
    axis.line = element_line(color = "black", linewidth = 0.8), 
    legend.position = "top",
    legend.box = "vertical",
    legend.text = element_text(size = 17),  
    legend.title = element_text(size = 17),  
    legend.spacing.y = unit(-0.2, "cm"),   # reduce vertical spacing
    axis.text = element_text(size = 19, color = "black"),  
    axis.title = element_text(size = 20, color = "black"),  
    plot.title = element_text(size = 19, hjust = 0.5, color = "black"),  
    plot.background = element_rect(fill = "white", color = "white") 
  ) +
  labs(
    title = paste("Final Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (R > L)",
    y = "P(Choose Right)"
  )


ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/", phase_filter, "_FinalFix.pdf"), 
      plot = p, width = 5, height = 6, device = "pdf", bg = "white")

p


agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FinalFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FinalFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FinalFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_eye_metrics_OV_Abs/EE_FinalFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FinalFixations_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FinalFixations_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FinalFixations_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1
```

# EE - First fixations on choice per VD and OV

```{r}
data <- read.csv(file_path)

phase_filter <- "EE"  
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FinalFixLoc, OVcate_2, chose_right, p1, p2)  

data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))
data$FirstFixLocBinary <- ifelse(data$FirstFixLoc == 2, "Right", "Left")
data$FirstFixLocBinary <- factor(data$FirstFixLocBinary, levels = c("Left", "Right"))
data$ValueDifference <- round(data$p2 - data$p1, 1)

# Bin value difference into quantiles
data <- data %>%
  group_by(sub_id) %>%
  mutate(ValueDifference_bin = cut(ValueDifference, 
                                   breaks = unique(quantile(ValueDifference, probs = seq(0, 1, length.out = 6), na.rm = TRUE)),
                                   labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"),
                                   include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(Choose Right)
summary_df <- data %>%
  group_by(ValueDifference_bin, OVcate_2, FirstFixLocBinary) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

print(summary_df)

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")  

line_types <- c("Left" = "solid", "Right" = "dashed")  

summary_df$FirstFixLocBinary <- factor(summary_df$FirstFixLocBinary, levels = c("Left", "Right"))

# plot
p <- ggplot(summary_df, aes(x = ValueDifference_bin, y = p_choose_right, 
                            group = interaction(FirstFixLocBinary, OVcate_2), 
                            color = OVcate_2, linetype = FirstFixLocBinary)) +  
  geom_point(size = 3, position = position_dodge(width = 0.2)) +  
  geom_line(position = position_dodge(width = 0.2), linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci),
                width = 0.2, linewidth = 0.8, position = position_dodge(width = 0.2)) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  scale_linetype_manual(values = line_types, name = "Final Fixation") +  
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    legend.text = element_text(size = 19),  
    axis.text = element_text(size = 22, color = "black"),  
    axis.title = element_text(size = 22, color = "black"),  
    plot.title = element_text(size = 22, hjust = 0.5, face="bold", color = "black"),  
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = paste("First Fixation Effect on Choice -", phase_filter, "Phase"),
    x = "Value Difference (Right - Left)",
    y = "P(Choose Right)"
  )

ggsave(paste0("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/", phase_filter, "_NEW_FirstFixation_ValueDiff_Plot.svg"), 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


agg_data <- data %>%
  group_by(sub_id, ValueDifference_bin, FirstFixLocBinary, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')


anova_results <- list()  

lmm_model <- lmer(mean_p_choose_right ~ OVcate_2 * ValueDifference_bin * FirstFixLocBinary + (1 | sub_id),
                  data = agg_data)


anova(lmm_model)

# post hoc
posthoc_results <- emmeans(lmm_model, pairwise ~ OVcate_2 | ValueDifference_bin * FirstFixLocBinary, adjust = "bonferroni")
print(posthoc_results)


results_file <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_FirstFixations_Results.txt"
sink(results_file) 

cat("\n===== ANOVA: Effect of FirstFixLoc_bin on P(Choose Right) =====\n")
print(anova_result)
cat("\n===== Post-hoc Tests: Pairwise Comparisons for FirstFixLoc_bin =====\n")
print(posthoc_result1)
cat("\n===== Linear Mixed Model: OVcate_2 * FirstFixLoc_bin Effect =====\n")
print(anova(lmm_model))
cat("\n===== Post-hoc Comparisons for OV Levels within Each Bin (LMM) =====\n")
print(posthoc_results)
sink()
cat("\n results saved to:", results_file, "\n")

# mean P(choose right) per bin for each participant

anova_res <- ezANOVA(
  data = agg_data,
  dv = mean_p_choose_right,
  wid = sub_id,
  within = .(ValueDifference_bin),
  type = 3,
  detailed = TRUE
)

anova_res

# post-hoc pairwise comparisons with Bonferroni cor
posthoc_result1 <- emmeans(
  lm(mean_p_choose_right ~ factor(ValueDifference_bin), data = agg_data),  
  pairwise ~ ValueDifference_bin,  
  adjust = "bonferroni"  
)

posthoc_result1

```

# Chih-Chung Ting's suggestions for Analysis

## 1) Dwell-time by choice (E vs S)

```{r}

# get modified CCT data - the data is the same as before just that I scaled the option values (*100) like CCT suggested to make the algorithm converge faster in HDDM (has nothing to #do with the eye-tracking bit - what changed: e.g. 0.3 -> 30)
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

phase_filter <- "ES"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(PropDwell_Left, PropDwell_Right, chose_right)

# Final Choice Labels
data <- data %>%
  mutate(final_choice = ifelse(chose_right == 1, "Chose Symbolic", "Chose Experiential"))

# format
data_long <- data %>%
  pivot_longer(cols = c("PropDwell_Left", "PropDwell_Right"),
               names_to = "LookedAt",
               values_to = "Dwell_Proportion")

# rename 
data_long$LookedAt <- factor(data_long$LookedAt,
                             levels = c("PropDwell_Left", "PropDwell_Right"),
                             labels = c("Looked at Experiential", "Looked at Symbolic"))
data_participant <- data_long %>%
  group_by(sub_id, final_choice, LookedAt) %>%
  summarise(Dwell_Proportion = mean(Dwell_Proportion, na.rm = TRUE), .groups = 'drop')

summary_df <- data_participant %>%
  group_by(final_choice, LookedAt) %>%
  summarise(
    mean_dwell = mean(Dwell_Proportion, na.rm = TRUE),
    ci = 1.96 * sd(Dwell_Proportion, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# colours 
bar_colors <- c("Looked at Experiential" = "deepskyblue",
                "Looked at Symbolic" = "darkorchid")

#plot with overlayed data points
p <- ggplot(summary_df, aes(x = final_choice, y = mean_dwell * 100, fill = LookedAt)) +
  geom_bar(stat = "identity",
           position = position_dodge(width = 0.6),
           width = 0.5,
           alpha = 0.8,
           color = "black") +
  geom_errorbar(aes(ymin = (mean_dwell - ci) * 100, ymax = (mean_dwell + ci) * 100),
                position = position_dodge(width = 0.6),
                width = 0.2,
                linewidth = 0.8) +
  geom_point(data = data_participant,
             aes(x = final_choice, y = Dwell_Proportion * 100, group = LookedAt, color = LookedAt),
             position = position_jitterdodge(jitter.width = 0.1, dodge.width = 0.6),
             shape = 21,
             fill = "white",
             stroke = 1,
             size = 4,
             alpha = 0.8) +
  scale_fill_manual(values = bar_colors, name = "Dwell Time On") +
  scale_color_manual(values = bar_colors, guide = "none") +
  geom_hline(yintercept = 50, linetype = "dotted", color = "gray50", linewidth = 1.2) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10),
                     labels = function(x) paste0(x, "%")) +
  labs(
    title = "Dwell Time by Choice - ES Phase",
    x = "Choice",
    y = "Mean Proportion - Dwell Time %",
    fill = "Looked At"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "top",
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 1),
    axis.text = element_text(size = 16, color = "black"),
    axis.title = element_text(size = 18, face = "bold", color = "black"),
    plot.title = element_text(size = 20, hjust = 0.5, face = "bold", color = "black"),
    plot.background = element_rect(fill = "white", color = "white")
  )

print(p)

```





## 3) Linear mixed model for final choice\*LookedAt + random intercept for sub_id \#

```{r}


#model
m_lmm <- lmer(
  Dwell_Proportion ~ final_choice * LookedAt + (1 | sub_id),
  data = data_participant
)

# summary
summary(m_lmm)
anova(m_lmm)

# Post-hoc pairwise across the 4 combos
em_mod  <- emmeans(m_lmm, ~ final_choice * LookedAt)
posthoc <- pairs(em_mod, adjust = "bonferroni")
print(posthoc)

# main-effect pairwise
em_fc   <- emmeans(m_lmm, ~ final_choice)
pairs(em_fc)

em_la   <- emmeans(m_lmm, ~ LookedAt)
pairs(em_la)


### Check residual distribution (just to be sure)

par(mfrow=c(1,2))
qqnorm(resid(m_lmm), main="QQ plot of LMM residuals")
qqline(resid(m_lmm))
plot(fitted(m_lmm), resid(m_lmm), main="Residual vs. Fitted")
par(mfrow=c(1,1))


```

## Dwell-time by choice and OV

```{r}
# --- Packages ---
library(tidyverse)

# --- Load and prepare data ---
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

raw <- read.csv(file_path)

# ES phase only, exclude subjects, require both dwell cols
dat <- raw %>%
  filter(phase == "ES", !sub_id %in% excluded_subjects) %>%
  drop_na(PropDwell_Left, PropDwell_Right)

# Per-participant mean dwell on E (Left) and S (Right)
data_wide <- dat %>%
  group_by(sub_id) %>%
  summarise(
    E_dwell = mean(PropDwell_Left,  na.rm = TRUE),
    S_dwell = mean(PropDwell_Right, na.rm = TRUE),
    .groups = "drop"
  )

# Long format for plotting, robust relabeling
data_long <- data_wide %>%
  pivot_longer(c(E_dwell, S_dwell), names_to = "ROI", values_to = "dwell_prop") %>%
  mutate(
    ROI = factor(ROI,
                 levels = c("E_dwell", "S_dwell"),
                 labels = c("Looked at Experiential", "Looked at Symbolic"))
  )

# --- Plot: mean bars + SE errorbars + larger jittered points ---
p <- ggplot(data_long, aes(x = ROI, y = dwell_prop * 100, fill = ROI)) +
  geom_bar(stat = "summary", fun = "mean", width = 0.6, color = "black", alpha = 0.9) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.15, linewidth = 0.9) +
  geom_point(position = position_jitter(width = 0.10, height = 0),
             size = 4.5, shape = 21, fill = "white", alpha = 0.85) +
             geom_hline(yintercept = 50, linetype = "dotted", color = "grey40", linewidth = 1) +

  scale_fill_manual(values = c("Looked at Experiential" = "deepskyblue",
                               "Looked at Symbolic"     = "darkorchid")) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = c(0, 50, 100),
                     labels = function(x) paste0(x, "%")) +
  labs(title = "Dwell Time on Option",
       x = NULL,
       y = "Mean Proportion of Dwell Time (%)") +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "none",
    axis.text  = element_text(color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = "white", color = NA),
    axis.line = element_line(color = "black", linewidth = 0.8)
  )

print(p)

# --- Optional: save plot ---
# ggsave("dwell_ES_E_vs_S.png", p, width = 6.5, height = 4.5, dpi = 300)

# --- Optional: quick stats (paired t-test + Cohen's d) ---
 t_res   <- t.test(data_wide$E_dwell, data_wide$S_dwell, paired = TRUE)
 d_cohen <- mean(data_wide$E_dwell - data_wide$S_dwell) / sd(data_wide$E_dwell - data_wide$S_dwell)
 tibble(
   mean_E = mean(data_wide$E_dwell), mean_S = mean(data_wide$S_dwell),
   sd_E = sd(data_wide$E_dwell),     sd_S = sd(data_wide$S_dwell),
   t = as.numeric(t_res$statistic), df = as.numeric(t_res$parameter),
   p = t_res$p.value, cohen_d = d_cohen
 ) %>% print()


```

```{r}
# Load required packages
library(tidyverse)
library(lme4)
library(emmeans)

# Load your data
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# Filter ES phase and exclude subjects
excluded_subjects <- c(1, 4, 5, 6, 14, 99)
data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subjects) %>%
  drop_na(PropDwell_Left, PropDwell_Right, chose_right)

# Final choice variable
data <- data %>%
  mutate(
    final_choice = ifelse(chose_right == 1, "Chose Symbolic", "Chose Experiential"),
    OVCat = factor(OVcate, levels = c("high", "medium", "low"))  # Ensure ordering
  )

# Long format for dwell time
data_long <- data %>%
  pivot_longer(cols = c("PropDwell_Left", "PropDwell_Right"),
               names_to = "LookedAt",
               values_to = "Dwell_Proportion")

# Rename looked-at labels
data_long$LookedAt <- factor(data_long$LookedAt,
                             levels = c("PropDwell_Left", "PropDwell_Right"),
                             labels = c("Looked at Experiential", "Looked at Symbolic"))

# Collapse per subject
data_participant <- data_long %>%
  group_by(sub_id, final_choice, OVCat, LookedAt) %>%
  summarise(Dwell_Proportion = mean(Dwell_Proportion, na.rm = TRUE), .groups = 'drop')

# Summary for plotting
summary_df <- data_participant %>%
  group_by(final_choice, OVCat, LookedAt) %>%
  summarise(
    mean_dwell = mean(Dwell_Proportion, na.rm = TRUE),
    ci = 1.96 * sd(Dwell_Proportion, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# Define colors
bar_colors <- c("Looked at Experiential" = "deepskyblue",
                "Looked at Symbolic" = "darkorchid")

# Final plot
ggplot(summary_df, aes(x = OVCat, y = mean_dwell * 100, fill = LookedAt)) +
  geom_bar(stat = "identity",
           position = position_dodge(width = 0.6),
           width = 0.5,
           alpha = 0.85,
           color = "black") +
  geom_errorbar(aes(ymin = (mean_dwell - ci) * 100,
                    ymax = (mean_dwell + ci) * 100),
                width = 0.2,
                linewidth = 0.8,
                position = position_dodge(width = 0.6)) +
  geom_point(data = data_participant,
             aes(x = OVCat, y = Dwell_Proportion * 100, group = LookedAt, color = LookedAt),
             position = position_jitterdodge(jitter.width = 0.15, dodge.width = 0.6),
             shape = 21,
             fill = "white",
             stroke = 1,
             size = 4,
             alpha = 0.75) +
  facet_wrap(~ final_choice) +
  geom_hline(yintercept = 50, linetype = "dotted", color = "gray40", linewidth = 1) +
  scale_fill_manual(values = bar_colors, name = "Dwell Time") +
  scale_color_manual(values = bar_colors, guide = "none") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = c(0, 50, 100),
                     labels = function(x) paste0(x, "%")) +
  labs(
    title = "Dwell Time by Choice and Overall Value",
    x = "Overall Value",
    y = "Mean Proportion of Dwell Time (%)"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    legend.position = "top",
    strip.text = element_text(size = 15, face = "bold"),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = "white", color = NA),
    axis.line = element_line(color = "black", linewidth = 0.8)
  )

```




```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(emmeans)

# --- Load data ---
file_path <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/data/data_sets/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"
data <- read.csv(file_path)

# --- Filter + prepare ---
excluded_subjects <- c(1, 4, 5, 6, 14, 99)
data <- data %>%
  filter(phase == "ES" & !sub_id %in% excluded_subjects) %>%
  drop_na(PropDwell_Left, PropDwell_Right, chose_right) %>%
  mutate(
    final_choice = ifelse(chose_right == 1, "Chose Symbolic", "Chose Experiential"),
    OVCat = factor(OVcate, levels = c("high", "medium", "low"))
  )

# --- Long format dwell data ---
data_long <- data %>%
  pivot_longer(cols = c("PropDwell_Left", "PropDwell_Right"),
               names_to = "LookedAt", values_to = "Dwell_Proportion") %>%
  mutate(
    LookedAt = factor(LookedAt,
                      levels = c("PropDwell_Left", "PropDwell_Right"),
                      labels = c("Experiential", "Symbolic"))
  )

# --- Collapse per subject (average dwell proportion per bin) ---
data_participant <- data_long %>%
  group_by(sub_id, final_choice, OVCat, LookedAt) %>%
  summarise(Dwell_Proportion = mean(Dwell_Proportion), .groups = "drop")

# --- Mixed model: dwell ~ LookedAt, separately per final_choice × OVCat ---
run_model <- function(df) {
  m <- lmer(Dwell_Proportion ~ LookedAt + (1 | sub_id), data = df)
  em <- emmeans(m, pairwise ~ LookedAt)
  return(list(model = m, emmeans = em))
}

# --- Apply to each OV × choice condition ---
results <- data_participant %>%
  group_by(final_choice, OVCat) %>%
  group_map(~ run_model(.x))

# --- Extract pairwise results cleanly ---
pairwise_results <- data_participant %>%
  group_by(final_choice, OVCat) %>%
  group_modify(~ {
    m <- lmer(Dwell_Proportion ~ LookedAt + (1 | sub_id), data = .x)
    tidy <- as.data.frame(emmeans(m, pairwise ~ LookedAt)$contrasts)
    tidy
  }) %>%
  ungroup()

print(pairwise_results)


```



```{r}
# Pivot wide for paired comparisons
data_wide <- data_participant %>%
  pivot_wider(names_from = LookedAt, values_from = Dwell_Proportion) %>%
  rename(Dwell_E = Experiential, Dwell_S = Symbolic) %>%
  drop_na(Dwell_E, Dwell_S)

# Function to run mixed model + Cohen's d
run_model_with_d <- function(df) {
  # Mixed model
  m <- lmer(Dwell_Proportion ~ LookedAt + (1 | sub_id), data = df)
  em <- emmeans(m, pairwise ~ LookedAt)
  contrast <- as.data.frame(em$contrasts)
  
  # Compute Cohen's d (paired)
  diffs <- df %>%
    pivot_wider(names_from = LookedAt, values_from = Dwell_Proportion) %>%
    mutate(diff = Experiential - Symbolic)
  
  cohen_d <- mean(diffs$diff) / sd(diffs$diff)
  
  contrast$cohen_d <- cohen_d
  return(contrast)
}

# Apply to each OV × choice condition
pairwise_results <- data_participant %>%
  group_by(final_choice, OVCat) %>%
  group_modify(~ run_model_with_d(.x)) %>%
  ungroup()

print(pairwise_results)

```


# Fixation advantage effect on choice per bin (fixation advantage = Fix.right - Fix.Left)

```{r}
data <- read.csv(file)

# phase filter
phase_filter <- "EE"  # Change as needed
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)  

# order
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile binning of FixationAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                     breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                     labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                     include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# bin order
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "blue", "medium" = "deepskyblue", "high" = "navy")  #darkorchid1,  darkorchid3, darkmagenta

# Plot
p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Effect of Fixation Advantage on Choice - EE Phase",
    x = "Fixation Advantage (Right - Left)",
    y = "P(Choose Right)"
)

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/EE_FixationAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


# P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

#P(Choose Right) using Fixation Advantage and OV level
lmm_model <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin * OVcate_2 +  
    (1 | sub_id),  
  data = agg_data
)

summary(lmm_model)

# post hoc
emmeans_lmm <- emmeans(lmm_model, pairwise ~ FixationAdvantage_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(emmeans_OV)
print(emmeans_lmm)

# Model comparison
lmm_no_OV <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin +  
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  

# FixtionAdvantage no bin
lmm_continuous <- lmer(chose_right ~ FixationAdvantage * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"

stats_file <- paste0(output_dir, phase_filter, "_FixationAdvantage_LMM_Results.txt")
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Right) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Fixation Advantage Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Fixation Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Fixation Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Fixation Advantage) ###\n")
print(summary(lmm_continuous))

# stop
sink()
print(paste("Statistics saved to:", stats_file))

```

```{r}
data <- read.csv(file)

# phase filter
phase_filter <- "ES"  # Change as needed
excluded_subjects <- c(1, 4, 5, 6, 14, 99)

data <- data %>%
  filter(phase == phase_filter & !sub_id %in% excluded_subjects) %>%
  drop_na(FixationAdvantage, OVcate_2, chose_right)  

# order
data$OVcate_2 <- factor(data$OVcate_2, levels = c("low", "medium", "high"))

# Quantile binning of FixationAdvantage
data <- data %>%
  group_by(sub_id, OVcate_2) %>%
  mutate(FixationAdvantage_bin = cut(FixationAdvantage, 
                                     breaks = unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE)), 
                                     labels = 1:(length(unique(quantile(FixationAdvantage, probs = seq(0, 1, length.out = 6), na.rm = TRUE))) - 1),
                                     include.lowest = TRUE)) %>%
  ungroup()

# Mean & 95% CI for P(choose right)
summary_df <- data %>%
  group_by(FixationAdvantage_bin, OVcate_2) %>%
  summarise(
    p_choose_right = mean(chose_right, na.rm = TRUE),
    ci = 1.96 * sd(chose_right, na.rm = TRUE) / sqrt(n()),
    .groups = 'drop'
  )

# bin order
summary_df$FixationAdvantage_bin <- factor(summary_df$FixationAdvantage_bin, levels = 1:5, labels = c("L>>R", "L>R", "L ~ R", "R>L", "R>>L"))

colors <- c("low" = "darkorchid1", "medium" = "darkorchid3", "high" = "darkmagenta")  #darkorchid1,  darkorchid3, darkmagenta

# Plot
p <- ggplot(summary_df, aes(x = FixationAdvantage_bin, y = p_choose_right, group = OVcate_2, color = OVcate_2)) +
  geom_point(size = 4) +  
  geom_line(linewidth = 1.2) +  
  geom_errorbar(aes(ymin = p_choose_right - ci, ymax = p_choose_right + ci), width = 0.2, linewidth = 0.8) +  
  geom_hline(yintercept = 0.5, linetype = "dotted", color = "gray50", linewidth = 1) +  
  scale_color_manual(values = colors, name = "OV Level") +  
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "black", linewidth = 0.8),
    legend.position = "top",
    plot.background = element_rect(fill = "white", color = "white")
  ) +
  labs(
    title = "Effect of Fixation Advantage on Choice - EE Phase",
    x = "Fixation Advantage (Right - Left)",
    y = "P(Choose Right)"
)

ggsave("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/ES_FixationAdvantage_Plot.svg", 
       plot = p, width = 8, height = 6, device = "svg", bg = "white")

print(p)


# P(choose right) per bin for each participant
agg_data <- data %>%
  group_by(sub_id, FixationAdvantage_bin, OVcate_2) %>%
  summarise(mean_p_choose_right = mean(chose_right, na.rm = TRUE), .groups = 'drop')

#P(Choose Right) using Fixation Advantage and OV level
lmm_model <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin * OVcate_2 +  
    (1 | sub_id),  
  data = agg_data
)

summary(lmm_model)

# post hoc
emmeans_lmm <- emmeans(lmm_model, pairwise ~ FixationAdvantage_bin | OVcate_2, adjust = "bonferroni")
emmeans_OV <- emmeans(lmm_model, pairwise ~ OVcate_2 | FixationAdvantage_bin, adjust = "bonferroni")
print(emmeans_OV)
print(emmeans_lmm)

# Model comparison
lmm_no_OV <- lmer(
  mean_p_choose_right ~ FixationAdvantage_bin +  
    (1 | sub_id), 
  data = agg_data
)

anova(lmm_no_OV, lmm_model)  

# FixtionAdvantage no bin
lmm_continuous <- lmer(chose_right ~ FixationAdvantage * OVcate_2 + (1 | sub_id), data = data)
summary(lmm_continuous)

##################################

output_dir <- "D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/R_regression_OV_Abs/"

stats_file <- paste0(output_dir, phase_filter, "_FixationAdvantage_LMM_Results.txt")
sink(stats_file)

cat("### Linear Mixed Model: Predicting P(Choose Right) ###\n")
print(summary(lmm_model))

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - Fixation Advantage Bins Within OV Levels ###\n")
print(emmeans_lmm)

cat("\n### Pairwise Comparisons (Bonferroni-adjusted) - OV Levels Within Each Fixation Bin ###\n")
print(emmeans_OV)

cat("\n### Model Comparison: Does OV Level Influence Fixation Effects? ###\n")
print(anova(lmm_no_OV, lmm_model))

cat("\n### Linear Mixed Model (Continuous Fixation Advantage) ###\n")
print(summary(lmm_continuous))

# stop
sink()
print(paste("Statistics saved to:", stats_file))
```

# LMM for role of fixation and duration 

```{r}

library(tidyverse)
library(lme4)
library(lmerTest)

# File path (adjust if needed)
file <- "C:/Cluster_Github/HDDM_Vero/data_sets/data_sets_Garcia/GarciaParticipants_Eye_Response_Feed_Allfix_addm_OV_Abs_CCT.csv"

excluded_subs <- c(1, 4, 5, 6, 14, 99)

df <- read_csv(file)

# Filter ES phase and drop excluded subjects
df <- df %>%
  mutate(sub_id = as.integer(sub_id),
         phase = toupper(phase)) %>%
  filter(phase == "ES", !(sub_id %in% excluded_subs))


# Map loc values: 1 = E, 2 = S
loc_to_opt <- function(x) {
  ifelse(is.na(x), NA,
         ifelse(round(x) == 1, "E",
                ifelse(round(x) == 2, "S", NA)))
}

# Durations (ms)
dur_long <- bind_rows(
  df %>% transmute(sub_id, role = "First",
                   opt_type = loc_to_opt(FirstFixLoc),
                   dur_ms = FirstFixDur),
  df %>% transmute(sub_id, role = "Middle",
                   opt_type = loc_to_opt(MiddleDominantLoc),
                   dur_ms = MiddleDominantDur),
  df %>% transmute(sub_id, role = "Final",
                   opt_type = loc_to_opt(FinalFixLoc),
                   dur_ms = FinalFixDur)
) %>%
  filter(opt_type %in% c("E","S"), !is.na(dur_ms)) %>%
  mutate(role = factor(role, levels = c("First","Middle","Final")),
         opt_type = factor(opt_type, levels = c("E","S")))

# Location (probabilities, trial-level)
loc_long <- bind_rows(
  df %>% transmute(sub_id, role = "First",
                   opt_type = loc_to_opt(FirstFixLoc)),
  df %>% transmute(sub_id, role = "Middle",
                   opt_type = loc_to_opt(MiddleDominantLoc)),
  df %>% transmute(sub_id, role = "Final",
                   opt_type = loc_to_opt(FinalFixLoc))
) %>%
  filter(opt_type %in% c("E","S")) %>%
  mutate(role = factor(role, levels = c("First","Middle","Final")),
         opt_type = factor(opt_type, levels = c("E","S")),
         E_fix = ifelse(opt_type == "E", 1, 0))


m_prob <- glmer(E_fix ~ role + (1 | sub_id),
                data = loc_long,
                family = binomial)
summary(m_prob)

# pairwise contrasts of E vs S within each role
emm_prob <- emmeans(m_prob, ~ 1 | role, type = "response")  
# type="response" back-transforms to probabilities
emm_prob

# Within-role tests: E vs S
# Since E_fix is binary (1=E, 0=S), the intercept per role tells prob(E)
# To explicitly test against 0.5:
test(emm_prob, null = 0.5, type = "response")

m_dur <- lmer(dur_ms ~ role * opt_type + (1 | sub_id),
              data = dur_long)
summary(m_dur)
emm_dur <- emmeans(m_dur, ~ opt_type | role)
contrast(emm_dur, "pairwise", by = "role")

```

```{r}
# Per-subject fixation probability
prob_summary <- loc_long %>%
  group_by(sub_id, role, opt_type) %>%
  summarise(prob = mean(E_fix), .groups = "drop") %>%
  group_by(role, opt_type) %>%
  summarise(mean_prob = mean(prob),
            sd_prob   = sd(prob),
            n         = n(),
            .groups = "drop")

prob_summary

dur_summary <- dur_long %>%
  group_by(sub_id, role, opt_type) %>%
  summarise(mean_dur = mean(dur_ms), .groups = "drop") %>%
  group_by(role, opt_type) %>%
  summarise(mean_dur = mean(mean_dur),
            sd_dur   = sd(mean_dur),
            n        = n(),
            .groups = "drop")

dur_summary

```

```{r}

dat <- read.csv("D:/Aberdeen_Uni_June24/cap/THESIS/Garcia_Analysis/stats_TingGluth/Analysis_Simulation_replication/simulation/NewFixCode/ppc_full_bayesian/sim_10_postdraws2/allSubjectLevel.csv")

# Keep only empirical + a manageable number of draws (1000 is huge!)
# e.g. subset to 50 draws first
dat_small <- subset(dat, is.na(Draw) | Draw <= 50)

# Bin as factor (treat quintiles as categorical)
dat_small$Bin <- factor(dat_small$Bin)

# Mixed model: probability of E choice
m1 <- lmer(ProbE ~ Source * Bin + (1|Subject), data = dat_small)

summary(m1)
anova(m1)

```

```{r}


# average across draws for simulated
sim_means <- dat %>%
  filter(Source=="simulated") %>%
  group_by(Subject, Bin) %>%
  summarise(ProbE = mean(ProbE, na.rm=TRUE), .groups="drop")

emp_means <- dat %>%
  filter(Source=="empirical") %>%
  select(Subject, Bin, ProbE)

merged <- merge(emp_means, sim_means, by=c("Subject","Bin"),
                suffixes=c("_emp","_sim"))

# run paired t-test for each bin
library(broom)
tests <- merged %>%
  group_by(Bin) %>%
  summarise(tidy(t.test(ProbE_emp, ProbE_sim, paired=TRUE)))
tests

```

